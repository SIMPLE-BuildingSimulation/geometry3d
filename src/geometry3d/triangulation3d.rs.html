<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `src/triangulation3d.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>triangulation3d.rs - source</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../normalize.css"><link rel="stylesheet" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../ayu.css" disabled><link rel="stylesheet" href="../../dark.css" disabled><link rel="stylesheet" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script defer src="../../source-script.js"></script><script defer src="../../source-files.js"></script><script defer src="../../main.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.css" integrity="sha384-TEMocfGvRuD1rIAacqrknm5BQZ7W7uWitoih+jMNFXQIbNl16bO8OZmylH/Vi/Ei" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.js" integrity="sha384-jmxIlussZWB7qCuB+PgKG1uLjjxbVVIayPJwi6cG6Zb4YKq0JIw+OMnkkEC7kYCq" crossorigin="anonymous"></script>
<script>
  "use strict";
  document.addEventListener("DOMContentLoaded", function () {
      var maths = document.getElementsByClassName("language-math");
      for (var i=0; i<maths.length; i++) {
          var el = maths[i];
          katex.render(el.innerText, el, {displayMode: true});
      }

      var codes = document.getElementsByTagName("code");
      for (i=0; i<codes.length; i++) {
          el = codes[i];
          if (el.classList.contains("language-math")) continue;
          if (el.classList.contains("language-inline-math")) {
              katex.render(el.innerText, el);
              continue;
          }

          var parent = el.parentNode;
          if (parent.nodeName.toLowerCase() === "pre") continue;
          // TODO: Can this be done with DOM manipulation rather than string manipulation?
          // https://stackoverflow.com/q/48438067/3019990
          var inlineMath = "$" + el.outerHTML + "$";
          if (parent.innerHTML.indexOf(inlineMath) !== -1) {
              el.classList.add("language-inline-math");
              parent.innerHTML = parent.innerHTML.replace("$" + el.outerHTML + "$", el.outerHTML);
              i--;
          }
      }
  });
</script>

</head><body class="rustdoc source"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../geometry3d/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../geometry3d/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../geometry3d/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="example-wrap"><pre class="line-numbers"><span id="1">1</span>
<span id="2">2</span>
<span id="3">3</span>
<span id="4">4</span>
<span id="5">5</span>
<span id="6">6</span>
<span id="7">7</span>
<span id="8">8</span>
<span id="9">9</span>
<span id="10">10</span>
<span id="11">11</span>
<span id="12">12</span>
<span id="13">13</span>
<span id="14">14</span>
<span id="15">15</span>
<span id="16">16</span>
<span id="17">17</span>
<span id="18">18</span>
<span id="19">19</span>
<span id="20">20</span>
<span id="21">21</span>
<span id="22">22</span>
<span id="23">23</span>
<span id="24">24</span>
<span id="25">25</span>
<span id="26">26</span>
<span id="27">27</span>
<span id="28">28</span>
<span id="29">29</span>
<span id="30">30</span>
<span id="31">31</span>
<span id="32">32</span>
<span id="33">33</span>
<span id="34">34</span>
<span id="35">35</span>
<span id="36">36</span>
<span id="37">37</span>
<span id="38">38</span>
<span id="39">39</span>
<span id="40">40</span>
<span id="41">41</span>
<span id="42">42</span>
<span id="43">43</span>
<span id="44">44</span>
<span id="45">45</span>
<span id="46">46</span>
<span id="47">47</span>
<span id="48">48</span>
<span id="49">49</span>
<span id="50">50</span>
<span id="51">51</span>
<span id="52">52</span>
<span id="53">53</span>
<span id="54">54</span>
<span id="55">55</span>
<span id="56">56</span>
<span id="57">57</span>
<span id="58">58</span>
<span id="59">59</span>
<span id="60">60</span>
<span id="61">61</span>
<span id="62">62</span>
<span id="63">63</span>
<span id="64">64</span>
<span id="65">65</span>
<span id="66">66</span>
<span id="67">67</span>
<span id="68">68</span>
<span id="69">69</span>
<span id="70">70</span>
<span id="71">71</span>
<span id="72">72</span>
<span id="73">73</span>
<span id="74">74</span>
<span id="75">75</span>
<span id="76">76</span>
<span id="77">77</span>
<span id="78">78</span>
<span id="79">79</span>
<span id="80">80</span>
<span id="81">81</span>
<span id="82">82</span>
<span id="83">83</span>
<span id="84">84</span>
<span id="85">85</span>
<span id="86">86</span>
<span id="87">87</span>
<span id="88">88</span>
<span id="89">89</span>
<span id="90">90</span>
<span id="91">91</span>
<span id="92">92</span>
<span id="93">93</span>
<span id="94">94</span>
<span id="95">95</span>
<span id="96">96</span>
<span id="97">97</span>
<span id="98">98</span>
<span id="99">99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
<span id="136">136</span>
<span id="137">137</span>
<span id="138">138</span>
<span id="139">139</span>
<span id="140">140</span>
<span id="141">141</span>
<span id="142">142</span>
<span id="143">143</span>
<span id="144">144</span>
<span id="145">145</span>
<span id="146">146</span>
<span id="147">147</span>
<span id="148">148</span>
<span id="149">149</span>
<span id="150">150</span>
<span id="151">151</span>
<span id="152">152</span>
<span id="153">153</span>
<span id="154">154</span>
<span id="155">155</span>
<span id="156">156</span>
<span id="157">157</span>
<span id="158">158</span>
<span id="159">159</span>
<span id="160">160</span>
<span id="161">161</span>
<span id="162">162</span>
<span id="163">163</span>
<span id="164">164</span>
<span id="165">165</span>
<span id="166">166</span>
<span id="167">167</span>
<span id="168">168</span>
<span id="169">169</span>
<span id="170">170</span>
<span id="171">171</span>
<span id="172">172</span>
<span id="173">173</span>
<span id="174">174</span>
<span id="175">175</span>
<span id="176">176</span>
<span id="177">177</span>
<span id="178">178</span>
<span id="179">179</span>
<span id="180">180</span>
<span id="181">181</span>
<span id="182">182</span>
<span id="183">183</span>
<span id="184">184</span>
<span id="185">185</span>
<span id="186">186</span>
<span id="187">187</span>
<span id="188">188</span>
<span id="189">189</span>
<span id="190">190</span>
<span id="191">191</span>
<span id="192">192</span>
<span id="193">193</span>
<span id="194">194</span>
<span id="195">195</span>
<span id="196">196</span>
<span id="197">197</span>
<span id="198">198</span>
<span id="199">199</span>
<span id="200">200</span>
<span id="201">201</span>
<span id="202">202</span>
<span id="203">203</span>
<span id="204">204</span>
<span id="205">205</span>
<span id="206">206</span>
<span id="207">207</span>
<span id="208">208</span>
<span id="209">209</span>
<span id="210">210</span>
<span id="211">211</span>
<span id="212">212</span>
<span id="213">213</span>
<span id="214">214</span>
<span id="215">215</span>
<span id="216">216</span>
<span id="217">217</span>
<span id="218">218</span>
<span id="219">219</span>
<span id="220">220</span>
<span id="221">221</span>
<span id="222">222</span>
<span id="223">223</span>
<span id="224">224</span>
<span id="225">225</span>
<span id="226">226</span>
<span id="227">227</span>
<span id="228">228</span>
<span id="229">229</span>
<span id="230">230</span>
<span id="231">231</span>
<span id="232">232</span>
<span id="233">233</span>
<span id="234">234</span>
<span id="235">235</span>
<span id="236">236</span>
<span id="237">237</span>
<span id="238">238</span>
<span id="239">239</span>
<span id="240">240</span>
<span id="241">241</span>
<span id="242">242</span>
<span id="243">243</span>
<span id="244">244</span>
<span id="245">245</span>
<span id="246">246</span>
<span id="247">247</span>
<span id="248">248</span>
<span id="249">249</span>
<span id="250">250</span>
<span id="251">251</span>
<span id="252">252</span>
<span id="253">253</span>
<span id="254">254</span>
<span id="255">255</span>
<span id="256">256</span>
<span id="257">257</span>
<span id="258">258</span>
<span id="259">259</span>
<span id="260">260</span>
<span id="261">261</span>
<span id="262">262</span>
<span id="263">263</span>
<span id="264">264</span>
<span id="265">265</span>
<span id="266">266</span>
<span id="267">267</span>
<span id="268">268</span>
<span id="269">269</span>
<span id="270">270</span>
<span id="271">271</span>
<span id="272">272</span>
<span id="273">273</span>
<span id="274">274</span>
<span id="275">275</span>
<span id="276">276</span>
<span id="277">277</span>
<span id="278">278</span>
<span id="279">279</span>
<span id="280">280</span>
<span id="281">281</span>
<span id="282">282</span>
<span id="283">283</span>
<span id="284">284</span>
<span id="285">285</span>
<span id="286">286</span>
<span id="287">287</span>
<span id="288">288</span>
<span id="289">289</span>
<span id="290">290</span>
<span id="291">291</span>
<span id="292">292</span>
<span id="293">293</span>
<span id="294">294</span>
<span id="295">295</span>
<span id="296">296</span>
<span id="297">297</span>
<span id="298">298</span>
<span id="299">299</span>
<span id="300">300</span>
<span id="301">301</span>
<span id="302">302</span>
<span id="303">303</span>
<span id="304">304</span>
<span id="305">305</span>
<span id="306">306</span>
<span id="307">307</span>
<span id="308">308</span>
<span id="309">309</span>
<span id="310">310</span>
<span id="311">311</span>
<span id="312">312</span>
<span id="313">313</span>
<span id="314">314</span>
<span id="315">315</span>
<span id="316">316</span>
<span id="317">317</span>
<span id="318">318</span>
<span id="319">319</span>
<span id="320">320</span>
<span id="321">321</span>
<span id="322">322</span>
<span id="323">323</span>
<span id="324">324</span>
<span id="325">325</span>
<span id="326">326</span>
<span id="327">327</span>
<span id="328">328</span>
<span id="329">329</span>
<span id="330">330</span>
<span id="331">331</span>
<span id="332">332</span>
<span id="333">333</span>
<span id="334">334</span>
<span id="335">335</span>
<span id="336">336</span>
<span id="337">337</span>
<span id="338">338</span>
<span id="339">339</span>
<span id="340">340</span>
<span id="341">341</span>
<span id="342">342</span>
<span id="343">343</span>
<span id="344">344</span>
<span id="345">345</span>
<span id="346">346</span>
<span id="347">347</span>
<span id="348">348</span>
<span id="349">349</span>
<span id="350">350</span>
<span id="351">351</span>
<span id="352">352</span>
<span id="353">353</span>
<span id="354">354</span>
<span id="355">355</span>
<span id="356">356</span>
<span id="357">357</span>
<span id="358">358</span>
<span id="359">359</span>
<span id="360">360</span>
<span id="361">361</span>
<span id="362">362</span>
<span id="363">363</span>
<span id="364">364</span>
<span id="365">365</span>
<span id="366">366</span>
<span id="367">367</span>
<span id="368">368</span>
<span id="369">369</span>
<span id="370">370</span>
<span id="371">371</span>
<span id="372">372</span>
<span id="373">373</span>
<span id="374">374</span>
<span id="375">375</span>
<span id="376">376</span>
<span id="377">377</span>
<span id="378">378</span>
<span id="379">379</span>
<span id="380">380</span>
<span id="381">381</span>
<span id="382">382</span>
<span id="383">383</span>
<span id="384">384</span>
<span id="385">385</span>
<span id="386">386</span>
<span id="387">387</span>
<span id="388">388</span>
<span id="389">389</span>
<span id="390">390</span>
<span id="391">391</span>
<span id="392">392</span>
<span id="393">393</span>
<span id="394">394</span>
<span id="395">395</span>
<span id="396">396</span>
<span id="397">397</span>
<span id="398">398</span>
<span id="399">399</span>
<span id="400">400</span>
<span id="401">401</span>
<span id="402">402</span>
<span id="403">403</span>
<span id="404">404</span>
<span id="405">405</span>
<span id="406">406</span>
<span id="407">407</span>
<span id="408">408</span>
<span id="409">409</span>
<span id="410">410</span>
<span id="411">411</span>
<span id="412">412</span>
<span id="413">413</span>
<span id="414">414</span>
<span id="415">415</span>
<span id="416">416</span>
<span id="417">417</span>
<span id="418">418</span>
<span id="419">419</span>
<span id="420">420</span>
<span id="421">421</span>
<span id="422">422</span>
<span id="423">423</span>
<span id="424">424</span>
<span id="425">425</span>
<span id="426">426</span>
<span id="427">427</span>
<span id="428">428</span>
<span id="429">429</span>
<span id="430">430</span>
<span id="431">431</span>
<span id="432">432</span>
<span id="433">433</span>
<span id="434">434</span>
<span id="435">435</span>
<span id="436">436</span>
<span id="437">437</span>
<span id="438">438</span>
<span id="439">439</span>
<span id="440">440</span>
<span id="441">441</span>
<span id="442">442</span>
<span id="443">443</span>
<span id="444">444</span>
<span id="445">445</span>
<span id="446">446</span>
<span id="447">447</span>
<span id="448">448</span>
<span id="449">449</span>
<span id="450">450</span>
<span id="451">451</span>
<span id="452">452</span>
<span id="453">453</span>
<span id="454">454</span>
<span id="455">455</span>
<span id="456">456</span>
<span id="457">457</span>
<span id="458">458</span>
<span id="459">459</span>
<span id="460">460</span>
<span id="461">461</span>
<span id="462">462</span>
<span id="463">463</span>
<span id="464">464</span>
<span id="465">465</span>
<span id="466">466</span>
<span id="467">467</span>
<span id="468">468</span>
<span id="469">469</span>
<span id="470">470</span>
<span id="471">471</span>
<span id="472">472</span>
<span id="473">473</span>
<span id="474">474</span>
<span id="475">475</span>
<span id="476">476</span>
<span id="477">477</span>
<span id="478">478</span>
<span id="479">479</span>
<span id="480">480</span>
<span id="481">481</span>
<span id="482">482</span>
<span id="483">483</span>
<span id="484">484</span>
<span id="485">485</span>
<span id="486">486</span>
<span id="487">487</span>
<span id="488">488</span>
<span id="489">489</span>
<span id="490">490</span>
<span id="491">491</span>
<span id="492">492</span>
<span id="493">493</span>
<span id="494">494</span>
<span id="495">495</span>
<span id="496">496</span>
<span id="497">497</span>
<span id="498">498</span>
<span id="499">499</span>
<span id="500">500</span>
<span id="501">501</span>
<span id="502">502</span>
<span id="503">503</span>
<span id="504">504</span>
<span id="505">505</span>
<span id="506">506</span>
<span id="507">507</span>
<span id="508">508</span>
<span id="509">509</span>
<span id="510">510</span>
<span id="511">511</span>
<span id="512">512</span>
<span id="513">513</span>
<span id="514">514</span>
<span id="515">515</span>
<span id="516">516</span>
<span id="517">517</span>
<span id="518">518</span>
<span id="519">519</span>
<span id="520">520</span>
<span id="521">521</span>
<span id="522">522</span>
<span id="523">523</span>
<span id="524">524</span>
<span id="525">525</span>
<span id="526">526</span>
<span id="527">527</span>
<span id="528">528</span>
<span id="529">529</span>
<span id="530">530</span>
<span id="531">531</span>
<span id="532">532</span>
<span id="533">533</span>
<span id="534">534</span>
<span id="535">535</span>
<span id="536">536</span>
<span id="537">537</span>
<span id="538">538</span>
<span id="539">539</span>
<span id="540">540</span>
<span id="541">541</span>
<span id="542">542</span>
<span id="543">543</span>
<span id="544">544</span>
<span id="545">545</span>
<span id="546">546</span>
<span id="547">547</span>
<span id="548">548</span>
<span id="549">549</span>
<span id="550">550</span>
<span id="551">551</span>
<span id="552">552</span>
<span id="553">553</span>
<span id="554">554</span>
<span id="555">555</span>
<span id="556">556</span>
<span id="557">557</span>
<span id="558">558</span>
<span id="559">559</span>
<span id="560">560</span>
<span id="561">561</span>
<span id="562">562</span>
<span id="563">563</span>
<span id="564">564</span>
<span id="565">565</span>
<span id="566">566</span>
<span id="567">567</span>
<span id="568">568</span>
<span id="569">569</span>
<span id="570">570</span>
<span id="571">571</span>
<span id="572">572</span>
<span id="573">573</span>
<span id="574">574</span>
<span id="575">575</span>
<span id="576">576</span>
<span id="577">577</span>
<span id="578">578</span>
<span id="579">579</span>
<span id="580">580</span>
<span id="581">581</span>
<span id="582">582</span>
<span id="583">583</span>
<span id="584">584</span>
<span id="585">585</span>
<span id="586">586</span>
<span id="587">587</span>
<span id="588">588</span>
<span id="589">589</span>
<span id="590">590</span>
<span id="591">591</span>
<span id="592">592</span>
<span id="593">593</span>
<span id="594">594</span>
<span id="595">595</span>
<span id="596">596</span>
<span id="597">597</span>
<span id="598">598</span>
<span id="599">599</span>
<span id="600">600</span>
<span id="601">601</span>
<span id="602">602</span>
<span id="603">603</span>
<span id="604">604</span>
<span id="605">605</span>
<span id="606">606</span>
<span id="607">607</span>
<span id="608">608</span>
<span id="609">609</span>
<span id="610">610</span>
<span id="611">611</span>
<span id="612">612</span>
<span id="613">613</span>
<span id="614">614</span>
<span id="615">615</span>
<span id="616">616</span>
<span id="617">617</span>
<span id="618">618</span>
<span id="619">619</span>
<span id="620">620</span>
<span id="621">621</span>
<span id="622">622</span>
<span id="623">623</span>
<span id="624">624</span>
<span id="625">625</span>
<span id="626">626</span>
<span id="627">627</span>
<span id="628">628</span>
<span id="629">629</span>
<span id="630">630</span>
<span id="631">631</span>
<span id="632">632</span>
<span id="633">633</span>
<span id="634">634</span>
<span id="635">635</span>
<span id="636">636</span>
<span id="637">637</span>
<span id="638">638</span>
<span id="639">639</span>
<span id="640">640</span>
<span id="641">641</span>
<span id="642">642</span>
<span id="643">643</span>
<span id="644">644</span>
<span id="645">645</span>
<span id="646">646</span>
<span id="647">647</span>
<span id="648">648</span>
<span id="649">649</span>
<span id="650">650</span>
<span id="651">651</span>
<span id="652">652</span>
<span id="653">653</span>
<span id="654">654</span>
<span id="655">655</span>
<span id="656">656</span>
<span id="657">657</span>
<span id="658">658</span>
<span id="659">659</span>
<span id="660">660</span>
<span id="661">661</span>
<span id="662">662</span>
<span id="663">663</span>
<span id="664">664</span>
<span id="665">665</span>
<span id="666">666</span>
<span id="667">667</span>
<span id="668">668</span>
<span id="669">669</span>
<span id="670">670</span>
<span id="671">671</span>
<span id="672">672</span>
<span id="673">673</span>
<span id="674">674</span>
<span id="675">675</span>
<span id="676">676</span>
<span id="677">677</span>
<span id="678">678</span>
<span id="679">679</span>
<span id="680">680</span>
<span id="681">681</span>
<span id="682">682</span>
<span id="683">683</span>
<span id="684">684</span>
<span id="685">685</span>
<span id="686">686</span>
<span id="687">687</span>
<span id="688">688</span>
<span id="689">689</span>
<span id="690">690</span>
<span id="691">691</span>
<span id="692">692</span>
<span id="693">693</span>
<span id="694">694</span>
<span id="695">695</span>
<span id="696">696</span>
<span id="697">697</span>
<span id="698">698</span>
<span id="699">699</span>
<span id="700">700</span>
<span id="701">701</span>
<span id="702">702</span>
<span id="703">703</span>
<span id="704">704</span>
<span id="705">705</span>
<span id="706">706</span>
<span id="707">707</span>
<span id="708">708</span>
<span id="709">709</span>
<span id="710">710</span>
<span id="711">711</span>
<span id="712">712</span>
<span id="713">713</span>
<span id="714">714</span>
<span id="715">715</span>
<span id="716">716</span>
<span id="717">717</span>
<span id="718">718</span>
<span id="719">719</span>
<span id="720">720</span>
<span id="721">721</span>
<span id="722">722</span>
<span id="723">723</span>
<span id="724">724</span>
<span id="725">725</span>
<span id="726">726</span>
<span id="727">727</span>
<span id="728">728</span>
<span id="729">729</span>
<span id="730">730</span>
<span id="731">731</span>
<span id="732">732</span>
<span id="733">733</span>
<span id="734">734</span>
<span id="735">735</span>
<span id="736">736</span>
<span id="737">737</span>
<span id="738">738</span>
<span id="739">739</span>
<span id="740">740</span>
<span id="741">741</span>
<span id="742">742</span>
<span id="743">743</span>
<span id="744">744</span>
<span id="745">745</span>
<span id="746">746</span>
<span id="747">747</span>
<span id="748">748</span>
<span id="749">749</span>
<span id="750">750</span>
<span id="751">751</span>
<span id="752">752</span>
<span id="753">753</span>
<span id="754">754</span>
<span id="755">755</span>
<span id="756">756</span>
<span id="757">757</span>
<span id="758">758</span>
<span id="759">759</span>
<span id="760">760</span>
<span id="761">761</span>
<span id="762">762</span>
<span id="763">763</span>
<span id="764">764</span>
<span id="765">765</span>
<span id="766">766</span>
<span id="767">767</span>
<span id="768">768</span>
<span id="769">769</span>
<span id="770">770</span>
<span id="771">771</span>
<span id="772">772</span>
<span id="773">773</span>
<span id="774">774</span>
<span id="775">775</span>
<span id="776">776</span>
<span id="777">777</span>
<span id="778">778</span>
<span id="779">779</span>
<span id="780">780</span>
<span id="781">781</span>
<span id="782">782</span>
<span id="783">783</span>
<span id="784">784</span>
<span id="785">785</span>
<span id="786">786</span>
<span id="787">787</span>
<span id="788">788</span>
<span id="789">789</span>
<span id="790">790</span>
<span id="791">791</span>
<span id="792">792</span>
<span id="793">793</span>
<span id="794">794</span>
<span id="795">795</span>
<span id="796">796</span>
<span id="797">797</span>
<span id="798">798</span>
<span id="799">799</span>
<span id="800">800</span>
<span id="801">801</span>
<span id="802">802</span>
<span id="803">803</span>
<span id="804">804</span>
<span id="805">805</span>
<span id="806">806</span>
<span id="807">807</span>
<span id="808">808</span>
<span id="809">809</span>
<span id="810">810</span>
<span id="811">811</span>
<span id="812">812</span>
<span id="813">813</span>
<span id="814">814</span>
<span id="815">815</span>
<span id="816">816</span>
<span id="817">817</span>
<span id="818">818</span>
<span id="819">819</span>
<span id="820">820</span>
<span id="821">821</span>
<span id="822">822</span>
<span id="823">823</span>
<span id="824">824</span>
<span id="825">825</span>
<span id="826">826</span>
<span id="827">827</span>
<span id="828">828</span>
<span id="829">829</span>
<span id="830">830</span>
<span id="831">831</span>
<span id="832">832</span>
<span id="833">833</span>
<span id="834">834</span>
<span id="835">835</span>
<span id="836">836</span>
<span id="837">837</span>
<span id="838">838</span>
<span id="839">839</span>
<span id="840">840</span>
<span id="841">841</span>
<span id="842">842</span>
<span id="843">843</span>
<span id="844">844</span>
<span id="845">845</span>
<span id="846">846</span>
<span id="847">847</span>
<span id="848">848</span>
<span id="849">849</span>
<span id="850">850</span>
<span id="851">851</span>
<span id="852">852</span>
<span id="853">853</span>
<span id="854">854</span>
<span id="855">855</span>
<span id="856">856</span>
<span id="857">857</span>
<span id="858">858</span>
<span id="859">859</span>
<span id="860">860</span>
<span id="861">861</span>
<span id="862">862</span>
<span id="863">863</span>
<span id="864">864</span>
<span id="865">865</span>
<span id="866">866</span>
<span id="867">867</span>
<span id="868">868</span>
<span id="869">869</span>
<span id="870">870</span>
<span id="871">871</span>
<span id="872">872</span>
<span id="873">873</span>
<span id="874">874</span>
<span id="875">875</span>
<span id="876">876</span>
<span id="877">877</span>
<span id="878">878</span>
<span id="879">879</span>
<span id="880">880</span>
<span id="881">881</span>
<span id="882">882</span>
<span id="883">883</span>
<span id="884">884</span>
<span id="885">885</span>
<span id="886">886</span>
<span id="887">887</span>
<span id="888">888</span>
<span id="889">889</span>
<span id="890">890</span>
<span id="891">891</span>
<span id="892">892</span>
<span id="893">893</span>
<span id="894">894</span>
<span id="895">895</span>
<span id="896">896</span>
<span id="897">897</span>
<span id="898">898</span>
<span id="899">899</span>
<span id="900">900</span>
<span id="901">901</span>
<span id="902">902</span>
<span id="903">903</span>
<span id="904">904</span>
<span id="905">905</span>
<span id="906">906</span>
<span id="907">907</span>
<span id="908">908</span>
<span id="909">909</span>
<span id="910">910</span>
<span id="911">911</span>
<span id="912">912</span>
<span id="913">913</span>
<span id="914">914</span>
<span id="915">915</span>
<span id="916">916</span>
<span id="917">917</span>
<span id="918">918</span>
<span id="919">919</span>
<span id="920">920</span>
<span id="921">921</span>
<span id="922">922</span>
<span id="923">923</span>
<span id="924">924</span>
<span id="925">925</span>
<span id="926">926</span>
<span id="927">927</span>
<span id="928">928</span>
<span id="929">929</span>
<span id="930">930</span>
<span id="931">931</span>
<span id="932">932</span>
<span id="933">933</span>
<span id="934">934</span>
<span id="935">935</span>
<span id="936">936</span>
<span id="937">937</span>
<span id="938">938</span>
<span id="939">939</span>
<span id="940">940</span>
<span id="941">941</span>
<span id="942">942</span>
<span id="943">943</span>
<span id="944">944</span>
<span id="945">945</span>
<span id="946">946</span>
<span id="947">947</span>
<span id="948">948</span>
<span id="949">949</span>
<span id="950">950</span>
<span id="951">951</span>
<span id="952">952</span>
<span id="953">953</span>
<span id="954">954</span>
<span id="955">955</span>
<span id="956">956</span>
<span id="957">957</span>
<span id="958">958</span>
<span id="959">959</span>
<span id="960">960</span>
<span id="961">961</span>
<span id="962">962</span>
<span id="963">963</span>
<span id="964">964</span>
<span id="965">965</span>
<span id="966">966</span>
<span id="967">967</span>
<span id="968">968</span>
<span id="969">969</span>
<span id="970">970</span>
<span id="971">971</span>
<span id="972">972</span>
<span id="973">973</span>
<span id="974">974</span>
<span id="975">975</span>
<span id="976">976</span>
<span id="977">977</span>
<span id="978">978</span>
<span id="979">979</span>
<span id="980">980</span>
<span id="981">981</span>
<span id="982">982</span>
<span id="983">983</span>
<span id="984">984</span>
<span id="985">985</span>
<span id="986">986</span>
<span id="987">987</span>
<span id="988">988</span>
<span id="989">989</span>
<span id="990">990</span>
<span id="991">991</span>
<span id="992">992</span>
<span id="993">993</span>
<span id="994">994</span>
<span id="995">995</span>
<span id="996">996</span>
<span id="997">997</span>
<span id="998">998</span>
<span id="999">999</span>
<span id="1000">1000</span>
<span id="1001">1001</span>
<span id="1002">1002</span>
<span id="1003">1003</span>
<span id="1004">1004</span>
<span id="1005">1005</span>
<span id="1006">1006</span>
<span id="1007">1007</span>
<span id="1008">1008</span>
<span id="1009">1009</span>
<span id="1010">1010</span>
<span id="1011">1011</span>
<span id="1012">1012</span>
<span id="1013">1013</span>
<span id="1014">1014</span>
<span id="1015">1015</span>
<span id="1016">1016</span>
<span id="1017">1017</span>
<span id="1018">1018</span>
<span id="1019">1019</span>
<span id="1020">1020</span>
<span id="1021">1021</span>
<span id="1022">1022</span>
<span id="1023">1023</span>
<span id="1024">1024</span>
<span id="1025">1025</span>
<span id="1026">1026</span>
<span id="1027">1027</span>
<span id="1028">1028</span>
<span id="1029">1029</span>
<span id="1030">1030</span>
<span id="1031">1031</span>
<span id="1032">1032</span>
<span id="1033">1033</span>
<span id="1034">1034</span>
<span id="1035">1035</span>
<span id="1036">1036</span>
<span id="1037">1037</span>
<span id="1038">1038</span>
<span id="1039">1039</span>
<span id="1040">1040</span>
<span id="1041">1041</span>
<span id="1042">1042</span>
<span id="1043">1043</span>
<span id="1044">1044</span>
<span id="1045">1045</span>
<span id="1046">1046</span>
<span id="1047">1047</span>
<span id="1048">1048</span>
<span id="1049">1049</span>
<span id="1050">1050</span>
<span id="1051">1051</span>
<span id="1052">1052</span>
<span id="1053">1053</span>
<span id="1054">1054</span>
<span id="1055">1055</span>
<span id="1056">1056</span>
<span id="1057">1057</span>
<span id="1058">1058</span>
<span id="1059">1059</span>
<span id="1060">1060</span>
<span id="1061">1061</span>
<span id="1062">1062</span>
<span id="1063">1063</span>
<span id="1064">1064</span>
<span id="1065">1065</span>
<span id="1066">1066</span>
<span id="1067">1067</span>
<span id="1068">1068</span>
<span id="1069">1069</span>
<span id="1070">1070</span>
<span id="1071">1071</span>
<span id="1072">1072</span>
<span id="1073">1073</span>
<span id="1074">1074</span>
<span id="1075">1075</span>
<span id="1076">1076</span>
<span id="1077">1077</span>
<span id="1078">1078</span>
<span id="1079">1079</span>
<span id="1080">1080</span>
<span id="1081">1081</span>
<span id="1082">1082</span>
<span id="1083">1083</span>
<span id="1084">1084</span>
<span id="1085">1085</span>
<span id="1086">1086</span>
<span id="1087">1087</span>
<span id="1088">1088</span>
<span id="1089">1089</span>
<span id="1090">1090</span>
<span id="1091">1091</span>
<span id="1092">1092</span>
<span id="1093">1093</span>
<span id="1094">1094</span>
<span id="1095">1095</span>
<span id="1096">1096</span>
<span id="1097">1097</span>
<span id="1098">1098</span>
<span id="1099">1099</span>
<span id="1100">1100</span>
<span id="1101">1101</span>
<span id="1102">1102</span>
<span id="1103">1103</span>
<span id="1104">1104</span>
<span id="1105">1105</span>
<span id="1106">1106</span>
<span id="1107">1107</span>
<span id="1108">1108</span>
<span id="1109">1109</span>
<span id="1110">1110</span>
<span id="1111">1111</span>
<span id="1112">1112</span>
<span id="1113">1113</span>
<span id="1114">1114</span>
<span id="1115">1115</span>
<span id="1116">1116</span>
<span id="1117">1117</span>
<span id="1118">1118</span>
<span id="1119">1119</span>
<span id="1120">1120</span>
<span id="1121">1121</span>
<span id="1122">1122</span>
<span id="1123">1123</span>
<span id="1124">1124</span>
<span id="1125">1125</span>
<span id="1126">1126</span>
<span id="1127">1127</span>
<span id="1128">1128</span>
<span id="1129">1129</span>
<span id="1130">1130</span>
<span id="1131">1131</span>
<span id="1132">1132</span>
<span id="1133">1133</span>
<span id="1134">1134</span>
<span id="1135">1135</span>
<span id="1136">1136</span>
<span id="1137">1137</span>
<span id="1138">1138</span>
<span id="1139">1139</span>
<span id="1140">1140</span>
<span id="1141">1141</span>
<span id="1142">1142</span>
<span id="1143">1143</span>
<span id="1144">1144</span>
<span id="1145">1145</span>
<span id="1146">1146</span>
<span id="1147">1147</span>
<span id="1148">1148</span>
<span id="1149">1149</span>
<span id="1150">1150</span>
<span id="1151">1151</span>
<span id="1152">1152</span>
<span id="1153">1153</span>
<span id="1154">1154</span>
<span id="1155">1155</span>
<span id="1156">1156</span>
<span id="1157">1157</span>
<span id="1158">1158</span>
<span id="1159">1159</span>
<span id="1160">1160</span>
<span id="1161">1161</span>
<span id="1162">1162</span>
<span id="1163">1163</span>
<span id="1164">1164</span>
<span id="1165">1165</span>
<span id="1166">1166</span>
<span id="1167">1167</span>
<span id="1168">1168</span>
<span id="1169">1169</span>
<span id="1170">1170</span>
<span id="1171">1171</span>
<span id="1172">1172</span>
<span id="1173">1173</span>
<span id="1174">1174</span>
<span id="1175">1175</span>
<span id="1176">1176</span>
<span id="1177">1177</span>
<span id="1178">1178</span>
<span id="1179">1179</span>
<span id="1180">1180</span>
<span id="1181">1181</span>
<span id="1182">1182</span>
<span id="1183">1183</span>
<span id="1184">1184</span>
<span id="1185">1185</span>
<span id="1186">1186</span>
<span id="1187">1187</span>
<span id="1188">1188</span>
<span id="1189">1189</span>
<span id="1190">1190</span>
<span id="1191">1191</span>
<span id="1192">1192</span>
<span id="1193">1193</span>
<span id="1194">1194</span>
<span id="1195">1195</span>
<span id="1196">1196</span>
<span id="1197">1197</span>
<span id="1198">1198</span>
<span id="1199">1199</span>
<span id="1200">1200</span>
<span id="1201">1201</span>
<span id="1202">1202</span>
<span id="1203">1203</span>
<span id="1204">1204</span>
<span id="1205">1205</span>
<span id="1206">1206</span>
<span id="1207">1207</span>
<span id="1208">1208</span>
<span id="1209">1209</span>
<span id="1210">1210</span>
<span id="1211">1211</span>
<span id="1212">1212</span>
<span id="1213">1213</span>
<span id="1214">1214</span>
<span id="1215">1215</span>
<span id="1216">1216</span>
<span id="1217">1217</span>
<span id="1218">1218</span>
<span id="1219">1219</span>
<span id="1220">1220</span>
<span id="1221">1221</span>
<span id="1222">1222</span>
<span id="1223">1223</span>
<span id="1224">1224</span>
<span id="1225">1225</span>
<span id="1226">1226</span>
<span id="1227">1227</span>
<span id="1228">1228</span>
<span id="1229">1229</span>
<span id="1230">1230</span>
<span id="1231">1231</span>
<span id="1232">1232</span>
<span id="1233">1233</span>
<span id="1234">1234</span>
<span id="1235">1235</span>
<span id="1236">1236</span>
<span id="1237">1237</span>
<span id="1238">1238</span>
<span id="1239">1239</span>
<span id="1240">1240</span>
<span id="1241">1241</span>
<span id="1242">1242</span>
<span id="1243">1243</span>
<span id="1244">1244</span>
<span id="1245">1245</span>
<span id="1246">1246</span>
<span id="1247">1247</span>
<span id="1248">1248</span>
<span id="1249">1249</span>
<span id="1250">1250</span>
<span id="1251">1251</span>
<span id="1252">1252</span>
<span id="1253">1253</span>
<span id="1254">1254</span>
<span id="1255">1255</span>
<span id="1256">1256</span>
<span id="1257">1257</span>
<span id="1258">1258</span>
<span id="1259">1259</span>
<span id="1260">1260</span>
<span id="1261">1261</span>
<span id="1262">1262</span>
<span id="1263">1263</span>
<span id="1264">1264</span>
<span id="1265">1265</span>
<span id="1266">1266</span>
<span id="1267">1267</span>
<span id="1268">1268</span>
<span id="1269">1269</span>
<span id="1270">1270</span>
<span id="1271">1271</span>
<span id="1272">1272</span>
<span id="1273">1273</span>
<span id="1274">1274</span>
<span id="1275">1275</span>
<span id="1276">1276</span>
<span id="1277">1277</span>
<span id="1278">1278</span>
<span id="1279">1279</span>
<span id="1280">1280</span>
<span id="1281">1281</span>
<span id="1282">1282</span>
<span id="1283">1283</span>
<span id="1284">1284</span>
<span id="1285">1285</span>
<span id="1286">1286</span>
<span id="1287">1287</span>
<span id="1288">1288</span>
<span id="1289">1289</span>
<span id="1290">1290</span>
<span id="1291">1291</span>
<span id="1292">1292</span>
<span id="1293">1293</span>
<span id="1294">1294</span>
<span id="1295">1295</span>
<span id="1296">1296</span>
<span id="1297">1297</span>
<span id="1298">1298</span>
<span id="1299">1299</span>
<span id="1300">1300</span>
<span id="1301">1301</span>
<span id="1302">1302</span>
<span id="1303">1303</span>
<span id="1304">1304</span>
<span id="1305">1305</span>
<span id="1306">1306</span>
<span id="1307">1307</span>
<span id="1308">1308</span>
<span id="1309">1309</span>
<span id="1310">1310</span>
<span id="1311">1311</span>
<span id="1312">1312</span>
<span id="1313">1313</span>
<span id="1314">1314</span>
<span id="1315">1315</span>
<span id="1316">1316</span>
<span id="1317">1317</span>
<span id="1318">1318</span>
<span id="1319">1319</span>
<span id="1320">1320</span>
<span id="1321">1321</span>
<span id="1322">1322</span>
<span id="1323">1323</span>
<span id="1324">1324</span>
<span id="1325">1325</span>
<span id="1326">1326</span>
<span id="1327">1327</span>
<span id="1328">1328</span>
<span id="1329">1329</span>
<span id="1330">1330</span>
<span id="1331">1331</span>
<span id="1332">1332</span>
<span id="1333">1333</span>
<span id="1334">1334</span>
<span id="1335">1335</span>
<span id="1336">1336</span>
<span id="1337">1337</span>
<span id="1338">1338</span>
<span id="1339">1339</span>
<span id="1340">1340</span>
<span id="1341">1341</span>
<span id="1342">1342</span>
<span id="1343">1343</span>
<span id="1344">1344</span>
<span id="1345">1345</span>
<span id="1346">1346</span>
<span id="1347">1347</span>
<span id="1348">1348</span>
<span id="1349">1349</span>
<span id="1350">1350</span>
<span id="1351">1351</span>
<span id="1352">1352</span>
<span id="1353">1353</span>
<span id="1354">1354</span>
<span id="1355">1355</span>
<span id="1356">1356</span>
<span id="1357">1357</span>
<span id="1358">1358</span>
<span id="1359">1359</span>
<span id="1360">1360</span>
<span id="1361">1361</span>
<span id="1362">1362</span>
<span id="1363">1363</span>
<span id="1364">1364</span>
<span id="1365">1365</span>
<span id="1366">1366</span>
<span id="1367">1367</span>
<span id="1368">1368</span>
<span id="1369">1369</span>
<span id="1370">1370</span>
<span id="1371">1371</span>
<span id="1372">1372</span>
<span id="1373">1373</span>
<span id="1374">1374</span>
<span id="1375">1375</span>
<span id="1376">1376</span>
<span id="1377">1377</span>
<span id="1378">1378</span>
<span id="1379">1379</span>
<span id="1380">1380</span>
<span id="1381">1381</span>
<span id="1382">1382</span>
<span id="1383">1383</span>
<span id="1384">1384</span>
<span id="1385">1385</span>
<span id="1386">1386</span>
<span id="1387">1387</span>
<span id="1388">1388</span>
<span id="1389">1389</span>
<span id="1390">1390</span>
<span id="1391">1391</span>
<span id="1392">1392</span>
<span id="1393">1393</span>
<span id="1394">1394</span>
<span id="1395">1395</span>
<span id="1396">1396</span>
<span id="1397">1397</span>
<span id="1398">1398</span>
<span id="1399">1399</span>
<span id="1400">1400</span>
<span id="1401">1401</span>
<span id="1402">1402</span>
<span id="1403">1403</span>
<span id="1404">1404</span>
<span id="1405">1405</span>
<span id="1406">1406</span>
<span id="1407">1407</span>
<span id="1408">1408</span>
<span id="1409">1409</span>
<span id="1410">1410</span>
<span id="1411">1411</span>
<span id="1412">1412</span>
<span id="1413">1413</span>
<span id="1414">1414</span>
<span id="1415">1415</span>
<span id="1416">1416</span>
<span id="1417">1417</span>
<span id="1418">1418</span>
<span id="1419">1419</span>
<span id="1420">1420</span>
<span id="1421">1421</span>
<span id="1422">1422</span>
<span id="1423">1423</span>
<span id="1424">1424</span>
<span id="1425">1425</span>
<span id="1426">1426</span>
<span id="1427">1427</span>
<span id="1428">1428</span>
<span id="1429">1429</span>
<span id="1430">1430</span>
<span id="1431">1431</span>
<span id="1432">1432</span>
<span id="1433">1433</span>
<span id="1434">1434</span>
<span id="1435">1435</span>
<span id="1436">1436</span>
<span id="1437">1437</span>
<span id="1438">1438</span>
<span id="1439">1439</span>
<span id="1440">1440</span>
<span id="1441">1441</span>
<span id="1442">1442</span>
<span id="1443">1443</span>
<span id="1444">1444</span>
<span id="1445">1445</span>
<span id="1446">1446</span>
<span id="1447">1447</span>
<span id="1448">1448</span>
<span id="1449">1449</span>
<span id="1450">1450</span>
<span id="1451">1451</span>
<span id="1452">1452</span>
<span id="1453">1453</span>
<span id="1454">1454</span>
<span id="1455">1455</span>
<span id="1456">1456</span>
<span id="1457">1457</span>
<span id="1458">1458</span>
<span id="1459">1459</span>
<span id="1460">1460</span>
<span id="1461">1461</span>
<span id="1462">1462</span>
<span id="1463">1463</span>
<span id="1464">1464</span>
<span id="1465">1465</span>
<span id="1466">1466</span>
<span id="1467">1467</span>
<span id="1468">1468</span>
<span id="1469">1469</span>
<span id="1470">1470</span>
<span id="1471">1471</span>
<span id="1472">1472</span>
<span id="1473">1473</span>
<span id="1474">1474</span>
<span id="1475">1475</span>
<span id="1476">1476</span>
<span id="1477">1477</span>
<span id="1478">1478</span>
<span id="1479">1479</span>
<span id="1480">1480</span>
<span id="1481">1481</span>
<span id="1482">1482</span>
<span id="1483">1483</span>
<span id="1484">1484</span>
<span id="1485">1485</span>
<span id="1486">1486</span>
<span id="1487">1487</span>
<span id="1488">1488</span>
<span id="1489">1489</span>
<span id="1490">1490</span>
<span id="1491">1491</span>
<span id="1492">1492</span>
<span id="1493">1493</span>
<span id="1494">1494</span>
<span id="1495">1495</span>
<span id="1496">1496</span>
<span id="1497">1497</span>
<span id="1498">1498</span>
<span id="1499">1499</span>
<span id="1500">1500</span>
<span id="1501">1501</span>
<span id="1502">1502</span>
<span id="1503">1503</span>
<span id="1504">1504</span>
<span id="1505">1505</span>
<span id="1506">1506</span>
<span id="1507">1507</span>
<span id="1508">1508</span>
<span id="1509">1509</span>
<span id="1510">1510</span>
<span id="1511">1511</span>
<span id="1512">1512</span>
<span id="1513">1513</span>
<span id="1514">1514</span>
<span id="1515">1515</span>
<span id="1516">1516</span>
<span id="1517">1517</span>
<span id="1518">1518</span>
<span id="1519">1519</span>
<span id="1520">1520</span>
<span id="1521">1521</span>
<span id="1522">1522</span>
<span id="1523">1523</span>
<span id="1524">1524</span>
<span id="1525">1525</span>
<span id="1526">1526</span>
<span id="1527">1527</span>
<span id="1528">1528</span>
<span id="1529">1529</span>
<span id="1530">1530</span>
<span id="1531">1531</span>
<span id="1532">1532</span>
<span id="1533">1533</span>
<span id="1534">1534</span>
<span id="1535">1535</span>
<span id="1536">1536</span>
<span id="1537">1537</span>
<span id="1538">1538</span>
<span id="1539">1539</span>
<span id="1540">1540</span>
<span id="1541">1541</span>
<span id="1542">1542</span>
<span id="1543">1543</span>
<span id="1544">1544</span>
<span id="1545">1545</span>
<span id="1546">1546</span>
<span id="1547">1547</span>
<span id="1548">1548</span>
<span id="1549">1549</span>
<span id="1550">1550</span>
<span id="1551">1551</span>
<span id="1552">1552</span>
<span id="1553">1553</span>
<span id="1554">1554</span>
<span id="1555">1555</span>
<span id="1556">1556</span>
<span id="1557">1557</span>
<span id="1558">1558</span>
<span id="1559">1559</span>
<span id="1560">1560</span>
<span id="1561">1561</span>
<span id="1562">1562</span>
<span id="1563">1563</span>
<span id="1564">1564</span>
<span id="1565">1565</span>
<span id="1566">1566</span>
<span id="1567">1567</span>
<span id="1568">1568</span>
<span id="1569">1569</span>
<span id="1570">1570</span>
<span id="1571">1571</span>
<span id="1572">1572</span>
<span id="1573">1573</span>
<span id="1574">1574</span>
<span id="1575">1575</span>
<span id="1576">1576</span>
<span id="1577">1577</span>
<span id="1578">1578</span>
<span id="1579">1579</span>
<span id="1580">1580</span>
<span id="1581">1581</span>
<span id="1582">1582</span>
<span id="1583">1583</span>
<span id="1584">1584</span>
<span id="1585">1585</span>
<span id="1586">1586</span>
<span id="1587">1587</span>
<span id="1588">1588</span>
<span id="1589">1589</span>
<span id="1590">1590</span>
<span id="1591">1591</span>
<span id="1592">1592</span>
<span id="1593">1593</span>
<span id="1594">1594</span>
<span id="1595">1595</span>
<span id="1596">1596</span>
<span id="1597">1597</span>
<span id="1598">1598</span>
<span id="1599">1599</span>
<span id="1600">1600</span>
<span id="1601">1601</span>
<span id="1602">1602</span>
<span id="1603">1603</span>
<span id="1604">1604</span>
<span id="1605">1605</span>
<span id="1606">1606</span>
<span id="1607">1607</span>
<span id="1608">1608</span>
<span id="1609">1609</span>
<span id="1610">1610</span>
<span id="1611">1611</span>
<span id="1612">1612</span>
<span id="1613">1613</span>
<span id="1614">1614</span>
<span id="1615">1615</span>
<span id="1616">1616</span>
<span id="1617">1617</span>
<span id="1618">1618</span>
<span id="1619">1619</span>
<span id="1620">1620</span>
<span id="1621">1621</span>
<span id="1622">1622</span>
<span id="1623">1623</span>
<span id="1624">1624</span>
<span id="1625">1625</span>
<span id="1626">1626</span>
<span id="1627">1627</span>
<span id="1628">1628</span>
<span id="1629">1629</span>
<span id="1630">1630</span>
<span id="1631">1631</span>
<span id="1632">1632</span>
<span id="1633">1633</span>
<span id="1634">1634</span>
<span id="1635">1635</span>
<span id="1636">1636</span>
<span id="1637">1637</span>
<span id="1638">1638</span>
<span id="1639">1639</span>
<span id="1640">1640</span>
<span id="1641">1641</span>
<span id="1642">1642</span>
<span id="1643">1643</span>
<span id="1644">1644</span>
<span id="1645">1645</span>
<span id="1646">1646</span>
<span id="1647">1647</span>
<span id="1648">1648</span>
<span id="1649">1649</span>
<span id="1650">1650</span>
<span id="1651">1651</span>
<span id="1652">1652</span>
<span id="1653">1653</span>
<span id="1654">1654</span>
<span id="1655">1655</span>
<span id="1656">1656</span>
<span id="1657">1657</span>
<span id="1658">1658</span>
<span id="1659">1659</span>
<span id="1660">1660</span>
<span id="1661">1661</span>
<span id="1662">1662</span>
<span id="1663">1663</span>
<span id="1664">1664</span>
<span id="1665">1665</span>
<span id="1666">1666</span>
<span id="1667">1667</span>
<span id="1668">1668</span>
<span id="1669">1669</span>
<span id="1670">1670</span>
<span id="1671">1671</span>
<span id="1672">1672</span>
<span id="1673">1673</span>
<span id="1674">1674</span>
<span id="1675">1675</span>
<span id="1676">1676</span>
<span id="1677">1677</span>
<span id="1678">1678</span>
<span id="1679">1679</span>
<span id="1680">1680</span>
<span id="1681">1681</span>
<span id="1682">1682</span>
<span id="1683">1683</span>
<span id="1684">1684</span>
<span id="1685">1685</span>
<span id="1686">1686</span>
<span id="1687">1687</span>
<span id="1688">1688</span>
<span id="1689">1689</span>
<span id="1690">1690</span>
<span id="1691">1691</span>
<span id="1692">1692</span>
<span id="1693">1693</span>
<span id="1694">1694</span>
<span id="1695">1695</span>
<span id="1696">1696</span>
<span id="1697">1697</span>
<span id="1698">1698</span>
<span id="1699">1699</span>
<span id="1700">1700</span>
<span id="1701">1701</span>
<span id="1702">1702</span>
<span id="1703">1703</span>
<span id="1704">1704</span>
<span id="1705">1705</span>
<span id="1706">1706</span>
<span id="1707">1707</span>
<span id="1708">1708</span>
<span id="1709">1709</span>
<span id="1710">1710</span>
<span id="1711">1711</span>
<span id="1712">1712</span>
<span id="1713">1713</span>
<span id="1714">1714</span>
<span id="1715">1715</span>
<span id="1716">1716</span>
<span id="1717">1717</span>
<span id="1718">1718</span>
<span id="1719">1719</span>
<span id="1720">1720</span>
<span id="1721">1721</span>
<span id="1722">1722</span>
<span id="1723">1723</span>
<span id="1724">1724</span>
<span id="1725">1725</span>
<span id="1726">1726</span>
<span id="1727">1727</span>
<span id="1728">1728</span>
<span id="1729">1729</span>
<span id="1730">1730</span>
<span id="1731">1731</span>
<span id="1732">1732</span>
<span id="1733">1733</span>
<span id="1734">1734</span>
<span id="1735">1735</span>
<span id="1736">1736</span>
<span id="1737">1737</span>
<span id="1738">1738</span>
<span id="1739">1739</span>
<span id="1740">1740</span>
<span id="1741">1741</span>
<span id="1742">1742</span>
<span id="1743">1743</span>
<span id="1744">1744</span>
<span id="1745">1745</span>
<span id="1746">1746</span>
<span id="1747">1747</span>
<span id="1748">1748</span>
<span id="1749">1749</span>
<span id="1750">1750</span>
<span id="1751">1751</span>
<span id="1752">1752</span>
<span id="1753">1753</span>
<span id="1754">1754</span>
<span id="1755">1755</span>
<span id="1756">1756</span>
<span id="1757">1757</span>
<span id="1758">1758</span>
<span id="1759">1759</span>
<span id="1760">1760</span>
<span id="1761">1761</span>
<span id="1762">1762</span>
<span id="1763">1763</span>
<span id="1764">1764</span>
<span id="1765">1765</span>
<span id="1766">1766</span>
<span id="1767">1767</span>
<span id="1768">1768</span>
<span id="1769">1769</span>
<span id="1770">1770</span>
<span id="1771">1771</span>
<span id="1772">1772</span>
<span id="1773">1773</span>
<span id="1774">1774</span>
<span id="1775">1775</span>
<span id="1776">1776</span>
<span id="1777">1777</span>
<span id="1778">1778</span>
<span id="1779">1779</span>
<span id="1780">1780</span>
<span id="1781">1781</span>
<span id="1782">1782</span>
<span id="1783">1783</span>
<span id="1784">1784</span>
<span id="1785">1785</span>
<span id="1786">1786</span>
<span id="1787">1787</span>
<span id="1788">1788</span>
<span id="1789">1789</span>
<span id="1790">1790</span>
<span id="1791">1791</span>
<span id="1792">1792</span>
<span id="1793">1793</span>
<span id="1794">1794</span>
<span id="1795">1795</span>
<span id="1796">1796</span>
<span id="1797">1797</span>
<span id="1798">1798</span>
<span id="1799">1799</span>
<span id="1800">1800</span>
<span id="1801">1801</span>
<span id="1802">1802</span>
<span id="1803">1803</span>
<span id="1804">1804</span>
<span id="1805">1805</span>
<span id="1806">1806</span>
<span id="1807">1807</span>
<span id="1808">1808</span>
<span id="1809">1809</span>
<span id="1810">1810</span>
<span id="1811">1811</span>
<span id="1812">1812</span>
<span id="1813">1813</span>
<span id="1814">1814</span>
<span id="1815">1815</span>
<span id="1816">1816</span>
<span id="1817">1817</span>
<span id="1818">1818</span>
<span id="1819">1819</span>
<span id="1820">1820</span>
<span id="1821">1821</span>
<span id="1822">1822</span>
<span id="1823">1823</span>
<span id="1824">1824</span>
<span id="1825">1825</span>
<span id="1826">1826</span>
<span id="1827">1827</span>
<span id="1828">1828</span>
<span id="1829">1829</span>
<span id="1830">1830</span>
<span id="1831">1831</span>
<span id="1832">1832</span>
<span id="1833">1833</span>
<span id="1834">1834</span>
<span id="1835">1835</span>
<span id="1836">1836</span>
<span id="1837">1837</span>
<span id="1838">1838</span>
<span id="1839">1839</span>
<span id="1840">1840</span>
<span id="1841">1841</span>
<span id="1842">1842</span>
<span id="1843">1843</span>
<span id="1844">1844</span>
<span id="1845">1845</span>
<span id="1846">1846</span>
<span id="1847">1847</span>
<span id="1848">1848</span>
<span id="1849">1849</span>
<span id="1850">1850</span>
<span id="1851">1851</span>
<span id="1852">1852</span>
<span id="1853">1853</span>
<span id="1854">1854</span>
<span id="1855">1855</span>
<span id="1856">1856</span>
<span id="1857">1857</span>
<span id="1858">1858</span>
<span id="1859">1859</span>
<span id="1860">1860</span>
<span id="1861">1861</span>
<span id="1862">1862</span>
<span id="1863">1863</span>
<span id="1864">1864</span>
<span id="1865">1865</span>
<span id="1866">1866</span>
<span id="1867">1867</span>
<span id="1868">1868</span>
<span id="1869">1869</span>
<span id="1870">1870</span>
<span id="1871">1871</span>
<span id="1872">1872</span>
<span id="1873">1873</span>
<span id="1874">1874</span>
<span id="1875">1875</span>
<span id="1876">1876</span>
<span id="1877">1877</span>
<span id="1878">1878</span>
<span id="1879">1879</span>
<span id="1880">1880</span>
<span id="1881">1881</span>
<span id="1882">1882</span>
<span id="1883">1883</span>
<span id="1884">1884</span>
<span id="1885">1885</span>
<span id="1886">1886</span>
<span id="1887">1887</span>
<span id="1888">1888</span>
<span id="1889">1889</span>
<span id="1890">1890</span>
<span id="1891">1891</span>
<span id="1892">1892</span>
<span id="1893">1893</span>
<span id="1894">1894</span>
<span id="1895">1895</span>
<span id="1896">1896</span>
<span id="1897">1897</span>
<span id="1898">1898</span>
<span id="1899">1899</span>
<span id="1900">1900</span>
<span id="1901">1901</span>
<span id="1902">1902</span>
<span id="1903">1903</span>
<span id="1904">1904</span>
<span id="1905">1905</span>
<span id="1906">1906</span>
<span id="1907">1907</span>
<span id="1908">1908</span>
<span id="1909">1909</span>
<span id="1910">1910</span>
<span id="1911">1911</span>
<span id="1912">1912</span>
<span id="1913">1913</span>
<span id="1914">1914</span>
<span id="1915">1915</span>
<span id="1916">1916</span>
<span id="1917">1917</span>
<span id="1918">1918</span>
<span id="1919">1919</span>
<span id="1920">1920</span>
<span id="1921">1921</span>
<span id="1922">1922</span>
<span id="1923">1923</span>
<span id="1924">1924</span>
<span id="1925">1925</span>
<span id="1926">1926</span>
<span id="1927">1927</span>
<span id="1928">1928</span>
<span id="1929">1929</span>
<span id="1930">1930</span>
<span id="1931">1931</span>
<span id="1932">1932</span>
<span id="1933">1933</span>
<span id="1934">1934</span>
<span id="1935">1935</span>
<span id="1936">1936</span>
<span id="1937">1937</span>
<span id="1938">1938</span>
<span id="1939">1939</span>
<span id="1940">1940</span>
<span id="1941">1941</span>
<span id="1942">1942</span>
<span id="1943">1943</span>
<span id="1944">1944</span>
<span id="1945">1945</span>
<span id="1946">1946</span>
<span id="1947">1947</span>
<span id="1948">1948</span>
<span id="1949">1949</span>
<span id="1950">1950</span>
<span id="1951">1951</span>
<span id="1952">1952</span>
<span id="1953">1953</span>
<span id="1954">1954</span>
<span id="1955">1955</span>
<span id="1956">1956</span>
<span id="1957">1957</span>
<span id="1958">1958</span>
<span id="1959">1959</span>
<span id="1960">1960</span>
<span id="1961">1961</span>
<span id="1962">1962</span>
<span id="1963">1963</span>
<span id="1964">1964</span>
<span id="1965">1965</span>
<span id="1966">1966</span>
<span id="1967">1967</span>
<span id="1968">1968</span>
<span id="1969">1969</span>
<span id="1970">1970</span>
<span id="1971">1971</span>
<span id="1972">1972</span>
<span id="1973">1973</span>
<span id="1974">1974</span>
<span id="1975">1975</span>
<span id="1976">1976</span>
<span id="1977">1977</span>
<span id="1978">1978</span>
<span id="1979">1979</span>
<span id="1980">1980</span>
<span id="1981">1981</span>
<span id="1982">1982</span>
<span id="1983">1983</span>
<span id="1984">1984</span>
<span id="1985">1985</span>
<span id="1986">1986</span>
<span id="1987">1987</span>
<span id="1988">1988</span>
<span id="1989">1989</span>
<span id="1990">1990</span>
<span id="1991">1991</span>
<span id="1992">1992</span>
<span id="1993">1993</span>
<span id="1994">1994</span>
<span id="1995">1995</span>
<span id="1996">1996</span>
<span id="1997">1997</span>
<span id="1998">1998</span>
<span id="1999">1999</span>
<span id="2000">2000</span>
<span id="2001">2001</span>
<span id="2002">2002</span>
<span id="2003">2003</span>
<span id="2004">2004</span>
<span id="2005">2005</span>
<span id="2006">2006</span>
<span id="2007">2007</span>
<span id="2008">2008</span>
<span id="2009">2009</span>
<span id="2010">2010</span>
<span id="2011">2011</span>
<span id="2012">2012</span>
<span id="2013">2013</span>
<span id="2014">2014</span>
<span id="2015">2015</span>
<span id="2016">2016</span>
<span id="2017">2017</span>
<span id="2018">2018</span>
<span id="2019">2019</span>
<span id="2020">2020</span>
<span id="2021">2021</span>
<span id="2022">2022</span>
<span id="2023">2023</span>
<span id="2024">2024</span>
<span id="2025">2025</span>
<span id="2026">2026</span>
<span id="2027">2027</span>
<span id="2028">2028</span>
<span id="2029">2029</span>
<span id="2030">2030</span>
<span id="2031">2031</span>
<span id="2032">2032</span>
<span id="2033">2033</span>
<span id="2034">2034</span>
<span id="2035">2035</span>
<span id="2036">2036</span>
<span id="2037">2037</span>
<span id="2038">2038</span>
<span id="2039">2039</span>
<span id="2040">2040</span>
<span id="2041">2041</span>
<span id="2042">2042</span>
<span id="2043">2043</span>
<span id="2044">2044</span>
<span id="2045">2045</span>
<span id="2046">2046</span>
<span id="2047">2047</span>
<span id="2048">2048</span>
<span id="2049">2049</span>
<span id="2050">2050</span>
<span id="2051">2051</span>
<span id="2052">2052</span>
<span id="2053">2053</span>
<span id="2054">2054</span>
<span id="2055">2055</span>
<span id="2056">2056</span>
<span id="2057">2057</span>
<span id="2058">2058</span>
<span id="2059">2059</span>
<span id="2060">2060</span>
<span id="2061">2061</span>
<span id="2062">2062</span>
<span id="2063">2063</span>
<span id="2064">2064</span>
<span id="2065">2065</span>
<span id="2066">2066</span>
<span id="2067">2067</span>
<span id="2068">2068</span>
<span id="2069">2069</span>
<span id="2070">2070</span>
<span id="2071">2071</span>
<span id="2072">2072</span>
<span id="2073">2073</span>
<span id="2074">2074</span>
<span id="2075">2075</span>
<span id="2076">2076</span>
<span id="2077">2077</span>
<span id="2078">2078</span>
<span id="2079">2079</span>
<span id="2080">2080</span>
<span id="2081">2081</span>
<span id="2082">2082</span>
<span id="2083">2083</span>
<span id="2084">2084</span>
<span id="2085">2085</span>
<span id="2086">2086</span>
<span id="2087">2087</span>
<span id="2088">2088</span>
<span id="2089">2089</span>
<span id="2090">2090</span>
<span id="2091">2091</span>
<span id="2092">2092</span>
<span id="2093">2093</span>
<span id="2094">2094</span>
<span id="2095">2095</span>
<span id="2096">2096</span>
<span id="2097">2097</span>
<span id="2098">2098</span>
<span id="2099">2099</span>
<span id="2100">2100</span>
<span id="2101">2101</span>
<span id="2102">2102</span>
<span id="2103">2103</span>
<span id="2104">2104</span>
<span id="2105">2105</span>
<span id="2106">2106</span>
<span id="2107">2107</span>
<span id="2108">2108</span>
<span id="2109">2109</span>
<span id="2110">2110</span>
<span id="2111">2111</span>
<span id="2112">2112</span>
<span id="2113">2113</span>
<span id="2114">2114</span>
<span id="2115">2115</span>
<span id="2116">2116</span>
<span id="2117">2117</span>
<span id="2118">2118</span>
<span id="2119">2119</span>
<span id="2120">2120</span>
<span id="2121">2121</span>
<span id="2122">2122</span>
<span id="2123">2123</span>
<span id="2124">2124</span>
<span id="2125">2125</span>
<span id="2126">2126</span>
<span id="2127">2127</span>
<span id="2128">2128</span>
<span id="2129">2129</span>
<span id="2130">2130</span>
<span id="2131">2131</span>
<span id="2132">2132</span>
<span id="2133">2133</span>
<span id="2134">2134</span>
<span id="2135">2135</span>
<span id="2136">2136</span>
<span id="2137">2137</span>
<span id="2138">2138</span>
<span id="2139">2139</span>
<span id="2140">2140</span>
<span id="2141">2141</span>
<span id="2142">2142</span>
<span id="2143">2143</span>
<span id="2144">2144</span>
<span id="2145">2145</span>
<span id="2146">2146</span>
<span id="2147">2147</span>
<span id="2148">2148</span>
<span id="2149">2149</span>
<span id="2150">2150</span>
<span id="2151">2151</span>
<span id="2152">2152</span>
<span id="2153">2153</span>
<span id="2154">2154</span>
<span id="2155">2155</span>
<span id="2156">2156</span>
<span id="2157">2157</span>
<span id="2158">2158</span>
<span id="2159">2159</span>
<span id="2160">2160</span>
<span id="2161">2161</span>
<span id="2162">2162</span>
<span id="2163">2163</span>
<span id="2164">2164</span>
<span id="2165">2165</span>
<span id="2166">2166</span>
<span id="2167">2167</span>
<span id="2168">2168</span>
<span id="2169">2169</span>
<span id="2170">2170</span>
<span id="2171">2171</span>
<span id="2172">2172</span>
<span id="2173">2173</span>
<span id="2174">2174</span>
<span id="2175">2175</span>
<span id="2176">2176</span>
<span id="2177">2177</span>
<span id="2178">2178</span>
<span id="2179">2179</span>
<span id="2180">2180</span>
<span id="2181">2181</span>
<span id="2182">2182</span>
<span id="2183">2183</span>
<span id="2184">2184</span>
<span id="2185">2185</span>
<span id="2186">2186</span>
<span id="2187">2187</span>
<span id="2188">2188</span>
<span id="2189">2189</span>
<span id="2190">2190</span>
<span id="2191">2191</span>
<span id="2192">2192</span>
<span id="2193">2193</span>
<span id="2194">2194</span>
<span id="2195">2195</span>
<span id="2196">2196</span>
<span id="2197">2197</span>
<span id="2198">2198</span>
<span id="2199">2199</span>
<span id="2200">2200</span>
<span id="2201">2201</span>
<span id="2202">2202</span>
<span id="2203">2203</span>
<span id="2204">2204</span>
<span id="2205">2205</span>
<span id="2206">2206</span>
<span id="2207">2207</span>
<span id="2208">2208</span>
<span id="2209">2209</span>
<span id="2210">2210</span>
<span id="2211">2211</span>
<span id="2212">2212</span>
<span id="2213">2213</span>
<span id="2214">2214</span>
<span id="2215">2215</span>
<span id="2216">2216</span>
<span id="2217">2217</span>
<span id="2218">2218</span>
<span id="2219">2219</span>
<span id="2220">2220</span>
<span id="2221">2221</span>
<span id="2222">2222</span>
<span id="2223">2223</span>
<span id="2224">2224</span>
<span id="2225">2225</span>
<span id="2226">2226</span>
<span id="2227">2227</span>
<span id="2228">2228</span>
<span id="2229">2229</span>
<span id="2230">2230</span>
<span id="2231">2231</span>
<span id="2232">2232</span>
<span id="2233">2233</span>
<span id="2234">2234</span>
<span id="2235">2235</span>
<span id="2236">2236</span>
<span id="2237">2237</span>
<span id="2238">2238</span>
<span id="2239">2239</span>
<span id="2240">2240</span>
<span id="2241">2241</span>
<span id="2242">2242</span>
<span id="2243">2243</span>
<span id="2244">2244</span>
<span id="2245">2245</span>
<span id="2246">2246</span>
<span id="2247">2247</span>
<span id="2248">2248</span>
<span id="2249">2249</span>
<span id="2250">2250</span>
<span id="2251">2251</span>
<span id="2252">2252</span>
<span id="2253">2253</span>
<span id="2254">2254</span>
<span id="2255">2255</span>
<span id="2256">2256</span>
<span id="2257">2257</span>
<span id="2258">2258</span>
<span id="2259">2259</span>
<span id="2260">2260</span>
<span id="2261">2261</span>
<span id="2262">2262</span>
<span id="2263">2263</span>
<span id="2264">2264</span>
<span id="2265">2265</span>
<span id="2266">2266</span>
<span id="2267">2267</span>
<span id="2268">2268</span>
<span id="2269">2269</span>
<span id="2270">2270</span>
<span id="2271">2271</span>
<span id="2272">2272</span>
<span id="2273">2273</span>
<span id="2274">2274</span>
<span id="2275">2275</span>
<span id="2276">2276</span>
<span id="2277">2277</span>
<span id="2278">2278</span>
<span id="2279">2279</span>
<span id="2280">2280</span>
<span id="2281">2281</span>
<span id="2282">2282</span>
<span id="2283">2283</span>
<span id="2284">2284</span>
<span id="2285">2285</span>
<span id="2286">2286</span>
<span id="2287">2287</span>
<span id="2288">2288</span>
<span id="2289">2289</span>
<span id="2290">2290</span>
<span id="2291">2291</span>
<span id="2292">2292</span>
<span id="2293">2293</span>
<span id="2294">2294</span>
<span id="2295">2295</span>
<span id="2296">2296</span>
<span id="2297">2297</span>
<span id="2298">2298</span>
<span id="2299">2299</span>
<span id="2300">2300</span>
<span id="2301">2301</span>
<span id="2302">2302</span>
<span id="2303">2303</span>
<span id="2304">2304</span>
<span id="2305">2305</span>
<span id="2306">2306</span>
<span id="2307">2307</span>
<span id="2308">2308</span>
<span id="2309">2309</span>
<span id="2310">2310</span>
<span id="2311">2311</span>
<span id="2312">2312</span>
<span id="2313">2313</span>
<span id="2314">2314</span>
<span id="2315">2315</span>
<span id="2316">2316</span>
<span id="2317">2317</span>
<span id="2318">2318</span>
<span id="2319">2319</span>
<span id="2320">2320</span>
<span id="2321">2321</span>
<span id="2322">2322</span>
<span id="2323">2323</span>
<span id="2324">2324</span>
<span id="2325">2325</span>
<span id="2326">2326</span>
<span id="2327">2327</span>
<span id="2328">2328</span>
<span id="2329">2329</span>
<span id="2330">2330</span>
<span id="2331">2331</span>
<span id="2332">2332</span>
<span id="2333">2333</span>
<span id="2334">2334</span>
<span id="2335">2335</span>
<span id="2336">2336</span>
<span id="2337">2337</span>
<span id="2338">2338</span>
<span id="2339">2339</span>
<span id="2340">2340</span>
<span id="2341">2341</span>
<span id="2342">2342</span>
<span id="2343">2343</span>
<span id="2344">2344</span>
<span id="2345">2345</span>
<span id="2346">2346</span>
<span id="2347">2347</span>
<span id="2348">2348</span>
<span id="2349">2349</span>
<span id="2350">2350</span>
<span id="2351">2351</span>
<span id="2352">2352</span>
<span id="2353">2353</span>
<span id="2354">2354</span>
<span id="2355">2355</span>
<span id="2356">2356</span>
<span id="2357">2357</span>
<span id="2358">2358</span>
<span id="2359">2359</span>
<span id="2360">2360</span>
<span id="2361">2361</span>
<span id="2362">2362</span>
<span id="2363">2363</span>
<span id="2364">2364</span>
<span id="2365">2365</span>
<span id="2366">2366</span>
<span id="2367">2367</span>
<span id="2368">2368</span>
<span id="2369">2369</span>
<span id="2370">2370</span>
<span id="2371">2371</span>
<span id="2372">2372</span>
<span id="2373">2373</span>
<span id="2374">2374</span>
<span id="2375">2375</span>
<span id="2376">2376</span>
<span id="2377">2377</span>
<span id="2378">2378</span>
<span id="2379">2379</span>
<span id="2380">2380</span>
<span id="2381">2381</span>
<span id="2382">2382</span>
<span id="2383">2383</span>
<span id="2384">2384</span>
<span id="2385">2385</span>
<span id="2386">2386</span>
<span id="2387">2387</span>
<span id="2388">2388</span>
<span id="2389">2389</span>
<span id="2390">2390</span>
<span id="2391">2391</span>
<span id="2392">2392</span>
<span id="2393">2393</span>
<span id="2394">2394</span>
<span id="2395">2395</span>
<span id="2396">2396</span>
<span id="2397">2397</span>
<span id="2398">2398</span>
<span id="2399">2399</span>
<span id="2400">2400</span>
<span id="2401">2401</span>
<span id="2402">2402</span>
<span id="2403">2403</span>
<span id="2404">2404</span>
<span id="2405">2405</span>
<span id="2406">2406</span>
<span id="2407">2407</span>
<span id="2408">2408</span>
<span id="2409">2409</span>
<span id="2410">2410</span>
<span id="2411">2411</span>
<span id="2412">2412</span>
<span id="2413">2413</span>
<span id="2414">2414</span>
<span id="2415">2415</span>
<span id="2416">2416</span>
<span id="2417">2417</span>
<span id="2418">2418</span>
<span id="2419">2419</span>
<span id="2420">2420</span>
<span id="2421">2421</span>
<span id="2422">2422</span>
<span id="2423">2423</span>
<span id="2424">2424</span>
<span id="2425">2425</span>
<span id="2426">2426</span>
<span id="2427">2427</span>
<span id="2428">2428</span>
<span id="2429">2429</span>
<span id="2430">2430</span>
<span id="2431">2431</span>
<span id="2432">2432</span>
<span id="2433">2433</span>
<span id="2434">2434</span>
<span id="2435">2435</span>
<span id="2436">2436</span>
<span id="2437">2437</span>
<span id="2438">2438</span>
<span id="2439">2439</span>
<span id="2440">2440</span>
<span id="2441">2441</span>
<span id="2442">2442</span>
<span id="2443">2443</span>
<span id="2444">2444</span>
<span id="2445">2445</span>
<span id="2446">2446</span>
<span id="2447">2447</span>
<span id="2448">2448</span>
<span id="2449">2449</span>
<span id="2450">2450</span>
<span id="2451">2451</span>
<span id="2452">2452</span>
<span id="2453">2453</span>
<span id="2454">2454</span>
<span id="2455">2455</span>
<span id="2456">2456</span>
<span id="2457">2457</span>
<span id="2458">2458</span>
<span id="2459">2459</span>
<span id="2460">2460</span>
<span id="2461">2461</span>
<span id="2462">2462</span>
<span id="2463">2463</span>
<span id="2464">2464</span>
<span id="2465">2465</span>
<span id="2466">2466</span>
<span id="2467">2467</span>
<span id="2468">2468</span>
<span id="2469">2469</span>
<span id="2470">2470</span>
<span id="2471">2471</span>
<span id="2472">2472</span>
<span id="2473">2473</span>
<span id="2474">2474</span>
<span id="2475">2475</span>
<span id="2476">2476</span>
<span id="2477">2477</span>
<span id="2478">2478</span>
<span id="2479">2479</span>
<span id="2480">2480</span>
<span id="2481">2481</span>
<span id="2482">2482</span>
<span id="2483">2483</span>
<span id="2484">2484</span>
<span id="2485">2485</span>
<span id="2486">2486</span>
<span id="2487">2487</span>
<span id="2488">2488</span>
<span id="2489">2489</span>
<span id="2490">2490</span>
<span id="2491">2491</span>
<span id="2492">2492</span>
<span id="2493">2493</span>
<span id="2494">2494</span>
<span id="2495">2495</span>
<span id="2496">2496</span>
<span id="2497">2497</span>
<span id="2498">2498</span>
<span id="2499">2499</span>
<span id="2500">2500</span>
<span id="2501">2501</span>
<span id="2502">2502</span>
<span id="2503">2503</span>
<span id="2504">2504</span>
<span id="2505">2505</span>
<span id="2506">2506</span>
<span id="2507">2507</span>
<span id="2508">2508</span>
<span id="2509">2509</span>
<span id="2510">2510</span>
<span id="2511">2511</span>
<span id="2512">2512</span>
<span id="2513">2513</span>
<span id="2514">2514</span>
<span id="2515">2515</span>
<span id="2516">2516</span>
<span id="2517">2517</span>
<span id="2518">2518</span>
<span id="2519">2519</span>
<span id="2520">2520</span>
<span id="2521">2521</span>
<span id="2522">2522</span>
<span id="2523">2523</span>
<span id="2524">2524</span>
<span id="2525">2525</span>
<span id="2526">2526</span>
<span id="2527">2527</span>
<span id="2528">2528</span>
<span id="2529">2529</span>
<span id="2530">2530</span>
<span id="2531">2531</span>
<span id="2532">2532</span>
<span id="2533">2533</span>
<span id="2534">2534</span>
<span id="2535">2535</span>
<span id="2536">2536</span>
<span id="2537">2537</span>
<span id="2538">2538</span>
<span id="2539">2539</span>
<span id="2540">2540</span>
<span id="2541">2541</span>
<span id="2542">2542</span>
<span id="2543">2543</span>
<span id="2544">2544</span>
<span id="2545">2545</span>
<span id="2546">2546</span>
<span id="2547">2547</span>
<span id="2548">2548</span>
<span id="2549">2549</span>
<span id="2550">2550</span>
<span id="2551">2551</span>
<span id="2552">2552</span>
<span id="2553">2553</span>
<span id="2554">2554</span>
<span id="2555">2555</span>
<span id="2556">2556</span>
<span id="2557">2557</span>
<span id="2558">2558</span>
<span id="2559">2559</span>
<span id="2560">2560</span>
<span id="2561">2561</span>
<span id="2562">2562</span>
<span id="2563">2563</span>
<span id="2564">2564</span>
<span id="2565">2565</span>
<span id="2566">2566</span>
<span id="2567">2567</span>
<span id="2568">2568</span>
<span id="2569">2569</span>
<span id="2570">2570</span>
<span id="2571">2571</span>
<span id="2572">2572</span>
<span id="2573">2573</span>
<span id="2574">2574</span>
<span id="2575">2575</span>
<span id="2576">2576</span>
<span id="2577">2577</span>
<span id="2578">2578</span>
</pre><pre class="rust"><code><span class="comment">/*
MIT License

Copyright (c) 2021 Germán Molina

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/

</span><span class="kw">use </span><span class="kw">crate</span>::Float;
<span class="comment">/*
    This section was heavily influenced by
    the following source:

    Ruppert, J. (1995). A Delaunay refinement algorithm for quality 2-dimensional mesh generation. J. Algorithms, 18(3), 548-585.

*/

</span><span class="kw">use crate</span>::{Point3D, PointInTriangle, Polygon3D, Segment3D, Triangle3D};

<span class="attribute">#[derive(Clone, Copy, Eq, PartialEq, Debug)]
#[repr(u8)]
</span><span class="kw">enum </span>Edge {
    Ab,
    Bc,
    Ca,
}

<span class="kw">impl </span>Edge {
    <span class="kw">fn </span>from_i(i: usize) -&gt; <span class="self">Self </span>{
        <span class="kw">match </span>i {
            <span class="number">0 </span>=&gt; <span class="self">Self</span>::Ab,
            <span class="number">1 </span>=&gt; <span class="self">Self</span>::Bc,
            <span class="number">2 </span>=&gt; <span class="self">Self</span>::Ca,
            <span class="kw">_ </span>=&gt; {
                <span class="macro">panic!</span>(<span class="string">&quot;Index given for Edge is out of bound (given was {})&quot;</span>, i)
            }
        }
    }

    <span class="kw">fn </span>as_i(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; usize {
        <span class="kw">match </span><span class="self">self </span>{
            <span class="self">Self</span>::Ab =&gt; <span class="number">0</span>,
            <span class="self">Self</span>::Bc =&gt; <span class="number">1</span>,
            <span class="self">Self</span>::Ca =&gt; <span class="number">2</span>,
        }
    }
}

<span class="kw">impl </span>std::ops::Add&lt;usize&gt; <span class="kw">for </span>Edge {
    <span class="kw">type </span>Output = <span class="self">Self</span>;

    <span class="kw">fn </span>add(<span class="self">self</span>, other: usize) -&gt; <span class="self">Self </span>{
        <span class="kw">let </span>i = (<span class="self">self</span>.as_i() + other) % <span class="number">3</span>;
        <span class="self">Self</span>::from_i(i)
    }
}

<span class="attribute">#[derive(Debug, Clone, Copy)]
</span><span class="kw">struct </span>TriPiece {
    triangle: Triangle3D,

    <span class="comment">// Segments
    // s0: Segment3D,
    // s1: Segment3D,
    // s2: Segment3D,

    // Neighbours
    </span>n0: <span class="prelude-ty">Option</span>&lt;usize&gt;,
    n1: <span class="prelude-ty">Option</span>&lt;usize&gt;,
    n2: <span class="prelude-ty">Option</span>&lt;usize&gt;,

    <span class="comment">// Constraints
    </span>c0: bool,
    c1: bool,
    c2: bool,

    <span class="comment">// Other info about the triangle.

    // circumradius: Float,
    </span>aspect_ratio: Float,
    circumcenter: Point3D,
    centroid: Point3D,

    valid: bool,

    <span class="comment">// This will be
    // assigned when pushing it into a
    // triangulation.
    </span>index: usize,
}

<span class="doccomment">/// A set of [`Triangle3D`] that, together, cover completely
/// a [`Polygon3D`].
</span><span class="attribute">#[derive(Debug, Clone)]
</span><span class="kw">pub struct </span>Triangulation3D {
    <span class="doccomment">/// The triangles
    </span>triangles: Vec&lt;TriPiece&gt;,

    <span class="doccomment">/// The number of valid triangles.
    ///
    /// Check whether triangles are valid or not
    /// before using them. Invalidating triangles help
    /// accelerate the algorithms in this module.
    </span>n_valid_triangles: usize,
}

<span class="kw">impl </span>TriPiece {
    <span class="kw">pub fn </span>new(
        vertex_a: Point3D,
        vertex_b: Point3D,
        vertex_c: Point3D,
        i: usize,
    ) -&gt; <span class="prelude-ty">Result</span>&lt;<span class="self">Self</span>, String&gt; {
        <span class="comment">// Build the triangle
        </span><span class="kw">let </span>triangle = Triangle3D::new(vertex_a, vertex_b, vertex_c)<span class="question-mark">?</span>;

        <span class="kw">let </span>t = <span class="self">Self </span>{
            <span class="comment">// s0: Segment3D::new(vertex_a, vertex_b),
            // s1: Segment3D::new(vertex_b, vertex_c),
            // s2: Segment3D::new(vertex_c, vertex_a),
            </span>n0: <span class="prelude-val">None</span>,
            n1: <span class="prelude-val">None</span>,
            n2: <span class="prelude-val">None</span>,

            c0: <span class="bool-val">false</span>,
            c1: <span class="bool-val">false</span>,
            c2: <span class="bool-val">false</span>,

            aspect_ratio: triangle.aspect_ratio(),
            <span class="comment">// circumradius: triangle.circumradius(),
            </span>circumcenter: triangle.circumcenter(),
            centroid: triangle.centroid(),

            index: i,
            valid: <span class="bool-val">true</span>,
            triangle,
        };

        <span class="prelude-val">Ok</span>(t)
    }

    <span class="kw">fn </span>invalidate(<span class="kw-2">&amp;mut </span><span class="self">self</span>) {
        <span class="self">self</span>.valid = <span class="bool-val">false
    </span>}

    <span class="kw">fn </span>set_neighbour(<span class="kw-2">&amp;mut </span><span class="self">self</span>, edge: Edge, i: usize) {
        <span class="kw">match </span>edge {
            Edge::Ab =&gt; <span class="self">self</span>.n0 = <span class="prelude-val">Some</span>(i),
            Edge::Bc =&gt; <span class="self">self</span>.n1 = <span class="prelude-val">Some</span>(i),
            Edge::Ca =&gt; <span class="self">self</span>.n2 = <span class="prelude-val">Some</span>(i),
        }
    }

    <span class="kw">pub fn </span>neighbour(<span class="kw-2">&amp;</span><span class="self">self</span>, edge: Edge) -&gt; <span class="prelude-ty">Option</span>&lt;usize&gt; {
        <span class="kw">match </span>edge {
            Edge::Ab =&gt; <span class="self">self</span>.n0,
            Edge::Bc =&gt; <span class="self">self</span>.n1,
            Edge::Ca =&gt; <span class="self">self</span>.n2,
        }
    }

    <span class="kw">pub fn </span>constrain(<span class="kw-2">&amp;mut </span><span class="self">self</span>, edge: Edge) {
        <span class="kw">match </span>edge {
            Edge::Ab =&gt; <span class="self">self</span>.c0 = <span class="bool-val">true</span>,
            Edge::Bc =&gt; <span class="self">self</span>.c1 = <span class="bool-val">true</span>,
            Edge::Ca =&gt; <span class="self">self</span>.c2 = <span class="bool-val">true</span>,
        }
    }

    <span class="kw">pub fn </span>is_constrained(<span class="kw-2">&amp;</span><span class="self">self</span>, edge: Edge) -&gt; bool {
        <span class="kw">match </span>edge {
            Edge::Ab =&gt; <span class="self">self</span>.c0,
            Edge::Bc =&gt; <span class="self">self</span>.c1,
            Edge::Ca =&gt; <span class="self">self</span>.c2,
        }
    }
}

<span class="kw">impl </span>Default <span class="kw">for </span>Triangulation3D {
    <span class="kw">fn </span>default() -&gt; <span class="self">Self </span>{
        <span class="self">Self</span>::new()
    }
}

<span class="kw">impl </span>Triangulation3D {
    <span class="doccomment">/// Creates  a new empty [`Triangulation3D`]
    </span><span class="kw">pub fn </span>new() -&gt; Triangulation3D {
        Triangulation3D {
            n_valid_triangles: <span class="number">0</span>,
            triangles: Vec::new(),
        }
    }

    <span class="doccomment">/// Creates  a new empty [`Triangulation3D`] with a certain capacity
    </span><span class="kw">pub fn </span>with_capacity(i: usize) -&gt; Triangulation3D {
        Triangulation3D {
            n_valid_triangles: <span class="number">0</span>,
            triangles: Vec::with_capacity(i),
        }
    }

    <span class="doccomment">/// Transforms the `Triangulation3D` into a `Vec&lt;Triangle3D&gt;`.
    </span><span class="kw">pub fn </span>get_trilist(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; Vec&lt;Triangle3D&gt; {
        <span class="self">self</span>.triangles.iter().map(|t| t.triangle).collect()
    }

    <span class="doccomment">/// Triangulates a [`Polygon3D`] using the simple ear
    /// clipping algorithm and then progresively refines the mesh in order to get
    /// a relatively healthy set of Delaunay triangles
    </span><span class="kw">pub fn </span>mesh_polygon(
        poly: <span class="kw-2">&amp;</span>Polygon3D,
        max_area: Float,
        max_aspect_ratio: Float,
    ) -&gt; <span class="prelude-ty">Result</span>&lt;Triangulation3D, String&gt; {
        <span class="kw">let </span><span class="kw-2">mut </span>t = <span class="self">Self</span>::from_polygon(poly)<span class="question-mark">?</span>;
        t.refine(max_area, max_aspect_ratio)<span class="question-mark">?</span>;
        <span class="prelude-val">Ok</span>(t)
    }

    <span class="doccomment">/// Loops over all [`Triangle3D`], setting the neighbours. THis is
    /// quite slow, but does the job.
    </span><span class="kw">fn </span>mark_neighbourhouds(<span class="kw-2">&amp;mut </span><span class="self">self</span>) -&gt; <span class="prelude-ty">Result</span>&lt;(), String&gt; {
        <span class="kw">let </span>n = <span class="self">self</span>.triangles.len();
        <span class="kw">for </span>this_i <span class="kw">in </span><span class="number">0</span>..n {
            <span class="kw">for </span>other_i <span class="kw">in </span>this_i + <span class="number">1</span>..n {
                <span class="kw">for </span>edge_i <span class="kw">in </span><span class="number">0</span>..<span class="number">3 </span>{
                    <span class="kw">let </span>edge = <span class="self">self</span>.triangles[this_i].triangle.segment(edge_i).unwrap();

                    <span class="kw">if </span><span class="self">self</span>.triangles[other_i]
                        .triangle
                        .get_edge_index_from_segment(<span class="kw-2">&amp;</span>edge)
                        .is_some()
                    {
                        <span class="self">self</span>.mark_as_neighbours(this_i, Edge::from_i(edge_i), other_i)<span class="question-mark">?</span>;
                        <span class="kw">break</span>; <span class="comment">// dont test other edges
                    </span>}
                }
            }
        }
        <span class="prelude-val">Ok</span>(())
    }

    <span class="doccomment">/// Triangulates a [`Polygon3D`] without refining it, using the simple ear
    /// clipping algorithm.
    </span><span class="kw">pub fn </span>from_polygon(poly: <span class="kw-2">&amp;</span>Polygon3D) -&gt; <span class="prelude-ty">Result</span>&lt;Triangulation3D, String&gt; {
        <span class="kw">let </span><span class="kw-2">mut </span>the_loop = poly.get_closed_loop();
        the_loop.close().unwrap();
        <span class="comment">// This is a theorem, apparently.
        </span><span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::with_capacity(the_loop.len() - <span class="number">2</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>anchor = <span class="number">0</span>;
        <span class="kw">let </span><span class="kw-2">mut </span>count = <span class="number">0</span>;
        <span class="kw">loop </span>{
            <span class="kw">if </span>count &gt; <span class="number">1000 </span>{
                <span class="kw">return </span><span class="prelude-val">Err</span>(<span class="string">&quot;Excessive number of iteration when triangulating polygon&quot;</span>.into());
            }
            
            count += <span class="number">1</span>;
            <span class="kw">let </span><span class="kw-2">mut </span>n = the_loop.len();
            <span class="kw">let </span>last_added = t.n_triangles();
            
            <span class="kw">if </span>n == <span class="number">2 </span>{
                <span class="comment">// return
                </span>t.mark_neighbourhouds()<span class="question-mark">?</span>;
                <span class="kw">return </span><span class="prelude-val">Ok</span>(t);
            }

            <span class="kw">if </span>count % <span class="number">10 </span>== <span class="number">0</span>{
                the_loop = the_loop.sanitize()<span class="question-mark">?</span>;
                n = the_loop.len();
            }

            <span class="kw">let </span>v0 = the_loop[anchor % n];
            <span class="kw">let </span>v1 = the_loop[(anchor + <span class="number">1</span>) % n];
            <span class="kw">let </span>v2 = the_loop[(anchor + <span class="number">2</span>) % n];

            <span class="kw">let </span>potential_diag = Segment3D::new(v0, v2);
            <span class="kw">let </span>is_line = v0.is_collinear(v1, v2)<span class="question-mark">?</span>;
            <span class="kw">let </span>is_diagonal = the_loop.is_diagonal(potential_diag)<span class="question-mark">?</span>;
            <span class="kw">if </span>!is_line &amp;&amp; is_diagonal {
                <span class="comment">// Do not add (i.e., just drop) ears that are too small.
                </span><span class="kw">if </span>potential_diag.length() &gt; <span class="number">0.0001 </span>{
                    <span class="comment">// Add triangle
                    </span>t.push(v0, v1, v2, last_added).unwrap();

                    <span class="comment">// Set contrain... there must be a smarter way of doing this
                    </span><span class="kw">let </span>s01 = Segment3D::new(v0, v1);
                    <span class="kw">if </span>poly.contains_segment(<span class="kw-2">&amp;</span>s01) {
                        t.triangles[last_added].constrain(Edge::from_i(<span class="number">0</span>));
                    }
                    <span class="kw">let </span>s12 = Segment3D::new(v1, v2);
                    <span class="kw">if </span>poly.contains_segment(<span class="kw-2">&amp;</span>s12) {
                        t.triangles[last_added].constrain(Edge::from_i(<span class="number">1</span>));
                    }
                    <span class="kw">let </span>s20 = Segment3D::new(v2, v0);
                    <span class="kw">if </span>poly.contains_segment(<span class="kw-2">&amp;</span>s20) {
                        t.triangles[last_added].constrain(Edge::from_i(<span class="number">2</span>));
                    }
                }

                <span class="comment">//remove v1
                </span>the_loop.remove((anchor + <span class="number">1</span>) % n);
            } <span class="kw">else </span>{
                anchor += <span class="number">1</span>;
            }
        } <span class="comment">//end of loop{}
    </span>}

    <span class="doccomment">/// Returns the number of [`Triangle3D`] in the [`Triangulation3D`]
    /// including invalid ones.
    </span><span class="kw">pub fn </span>n_triangles(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; usize {
        <span class="self">self</span>.triangles.len()
    }

    <span class="doccomment">/// Returns the number of valid [`Triangle3D`] in the [`Triangulation3D`]     
    </span><span class="kw">pub fn </span>n_valid_triangles(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; usize {
        <span class="self">self</span>.n_valid_triangles
    }

    <span class="kw">fn </span>invalidate(<span class="kw-2">&amp;mut </span><span class="self">self</span>, i: usize) -&gt; <span class="prelude-ty">Result</span>&lt;(), String&gt; {
        <span class="kw">let </span>n = <span class="self">self</span>.triangles.len();
        <span class="kw">if </span>i &lt; n {
            <span class="self">self</span>.triangles[i].invalidate();
            <span class="self">self</span>.n_valid_triangles -= <span class="number">1</span>;
            <span class="kw">return </span><span class="prelude-val">Ok</span>(());
        }
        <span class="kw">let </span>msg = <span class="macro">format!</span>(
            <span class="string">&quot;Trying to invalidate triangle {} in a triangulation that has only {} triangles&quot;</span>,
            i, n
        );
        <span class="prelude-val">Err</span>(msg)
    }

    <span class="kw">fn </span>get_first_invalid(<span class="kw-2">&amp;</span><span class="self">self</span>, start: usize) -&gt; <span class="prelude-ty">Option</span>&lt;usize&gt; {
        <span class="kw">let </span>n = <span class="self">self</span>.triangles.len();
        <span class="kw">if </span>start &lt; n {
            <span class="kw">for </span>i <span class="kw">in </span>start..n {
                <span class="kw">if </span>!<span class="self">self</span>.triangles[i].valid {
                    <span class="kw">return </span><span class="prelude-val">Some</span>(i);
                }
            }
        }
        <span class="prelude-val">None
    </span>}

    <span class="doccomment">/// Marks two triangles as neighbours
    </span><span class="kw">fn </span>mark_as_neighbours(<span class="kw-2">&amp;mut </span><span class="self">self</span>, i1: usize, edge_1: Edge, i2: usize) -&gt; <span class="prelude-ty">Result</span>&lt;(), String&gt; {
        <span class="kw">if </span>i1 == i2 {
            <span class="kw">let </span>msg = <span class="macro">format!</span>(<span class="string">&quot;Trying to make a triangle its own neighbour (index {})&quot;</span>, i1);
            <span class="kw">return </span><span class="prelude-val">Err</span>(msg);
        }

        <span class="comment">// Check if this is valid
        </span><span class="kw">if </span>!<span class="self">self</span>.triangles[i1].valid {
            <span class="kw">return </span><span class="prelude-val">Err</span>(<span class="string">&quot;Accessing invalid triangle within mark_as_neighbours()&quot;</span>.to_string());
        }
        <span class="comment">// Get segment... we should panic here, as this is not a user error
        </span><span class="kw">let </span>seg1 = <span class="kw-2">&amp;</span><span class="self">self</span>.triangles[i1].triangle.segment(edge_1.as_i()).unwrap();

        <span class="comment">// Check neighbour
        </span><span class="kw">if </span>!<span class="self">self</span>.triangles[i2].valid {
            <span class="kw">return </span><span class="prelude-val">Err</span>(<span class="string">&quot;Accessing invalid triangle within mark_as_neighbours()&quot;</span>.to_string());
        }

        <span class="comment">// Get edge segment from the other triangle... panic if does not work.
        </span><span class="kw">let </span>edge_2 = <span class="kw">match </span><span class="self">self</span>.triangles[i2].triangle.get_edge_index_from_segment(seg1){
            <span class="prelude-val">Some</span>(e)=&gt;e,
            <span class="prelude-val">None </span>=&gt; <span class="macro">panic!</span>(<span class="string">&quot;The triangles that you are trying to mark as neighbours don&#39;t share a segment.\n Triangle 1 : {}\nTriangle 2: {}&quot;</span>, <span class="self">self</span>.triangles[i1].triangle, <span class="self">self</span>.triangles[i2].triangle)
        };
        <span class="kw">let </span>edge_2 = Edge::from_i(edge_2);

        <span class="comment">// We have already tested all the indexes.
        </span><span class="self">self</span>.triangles[i1].set_neighbour(edge_1, i2);
        <span class="self">self</span>.triangles[i2].set_neighbour(edge_2, i1);

        <span class="prelude-val">Ok</span>(())
    }

    <span class="doccomment">/// Creates a [`Triangle3D`] and pushes it into the [`Triangulation3D`]
    </span><span class="kw">pub fn </span>push(
        <span class="kw-2">&amp;mut </span><span class="self">self</span>,
        vertex_a: Point3D,
        vertex_b: Point3D,
        vertex_c: Point3D,
        last_added: usize,
    ) -&gt; <span class="prelude-ty">Result</span>&lt;usize, String&gt; {
        <span class="kw">let </span>extend: bool;
        <span class="kw">let </span>n = <span class="kw">match </span><span class="self">self</span>.get_first_invalid(last_added) {
            <span class="prelude-val">Some</span>(i) =&gt; {
                extend = <span class="bool-val">false</span>;
                i
            }
            <span class="prelude-val">None </span>=&gt; {
                extend = <span class="bool-val">true</span>;
                <span class="self">self</span>.triangles.len()
            }
        };

        <span class="kw">let </span>result = TriPiece::new(vertex_a, vertex_b, vertex_c, n);
        <span class="kw">match </span>result {
            <span class="prelude-val">Ok</span>(t) =&gt; {
                <span class="kw">if </span>extend {
                    <span class="self">self</span>.triangles.push(t);
                } <span class="kw">else </span>{
                    <span class="self">self</span>.triangles[n] = t;
                }
                <span class="self">self</span>.n_valid_triangles += <span class="number">1</span>;
                <span class="prelude-val">Ok</span>(n)
            }
            <span class="prelude-val">Err</span>(e) =&gt; <span class="prelude-val">Err</span>(e),
        }
    }

    <span class="doccomment">/// Gets the vertex that is opposite to a [`Segment3D`] in a [`Triangle3D`]
    </span><span class="kw">fn </span>get_opposite_vertex(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        triangle: <span class="kw-2">&amp;</span>Triangle3D,
        segment: Segment3D,
    ) -&gt; <span class="prelude-ty">Result</span>&lt;Point3D, String&gt; {
        <span class="kw">match </span>triangle.get_edge_index_from_segment(<span class="kw-2">&amp;</span>segment) {
            <span class="prelude-val">Some</span>(i) =&gt; <span class="kw">match </span>i {
                <span class="number">0 </span>=&gt; <span class="prelude-val">Ok</span>(triangle.vertex(<span class="number">2</span>).unwrap()),
                <span class="number">1 </span>=&gt; <span class="prelude-val">Ok</span>(triangle.vertex(<span class="number">0</span>).unwrap()),
                <span class="number">2 </span>=&gt; <span class="prelude-val">Ok</span>(triangle.vertex(<span class="number">1</span>).unwrap()),
                <span class="kw">_ </span>=&gt; {
                    <span class="prelude-val">Err</span>(<span class="string">&quot;Something really strange happened when get_opposite_vertex()&quot;</span>.to_string())
                }
            },
            <span class="prelude-val">None </span>=&gt; {
                <span class="kw">let </span>msg =
                    <span class="string">&quot;Trying to get opposite verted in a triangle that does not have the given edge&quot;
                        </span>.to_string();
                <span class="prelude-val">Err</span>(msg)
            }
        }
    }

    <span class="doccomment">/// Returns the aspect ration that would result after flipping the diagonal of [`Triangle3D`]
    /// (located at `index`)
    </span><span class="kw">fn </span>get_flipped_aspect_ratio(<span class="kw-2">&amp;</span><span class="self">self</span>, index: usize, edge: Edge) -&gt; <span class="prelude-ty">Option</span>&lt;Float&gt; {
        <span class="comment">// do not modify constraints
        </span><span class="kw">let </span>tripiece = <span class="kw-2">&amp;</span><span class="self">self</span>.triangles[index];
        <span class="kw">if </span>!tripiece.valid {
            <span class="macro">panic!</span>(<span class="string">&quot;Found an invalid triangle when getting flipped aspect ratio&quot;</span>)
        }

        <span class="kw">if </span>tripiece.is_constrained(edge) {
            <span class="kw">return </span><span class="prelude-val">None</span>;
        }

        <span class="comment">// get neighbor
        </span><span class="kw">let </span>neighbour_i = <span class="kw">match </span>tripiece.neighbour(edge) {
            <span class="prelude-val">None </span>=&gt; <span class="kw">return </span><span class="prelude-val">None</span>,
            <span class="prelude-val">Some</span>(i) =&gt; i,
        };

        <span class="kw">let </span>neighbour = <span class="kw-2">&amp;</span><span class="self">self</span>.triangles[neighbour_i];
        <span class="kw">if </span>!neighbour.valid {
            <span class="macro">panic!</span>(<span class="string">&quot;Found an invalid neighbour when getting flipped aspect ratio&quot;</span>);
        }

        <span class="kw">if </span>neighbour.index == tripiece.index {
            <span class="macro">panic!</span>(<span class="string">&quot;Triangle is its own neighbor!&quot;</span>);
        }

        <span class="comment">// get vertices
        </span><span class="kw">let </span>vertex_a = tripiece.triangle.vertex(edge.as_i() % <span class="number">3</span>).unwrap();
        <span class="kw">let </span>vertex_b = tripiece.triangle.vertex((edge.as_i() + <span class="number">1</span>) % <span class="number">3</span>).unwrap();
        <span class="kw">let </span>vertex_c = tripiece.triangle.vertex((edge.as_i() + <span class="number">2</span>) % <span class="number">3</span>).unwrap();

        <span class="comment">// Get the oposite side
        </span><span class="kw">let </span>s = Segment3D::new(vertex_a, vertex_b);
        <span class="kw">let </span>opposite = <span class="self">self</span>.get_opposite_vertex(<span class="kw-2">&amp;</span>neighbour.triangle, s).unwrap();

        <span class="kw">if </span>!is_convex(vertex_a, opposite, vertex_b, vertex_c) {
            <span class="kw">return </span><span class="prelude-val">None</span>;
        }

        <span class="comment">// get the other situation
        </span><span class="kw">let </span>flipped1 = TriPiece::new(vertex_a, opposite, vertex_c, <span class="number">0</span>).unwrap();
        <span class="kw">let </span>flipped2 = TriPiece::new(opposite, vertex_b, vertex_c, <span class="number">0</span>).unwrap();

        <span class="kw">let </span>f1_aspect = flipped1.aspect_ratio;
        <span class="kw">let </span>f2_aspect = flipped2.aspect_ratio;

        <span class="comment">// Return the maximum
        </span><span class="kw">if </span>f1_aspect &gt; f2_aspect {
            <span class="prelude-val">Some</span>(f1_aspect)
        } <span class="kw">else </span>{
            <span class="prelude-val">Some</span>(f2_aspect)
        }
    }

    <span class="kw">fn </span>flip_diagonal(<span class="kw-2">&amp;mut </span><span class="self">self</span>, index: usize, edge: Edge) {
        <span class="comment">// The transformation is as follows:
        //         C                C
        //        /\               /|\
        //     A /__\ B   --&gt;   A / | \ B
        //       \  /             \ | /
        //        \/               \|/
        //         opposite          opposite
        //
        // The neighbours in AC, BC and so on need to be restored at the end.

        // Check if valid
        </span><span class="kw">if </span>!<span class="kw-2">&amp;</span><span class="self">self</span>.triangles[index].valid {
            <span class="macro">panic!</span>(<span class="string">&quot;Trying to flip diagonal with an invalid triangle&quot;</span>);
        }
        <span class="comment">// get neighbour index... There needs to be one, or panic
        </span><span class="kw">let </span>neighbour_index = <span class="kw">match </span><span class="self">self</span>.triangles[index].neighbour(edge) {
            <span class="prelude-val">None </span>=&gt; <span class="macro">panic!</span>(<span class="string">&quot;Trying to flip diagonal of Triangle with no neighbour&quot;</span>),
            <span class="prelude-val">Some</span>(i) =&gt; i,
        };

        <span class="comment">// check if neighbour is valid
        </span><span class="kw">if </span>!<span class="self">self</span>.triangles[neighbour_index].valid {
            <span class="macro">panic!</span>(<span class="string">&quot;Trying to flip diagonal with an invalid neighbour triangle&quot;</span>);
        }

        <span class="comment">// get vertices
        </span><span class="kw">let </span>vertex_a = <span class="self">self</span>.triangles[index]
            .triangle
            .vertex(edge.as_i() % <span class="number">3</span>)
            .unwrap();
        <span class="kw">let </span>vertex_b = <span class="self">self</span>.triangles[index]
            .triangle
            .vertex((edge.as_i() + <span class="number">1</span>) % <span class="number">3</span>)
            .unwrap();
        <span class="kw">let </span>vertex_c = <span class="self">self</span>.triangles[index]
            .triangle
            .vertex((edge.as_i() + <span class="number">2</span>) % <span class="number">3</span>)
            .unwrap();
        <span class="comment">// ... including the oposite side
        </span><span class="kw">let </span>s = Segment3D::new(vertex_a, vertex_b);

        <span class="kw">let </span>opposite = <span class="self">self
            </span>.get_opposite_vertex(<span class="kw-2">&amp;</span><span class="self">self</span>.triangles[neighbour_index].triangle, s)
            .unwrap();

        <span class="comment">/* CHECK SURROUNDINGS */
        // AC segment
        </span><span class="kw">let </span>ac_i = <span class="kw">match </span><span class="kw-2">&amp;</span><span class="self">self</span>.triangles[index]
            .triangle
            .get_edge_index_from_points(vertex_a, vertex_c)
        {
            <span class="prelude-val">Some</span>(i) =&gt; <span class="kw-2">*</span>i,
            <span class="prelude-val">None </span>=&gt; {
                <span class="macro">panic!</span>(<span class="string">&quot;Segment AC not found on triangle when flipping diagonals.&quot;</span>)
            }
        };
        <span class="kw">let </span>ac_edge = Edge::from_i(ac_i);
        <span class="kw">let </span>neighbour_ac_index = <span class="self">self</span>.triangles[index].neighbour(ac_edge);
        <span class="kw">let </span>constrain_ac = <span class="self">self</span>.triangles[index].is_constrained(ac_edge);

        <span class="comment">// BC segment
        </span><span class="kw">let </span>cb_i = <span class="kw">match </span><span class="kw-2">&amp;</span><span class="self">self</span>.triangles[index]
            .triangle
            .get_edge_index_from_points(vertex_c, vertex_b)
        {
            <span class="prelude-val">Some</span>(i) =&gt; <span class="kw-2">*</span>i,
            <span class="prelude-val">None </span>=&gt; {
                <span class="macro">panic!</span>(<span class="string">&quot;Segment CB not found on triangle when flipping diagonals.&quot;</span>)
            }
        };
        <span class="kw">let </span>cb_edge = Edge::from_i(cb_i);
        <span class="kw">let </span>neighbour_bc_i = <span class="self">self</span>.triangles[index].neighbour(cb_edge);
        <span class="kw">let </span>constrain_bc = <span class="self">self</span>.triangles[index].is_constrained(cb_edge);

        <span class="comment">// B-Opposite
        </span><span class="kw">let </span>bopp_i = <span class="kw">match </span><span class="self">self</span>.triangles[neighbour_index]
            .triangle
            .get_edge_index_from_points(vertex_b, opposite)
        {
            <span class="prelude-val">Some</span>(i) =&gt; i,
            <span class="prelude-val">None </span>=&gt; {
                <span class="macro">panic!</span>(<span class="string">&quot;Segment B-Opposite not found on triangle when flipping diagonals.&quot;</span>)
            }
        };
        <span class="kw">let </span>bopp_edge = Edge::from_i(bopp_i);
        <span class="kw">let </span>neighbour_bopp_i = <span class="self">self</span>.triangles[neighbour_index].neighbour(bopp_edge);
        <span class="kw">let </span>constrain_bopp = <span class="self">self</span>.triangles[neighbour_index].is_constrained(bopp_edge);

        <span class="comment">// A-Opposite
        </span><span class="kw">let </span>aopp_i = <span class="kw">match </span><span class="self">self</span>.triangles[neighbour_index]
            .triangle
            .get_edge_index_from_points(vertex_a, opposite)
        {
            <span class="prelude-val">Some</span>(i) =&gt; i,
            <span class="prelude-val">None </span>=&gt; {
                <span class="macro">panic!</span>(<span class="string">&quot;Segment A-Opposite not found on triangle when flipping diagonals.&quot;</span>)
            }
        };
        <span class="kw">let </span>aopp_edge = Edge::from_i(aopp_i);
        <span class="kw">let </span>neighbour_aopp_i = <span class="self">self</span>.triangles[neighbour_index].neighbour(aopp_edge);
        <span class="kw">let </span>constrain_aopp = <span class="self">self</span>.triangles[neighbour_index].is_constrained(aopp_edge);

        <span class="comment">/* THE ORIGINAL TRIANGLES, AND PUSH THE NEW ONES */
        </span><span class="self">self</span>.invalidate(index).unwrap();
        <span class="self">self</span>.invalidate(neighbour_index).unwrap();
        <span class="kw">let </span>aoc_i = <span class="self">self</span>.push(vertex_a, opposite, vertex_c, index).unwrap();
        <span class="kw">let </span>cob_i = <span class="self">self
            </span>.push(vertex_c, opposite, vertex_b, neighbour_index)
            .unwrap();

        <span class="comment">/* REORGANIZE NEIGHBOURHOOD */
        // Segment A-Opposite
        </span><span class="kw">if let </span><span class="prelude-val">Some</span>(ni) = neighbour_aopp_i {
            <span class="self">self</span>.mark_as_neighbours(index, Edge::Ab, ni).unwrap();
        }
        <span class="kw">if </span>constrain_aopp {
            <span class="self">self</span>.triangles[aoc_i].constrain(Edge::Ab);
        }

        <span class="comment">// Segment C-Opposite
        </span><span class="self">self</span>.mark_as_neighbours(aoc_i, Edge::Bc, cob_i).unwrap(); <span class="comment">// this one cannot be constrained

        // Segment AC
        </span><span class="kw">if let </span><span class="prelude-val">Some</span>(ni) = neighbour_ac_index {
            <span class="self">self</span>.mark_as_neighbours(index, Edge::Ca, ni).unwrap();
        }
        <span class="kw">if </span>constrain_ac {
            <span class="self">self</span>.triangles[aoc_i].constrain(Edge::Ca);
        }

        <span class="comment">// Segment C-Opposite
        // ... done by reciprocity; and cannot be constrained
        // self.mark_as_neighbours(cob_i, Edge::Ab, aoc_i);

        // Segment B-Opposite
        </span><span class="kw">if let </span><span class="prelude-val">Some</span>(ni) = neighbour_bopp_i {
            <span class="self">self</span>.mark_as_neighbours(cob_i, Edge::Bc, ni).unwrap();
        }
        <span class="kw">if </span>constrain_bopp {
            <span class="self">self</span>.triangles[cob_i].constrain(Edge::Bc);
        }

        <span class="comment">// Segment BC
        </span><span class="kw">if let </span><span class="prelude-val">Some</span>(ni) = neighbour_bc_i {
            <span class="self">self</span>.mark_as_neighbours(cob_i, Edge::Ca, ni).unwrap();
        }
        <span class="kw">if </span>constrain_bc {
            <span class="self">self</span>.triangles[cob_i].constrain(Edge::Ca);
        }
    } <span class="comment">// end of flip_diagonal()

    </span><span class="doccomment">/// Adds a point to an edge of a [`Triangle3D`], splitting
    /// it and its neighbour
    </span><span class="kw">fn </span>split_edge(
        <span class="kw-2">&amp;mut </span><span class="self">self</span>,
        triangle_index: usize,
        edge_to_split: Edge,
        p: Point3D,
    ) -&gt; <span class="prelude-ty">Result</span>&lt;(), String&gt; {
        <span class="comment">// We are doing the following:
        //              C                    C
        //             /\                   /|\
        //            /  \                 / | \
        //           /    \      --&gt;      /  |  \
        //        A /______\ B         A /___|___\ B
        //          \      /             \   |p  /
        //           \    /               \  |  /
        //            \  /                 \ | /
        //             \/                   \|/
        //              opposite             opposite

        </span><span class="kw">if </span>!<span class="self">self</span>.triangles[triangle_index].valid {
            <span class="kw">let </span>msg = <span class="string">&quot;Trying to split edge of an invalid Triangle3D&quot;</span>.to_string();
            <span class="kw">return </span><span class="prelude-val">Err</span>(msg);
        }

        <span class="kw">let </span>segment_to_split = <span class="self">self</span>.triangles[triangle_index]
            .triangle
            .segment(edge_to_split.as_i())
            .unwrap();

        <span class="comment">// Neighbour... this is not necessarily there
        </span><span class="kw">let </span>nei_i = <span class="self">self</span>.triangles[triangle_index].neighbour(edge_to_split);

        <span class="comment">// get points
        </span><span class="kw">let </span><span class="kw-2">mut </span>process_hemisphere = |index: usize| -&gt; (usize, usize) {
            <span class="kw">let </span>ab_index = <span class="self">self</span>.triangles[index]
                .triangle
                .get_edge_index_from_segment(<span class="kw-2">&amp;</span>segment_to_split)
                .unwrap();
            <span class="kw">let </span>ab = <span class="self">self</span>.triangles[index].triangle.segment(ab_index).unwrap();
            <span class="kw">let </span>vertex_a = ab.start();
            <span class="kw">let </span>vertex_b = ab.end();

            <span class="kw">let </span>edge = <span class="self">self</span>.triangles[index]
                .triangle
                .get_edge_index_from_segment(<span class="kw-2">&amp;</span>ab)
                .unwrap();
            <span class="kw">let </span>edge = Edge::from_i(edge);

            <span class="comment">// let s = self.triangles[index].segment(edge).unwrap();

            // Get points
            </span><span class="kw">let </span>vertex_c = <span class="self">self
                </span>.get_opposite_vertex(<span class="kw-2">&amp;</span><span class="self">self</span>.triangles[index].triangle, ab)
                .unwrap();

            <span class="comment">// invalidate base triangle.
            </span><span class="self">self</span>.invalidate(index).unwrap();

            <span class="comment">// Get neighbours in AC and BC and Constrains
            </span><span class="kw">let </span>bc_n = <span class="self">self</span>.triangles[index].neighbour(edge + <span class="number">1</span>);
            <span class="kw">let </span>ac_n = <span class="self">self</span>.triangles[index].neighbour(edge + <span class="number">2</span>);

            <span class="kw">let </span>ab_c = <span class="self">self</span>.triangles[index].is_constrained(edge);
            <span class="kw">let </span>bc_c = <span class="self">self</span>.triangles[index].is_constrained(edge + <span class="number">1</span>);
            <span class="kw">let </span>ac_c = <span class="self">self</span>.triangles[index].is_constrained(edge + <span class="number">2</span>);

            <span class="comment">// Replace base triangle with two new triangles.
            // Create and add the new triangles.
            </span><span class="kw">let </span>apc_i = <span class="self">self</span>.push(vertex_a, p, vertex_c, index).unwrap(); <span class="comment">// replace the original with this one.
            </span><span class="kw">let </span>pbc_i = <span class="self">self</span>.push(p, vertex_b, vertex_c, <span class="number">0</span>).unwrap(); <span class="comment">// check from the start.

            // Set neighbours and constraints

            // APC TRIANGLE
            // -------------------

            // Segment 0: AP -&gt; Don&#39;t know if there is any neighbour yet... will solve this
            // when adding the neighbour.
            // We do know, however, that it might be contrained
            </span><span class="kw">if </span>ab_c {
                <span class="self">self</span>.triangles[apc_i].constrain(Edge::Ab);
            }

            <span class="comment">// Segment 1: PC
            </span><span class="self">self</span>.mark_as_neighbours(apc_i, Edge::Bc, pbc_i).unwrap();

            <span class="comment">// Segment 2: CA
            </span><span class="kw">if let </span><span class="prelude-val">Some</span>(ni) = ac_n {
                <span class="self">self</span>.mark_as_neighbours(apc_i, Edge::Ca, ni).unwrap();
            }
            <span class="kw">if </span>ac_c {
                <span class="self">self</span>.triangles[apc_i].constrain(Edge::Ca);
            }

            <span class="comment">// PBC Triangle
            // -------------------

            // Segment 0: PB -&gt; Don&#39;t know if there is any neighbour yet... will solve this
            // when adding the neighbour.
            // We do know, however, that it might be contrained
            </span><span class="kw">if </span>ab_c {
                <span class="self">self</span>.triangles[pbc_i].constrain(Edge::Ab);
            }

            <span class="comment">// Segment 1: BC
            </span><span class="kw">if let </span><span class="prelude-val">Some</span>(ni) = bc_n {
                <span class="self">self</span>.mark_as_neighbours(pbc_i, Edge::Bc, ni).unwrap();
            }
            <span class="kw">if </span>bc_c {
                <span class="self">self</span>.triangles[pbc_i].constrain(Edge::Bc);
            }

            <span class="comment">// Segment 2: CP... matches the other triangle. Reciprocity

            // Return positions of new triangles.
            </span>(apc_i, pbc_i)
        }; <span class="comment">// end of process_hemisphere

        // PROCESS BASE TRIANGLE
        // ==============================

        </span><span class="kw">let </span>(top_left_i, top_right_i) = process_hemisphere(triangle_index);

        <span class="comment">// PROCESS NEIGHBOUR
        // =================

        // If there is any neighbour, process as well.
        </span><span class="kw">if let </span><span class="prelude-val">Some</span>(nei_i) = nei_i {
            <span class="kw">let </span>(bottom_right_i, bottom_left_i) = process_hemisphere(nei_i);

            <span class="comment">// Mark the upper and lower hemispheres as neighbours.
            </span><span class="self">self</span>.mark_as_neighbours(top_left_i, Edge::Ab, bottom_left_i)
                .unwrap();
            <span class="self">self</span>.mark_as_neighbours(top_right_i, Edge::Ab, bottom_right_i)
                .unwrap();
        }

        <span class="prelude-val">Ok</span>(())
    }

    <span class="doccomment">/// Adds a point to the interior of a [`Triangle3D`], splitting
    /// it into three
    </span><span class="kw">fn </span>split_triangle(<span class="kw-2">&amp;mut </span><span class="self">self</span>, i: usize, point: Point3D) -&gt; <span class="prelude-ty">Result</span>&lt;(), String&gt; {
        <span class="comment">// The transformation is as follows (puts P in the middle,
        // and splits the triangle into three triangles):
        //             A                A
        //             /\              /:\
        //            /  \            / : \
        //           /    \          /  x p\
        //          /      \        / .  .  \
        //       c /________\B   c /._______.\B
        //
        // The neighbours in AC, BC and AB need to be restored at the end.

        </span><span class="kw">if </span>!<span class="self">self</span>.triangles[i].valid {
            <span class="kw">let </span>msg = <span class="macro">format!</span>(<span class="string">&quot;Trying to split an invalid triangle (index {})&quot;</span>, i);
            <span class="kw">return </span><span class="prelude-val">Err</span>(msg);
        }

        <span class="comment">// get vertices
        </span><span class="kw">let </span>vertex_a = <span class="self">self</span>.triangles[i].triangle.a();
        <span class="kw">let </span>vertex_b = <span class="self">self</span>.triangles[i].triangle.b();
        <span class="kw">let </span>vertex_c = <span class="self">self</span>.triangles[i].triangle.c();

        <span class="comment">// Get neighbours and constraints
        </span><span class="kw">let </span>edge = <span class="self">self</span>.triangles[i]
            .triangle
            .get_edge_index_from_points(vertex_a, vertex_b)
            .unwrap();
        <span class="kw">let </span>edge = Edge::from_i(edge);
        <span class="kw">let </span>neighbour_ab_i = <span class="self">self</span>.triangles[i].neighbour(edge);
        <span class="kw">let </span>constrain_ab = <span class="self">self</span>.triangles[i].is_constrained(edge);

        <span class="kw">let </span>edge = <span class="self">self</span>.triangles[i]
            .triangle
            .get_edge_index_from_points(vertex_b, vertex_c)
            .unwrap();
        <span class="kw">let </span>edge = Edge::from_i(edge);
        <span class="kw">let </span>neighbour_bc_i = <span class="self">self</span>.triangles[i].neighbour(edge);
        <span class="kw">let </span>constrain_bc = <span class="self">self</span>.triangles[i].is_constrained(edge);

        <span class="kw">let </span>edge = <span class="self">self</span>.triangles[i]
            .triangle
            .get_edge_index_from_points(vertex_c, vertex_a)
            .unwrap();
        <span class="kw">let </span>edge = Edge::from_i(edge);
        <span class="kw">let </span>neighbour_ca_i = <span class="self">self</span>.triangles[i].neighbour(edge);
        <span class="kw">let </span>constrain_ca = <span class="self">self</span>.triangles[i].is_constrained(edge);

        <span class="comment">// Invalidate this triangle.
        </span><span class="self">self</span>.invalidate(i).unwrap();

        <span class="comment">// Add new triangles, noting their indices
        // Indices of the new triangles
        </span><span class="kw">let </span>cap_i = <span class="self">self</span>.push(vertex_c, vertex_a, point, <span class="number">0</span>).unwrap();
        <span class="kw">let </span>abp_i = <span class="self">self</span>.push(vertex_a, vertex_b, point, <span class="number">0</span>).unwrap();
        <span class="kw">let </span>bcp_i = <span class="self">self</span>.push(vertex_b, vertex_c, point, <span class="number">0</span>).unwrap();

        <span class="comment">// Connect them to each other
        </span><span class="self">self</span>.mark_as_neighbours(cap_i, Edge::Bc, abp_i).unwrap();
        <span class="self">self</span>.mark_as_neighbours(abp_i, Edge::Bc, bcp_i).unwrap();
        <span class="self">self</span>.mark_as_neighbours(bcp_i, Edge::Bc, cap_i).unwrap();

        <span class="comment">// Connect to outside
        </span><span class="kw">if </span>constrain_ca {
            <span class="self">self</span>.triangles[cap_i].constrain(Edge::Ab);
        }
        <span class="kw">if let </span><span class="prelude-val">Some</span>(ni) = neighbour_ca_i {
            <span class="self">self</span>.mark_as_neighbours(cap_i, Edge::Ab, ni).unwrap();
        }

        <span class="kw">if </span>constrain_ab {
            <span class="self">self</span>.triangles[abp_i].constrain(Edge::Ab);
        }
        <span class="kw">if let </span><span class="prelude-val">Some</span>(ni) = neighbour_ab_i {
            <span class="self">self</span>.mark_as_neighbours(abp_i, Edge::Ab, ni).unwrap();
        }

        <span class="kw">if </span>constrain_bc {
            <span class="self">self</span>.triangles[bcp_i].constrain(Edge::Ab);
        }
        <span class="kw">if let </span><span class="prelude-val">Some</span>(ni) = neighbour_bc_i {
            <span class="self">self</span>.mark_as_neighbours(bcp_i, Edge::Ab, ni).unwrap();
        }

        <span class="comment">// return
        </span><span class="prelude-val">Ok</span>(())
    }

    <span class="doccomment">/// Runs through the [`Triangulation3D`] checking if it is worth
    /// flipping diagonals. I.e., if flipping the diagonal would make
    /// the aspect ratios become better
    </span><span class="kw">fn </span>restore_delaunay(<span class="kw-2">&amp;mut </span><span class="self">self</span>, max_aspect_ratio: Float) {
        <span class="comment">// Flipping diagonals does not change the number of triangles.
        </span><span class="kw">let </span>n = <span class="self">self</span>.triangles.len();

        <span class="kw">let </span><span class="kw-2">mut </span>any_changes = <span class="bool-val">true</span>;
        <span class="kw">const </span>MAX_LOOPS: usize = <span class="number">30</span>;
        <span class="kw">let </span><span class="kw-2">mut </span>n_loops: usize = <span class="number">0</span>;

        <span class="kw">while </span>any_changes &amp;&amp; n_loops &lt; MAX_LOOPS {
            <span class="comment">// Count this loop
            </span>n_loops += <span class="number">1</span>;

            <span class="comment">// Reset changes.
            </span>any_changes = <span class="bool-val">false</span>;

            <span class="comment">// Loop
            </span><span class="kw">for </span>i <span class="kw">in </span><span class="number">0</span>..n {
                <span class="comment">// Skip invalids
                </span><span class="kw">if </span>!<span class="self">self</span>.triangles[i].valid {
                    <span class="kw">continue</span>;
                }

                <span class="comment">// get the current aspect ratio
                </span><span class="kw">let </span>current_ar = <span class="self">self</span>.triangles[i].aspect_ratio;

                <span class="comment">// If it is acceptable, skip.
                </span><span class="kw">if </span>current_ar &lt; max_aspect_ratio {
                    <span class="kw">continue</span>;
                }

                <span class="comment">// Otherwise, check if it is worth flipping the diagonal
                </span><span class="kw">let </span><span class="kw-2">mut </span>best_edge: <span class="prelude-ty">Option</span>&lt;Edge&gt; = <span class="prelude-val">None</span>;
                <span class="kw">let </span><span class="kw-2">mut </span>best_aspect_ratio = Float::MAX;

                <span class="comment">// Search in three directions (i.e. three edges)
                </span><span class="kw">for </span>j <span class="kw">in </span><span class="number">0</span>..<span class="number">3 </span>{
                    <span class="kw">let </span>this_edge = Edge::from_i(j);
                    <span class="comment">// calculate possible aspect ratio...
                    </span><span class="kw">if let </span><span class="prelude-val">Some</span>(ar) = <span class="self">self</span>.get_flipped_aspect_ratio(i, this_edge) {
                        <span class="kw">if </span>current_ar &gt; ar &amp;&amp; best_aspect_ratio &gt; ar {
                            best_edge = <span class="prelude-val">Some</span>(this_edge);
                            best_aspect_ratio = ar;
                        }
                    }
                }

                <span class="comment">// Flip if best neighbour actually exists and it is better than
                // the current situation (i.e. &gt;= 0)
                </span><span class="kw">if let </span><span class="prelude-val">Some</span>(best) = best_edge {
                    <span class="comment">// if at least one of them is better than the current
                    </span><span class="self">self</span>.flip_diagonal(i, best);
                    any_changes = <span class="bool-val">true</span>;
                } <span class="comment">// else... do nothing
            </span>}
        } <span class="comment">// End of while any_changes
    </span>} <span class="comment">// end of fn restore_delaunay

    </span><span class="doccomment">/// Adds a point on a specific [`Triangle3D`]. Returns a `bool`, indicating
    /// whether any change was carried out
    </span><span class="kw">fn </span>add_point_to_triangle(
        <span class="kw-2">&amp;mut </span><span class="self">self</span>,
        index: usize,
        point: Point3D,
        p_location: PointInTriangle,
    ) -&gt; bool {
        <span class="kw">if </span>!<span class="self">self</span>.triangles[index].valid {
            <span class="macro">panic!</span>(<span class="string">&quot;{}&quot;</span>, <span class="string">&quot;Trying to add point into an obsolete triangle&quot;</span>);
        }

        <span class="kw">if </span>p_location.is_vertex() {
            <span class="comment">// Point is a vertex... ignore, but pretend we did something
            </span><span class="bool-val">false
        </span>} <span class="kw">else if </span>p_location.is_edge() {
            <span class="kw">let </span>edge = <span class="kw">match </span>p_location {
                PointInTriangle::EdgeAB =&gt; Edge::Ab,
                PointInTriangle::EdgeBC =&gt; Edge::Bc,
                PointInTriangle::EdgeAC =&gt; Edge::Ca,
                <span class="kw">_ </span>=&gt; {
                    <span class="macro">panic!</span>(<span class="string">&quot;Trying to split edge with a point that does not fall on an edge&quot;</span>)
                }
            };
            <span class="self">self</span>.split_edge(index, edge, point).unwrap();
            <span class="bool-val">true
        </span>} <span class="kw">else if </span>p_location == PointInTriangle::Inside {
            <span class="self">self</span>.split_triangle(index, point).unwrap();
            <span class="bool-val">true
        </span>} <span class="kw">else </span>{
            <span class="macro">unreachable!</span>();
        }
    }

    <span class="doccomment">/// Finds the location of a [`Point3D`] within the triangulation
    /// and inserts it. Returns a `bool` indicating if the addition of the new [`Point3D`]
    /// produced any change
    </span><span class="kw">fn </span>add_point(<span class="kw-2">&amp;mut </span><span class="self">self</span>, point: Point3D) -&gt; <span class="prelude-ty">Result</span>&lt;bool, String&gt; {
        <span class="comment">// Iterate through triangles to check

        </span><span class="kw">for </span>(i, tripiece) <span class="kw">in </span><span class="self">self</span>.triangles.iter().enumerate() {
            <span class="comment">// skip triangle if it has been deleted
            </span><span class="kw">if </span>!tripiece.valid {
                <span class="kw">continue</span>;
            }

            <span class="kw">let </span>p_location = tripiece.triangle.test_point(point);
            <span class="kw">if </span>p_location != PointInTriangle::Outside {
                <span class="kw">return </span><span class="prelude-val">Ok</span>(<span class="self">self</span>.add_point_to_triangle(i, point, p_location));
            }
        }

        <span class="prelude-val">Err</span>(
            <span class="string">&quot;No Triangle3D in Triangulation3D contained the point that you wanted to add.&quot;
                </span>.to_string(),
        )
    }

    <span class="doccomment">/// Refines a [`Triangulation3D`]. This only works if all then [`Triangle3D`] have their
    /// vertices in the same order, meaning that their `normal` points in the same direction.
    </span><span class="kw">fn </span>refine(<span class="kw-2">&amp;mut </span><span class="self">self</span>, max_area: Float, max_aspect_ratio: Float) -&gt; <span class="prelude-ty">Result</span>&lt;(), String&gt; {
        <span class="comment">// let n_triangles = self.n_triangles();

        </span><span class="kw">let </span><span class="kw-2">mut </span>any_changes = <span class="bool-val">false</span>;
        <span class="kw">for </span>i <span class="kw">in </span><span class="number">0</span>..<span class="self">self</span>.n_triangles() {
            <span class="kw">if </span>!<span class="self">self</span>.triangles[i].valid {
                <span class="comment">// I think validity of triangles is obsolete and we
                // should remove it
                </span><span class="macro">unreachable!</span>();
            }

            <span class="kw">let </span>area = <span class="self">self</span>.triangles[i].triangle.area();

            <span class="comment">// if area is already too small, just ignore
            </span><span class="kw">if </span>area &lt; <span class="number">1e-3 </span>{
                <span class="kw">continue</span>;
            }

            <span class="comment">// If it is an issue of aspect ratio
            </span><span class="kw">if </span><span class="self">self</span>.triangles[i].aspect_ratio &gt; max_aspect_ratio {
                <span class="comment">// find the longest edge... assume it is the first one
                </span><span class="kw">let </span><span class="kw-2">mut </span>s = <span class="self">self</span>.triangles[i].triangle.ab();
                <span class="kw">let </span><span class="kw-2">mut </span>s_i = <span class="number">0</span>;
                <span class="comment">// but check the other two.
                </span><span class="kw">for </span>j <span class="kw">in </span><span class="number">1</span>..<span class="number">3 </span>{
                    <span class="kw">if </span>s.length() &lt; <span class="self">self</span>.triangles[i].triangle.segment(j).unwrap().length() {
                        s_i = j;
                        s = <span class="self">self</span>.triangles[i].triangle.segment(j).unwrap();
                    }
                }
                <span class="kw">let </span>edge_to_split = Edge::from_i(s_i);

                <span class="comment">// add midpoint
                </span><span class="kw">let </span>mid_s = s.midpoint();
                <span class="self">self</span>.split_edge(i, edge_to_split, mid_s).unwrap();
                <span class="self">self</span>.restore_delaunay(max_aspect_ratio);
                any_changes = <span class="bool-val">true</span>;
            } <span class="kw">else if </span>area &gt; max_area {
                <span class="comment">// try to add the circumcenter
                </span><span class="kw">let </span>c_center = <span class="self">self</span>.triangles[i].circumcenter;

                <span class="comment">// Since the circumcenter may be in another triangle, we need
                // to search for it.
                </span><span class="kw">match </span><span class="self">self</span>.add_point(c_center) {
                    <span class="prelude-val">Ok</span>(did_something) =&gt; {
                        <span class="kw">if </span>did_something {
                            any_changes = <span class="bool-val">true</span>;
                            <span class="self">self</span>.restore_delaunay(max_aspect_ratio);
                        }
                    }
                    <span class="prelude-val">Err</span>(<span class="kw">_</span>) =&gt; {
                        <span class="comment">// What should I do if the circumcenter is out of the polygon?
                        // For now just add the centroid of it...
                        </span><span class="kw">let </span>centroid = <span class="self">self</span>.triangles[i].centroid;

                        <span class="comment">// The Centroid of a triangle is always inside of it... right?
                        </span><span class="kw">if </span><span class="self">self</span>.add_point_to_triangle(i, centroid, PointInTriangle::Inside) {
                            any_changes = <span class="bool-val">true</span>;
                            <span class="self">self</span>.restore_delaunay(max_aspect_ratio);
                        }
                    }
                }
            }
        }
        <span class="kw">if </span>any_changes {
            <span class="self">self</span>.refine(max_area, max_aspect_ratio)
        } <span class="kw">else </span>{
            <span class="prelude-val">Ok</span>(())
        }
    }
} <span class="comment">// end of impl Triangulation3D

</span><span class="kw">pub fn </span>is_convex(a: Point3D, b: Point3D, c: Point3D, d: Point3D) -&gt; bool {
    <span class="comment">// The points are aligned like this, if it is convex.
    //         B
    //        /\
    //     A /  \ C
    //       \  /
    //        \/
    //         D

    // 1st... ABC
    </span><span class="kw">let </span>ab = b - a;
    <span class="kw">let </span>bc = c - b;
    <span class="kw">let </span>n_abc = ab.cross(bc);

    <span class="kw">if </span>n_abc.is_zero() {
        <span class="comment">// Points are collinear
        </span><span class="kw">return </span><span class="bool-val">false</span>;
    }

    <span class="comment">// 2nd... BCD
    </span><span class="kw">let </span>cd = d - c;
    <span class="kw">let </span>n_bcd = bc.cross(cd);
    <span class="kw">if </span>n_bcd.is_zero() {
        <span class="kw">return </span><span class="bool-val">false</span>;
    }
    <span class="kw">if </span>!n_abc.is_same_direction(n_bcd) {
        <span class="kw">return </span><span class="bool-val">false</span>;
    }

    <span class="comment">// 3rd... CDA
    </span><span class="kw">let </span>da = a - d;
    <span class="kw">let </span>n_cda = cd.cross(da);
    <span class="kw">if </span>n_cda.is_zero() {
        <span class="kw">return </span><span class="bool-val">false</span>;
    }
    <span class="kw">if </span>!n_abc.is_same_direction(n_cda) {
        <span class="kw">return </span><span class="bool-val">false</span>;
    }

    <span class="comment">// 4th... DAB
    </span><span class="kw">let </span>n_dab = da.cross(ab);
    <span class="kw">if </span>n_dab.is_zero() {
        <span class="kw">return </span><span class="bool-val">false</span>;
    }
    <span class="kw">if </span>!n_abc.is_same_direction(n_dab) {
        <span class="kw">return </span><span class="bool-val">false</span>;
    }

    <span class="comment">// Passed all the checks
    </span><span class="bool-val">true
</span>}

<span class="comment">/***********/
/* TESTING */
/***********/

</span><span class="attribute">#[cfg(test)]
</span><span class="kw">mod </span>testing {
    <span class="kw">use super</span>::<span class="kw-2">*</span>;
    <span class="kw">use </span><span class="kw">crate</span>::Loop3D;

    <span class="kw">fn </span>test_triangulation_results(
        t: <span class="kw-2">&amp;</span>Triangulation3D,
        p: <span class="kw-2">&amp;</span>Polygon3D,
        max_area: Float,
        max_aspect_ratio: Float,
    ) -&gt; <span class="prelude-ty">Result</span>&lt;(), String&gt; {
        <span class="comment">// Test area.
        </span><span class="kw">let </span><span class="kw-2">mut </span>triangulation_area = <span class="number">0.</span>;
        <span class="kw">let </span>polygon_normal = p.normal();
        <span class="comment">// Checks triangles one by one
        </span><span class="kw">for </span>(i, tripiece) <span class="kw">in </span>t.triangles.iter().enumerate() {
            <span class="comment">// get area
            </span>triangulation_area += tripiece.triangle.area();
            <span class="kw">let </span>triangle_normal = tripiece.triangle.normal();
            <span class="kw">if </span>!polygon_normal.is_same_direction(triangle_normal) {
                <span class="kw">return </span><span class="prelude-val">Err</span>(<span class="macro">format!</span>(<span class="string">&quot;Triangle and Polygon do not have the same Normal (they are {} and {}, respectively)&quot;</span>, triangle_normal, polygon_normal));
            }

            <span class="comment">// Check proportions of triangle.
            </span><span class="kw">if </span>tripiece.triangle.area() &gt;= max_area {
                <span class="kw">return </span><span class="prelude-val">Err</span>(<span class="macro">format!</span>(
                    <span class="string">&quot;Triangle {} in the triangulation has area ({}) &gt;= max_area ({}) &quot;</span>,
                    i,
                    tripiece.triangle.area(),
                    max_area
                ));
            }

            <span class="kw">if </span>tripiece.aspect_ratio &gt; max_aspect_ratio {
                <span class="kw">return </span><span class="prelude-val">Err</span>(<span class="macro">format!</span>(<span class="string">&quot;Triangle {} in the triangulation has aspect_ratio ({}) &gt;= max_aspect_ratio ({}) &quot;</span>,i, tripiece.aspect_ratio,max_aspect_ratio));
            }

            <span class="comment">// Check if any of the three edges is
            // an edge in the polygon... in such a case,
            // it should be constrained.
            </span><span class="kw">for </span>e <span class="kw">in </span><span class="number">0</span>..<span class="number">3 </span>{
                <span class="kw">let </span>edge = tripiece.triangle.segment(e).unwrap();

                <span class="comment">// Check neighbour in this edge
                </span><span class="kw">let </span>neighbour_i = tripiece.neighbour(Edge::from_i(e));
                <span class="kw">if let </span><span class="prelude-val">Some</span>(neighbour_i) = neighbour_i {
                    <span class="kw">let </span>neigh = <span class="kw-2">&amp;</span>t.triangles[neighbour_i];
                    <span class="kw">let </span>neigh_edge = neigh
                        .triangle
                        .get_edge_index_from_points(edge.start, edge.end)
                        .unwrap();
                    <span class="kw">let </span>neighbours_neighbour =
                        neigh.neighbour(Edge::from_i(neigh_edge)).unwrap() <span class="kw">as </span>usize;
                    <span class="kw">if </span>neighbours_neighbour != i {
                        <span class="macro">panic!</span>(
                            <span class="string">&quot; ... This({}).neighbour({})={} != Neighbour({}).neighbour({})={}&quot;</span>,
                            i, e, neighbour_i, neighbour_i, neigh_edge, neighbours_neighbour
                        );
                    }
                }

                <span class="comment">// Go through outer loop.
                </span><span class="kw">let </span>outer = p.outer();
                <span class="kw">let </span>n_out = outer.len();
                <span class="kw">for </span>j <span class="kw">in </span><span class="number">0</span>..n_out {
                    <span class="kw">let </span>a = outer[j];
                    <span class="kw">let </span>b = outer[(j + <span class="number">1</span>) % n_out];
                    <span class="kw">let </span>_outer_segment = Segment3D::new(a, b);

                    <span class="comment">// if outer_segment.contains(&amp;edge).unwrap() {
                    //     if !tripiece.is_constrained(Edge::from_i(e)) {
                    //         return Err(format!(
                    //             &quot;Edge {} of Triangle {} in triangulation should be constrained&quot;,
                    //             e, i
                    //         ));
                    //     }
                    // }
                </span>}

                <span class="comment">// Go through inner loops.
                </span><span class="kw">for </span>l_i <span class="kw">in </span><span class="number">0</span>..p.n_inner_loops() {
                    <span class="kw">let </span>inner = p.inner(l_i).unwrap();
                    <span class="kw">let </span>n_in = inner.len();

                    <span class="kw">for </span>j <span class="kw">in </span><span class="number">0</span>..n_in {
                        <span class="kw">let </span>a = inner[j];
                        <span class="kw">let </span>b = inner[(j + <span class="number">1</span>) % n_in];
                        <span class="kw">let </span>inner_segment = Segment3D::new(a, b);

                        <span class="kw">if </span>inner_segment.contains(<span class="kw-2">&amp;</span>edge).unwrap() {
                            <span class="kw">if </span>!tripiece.is_constrained(Edge::from_i(e)) {
                                <span class="kw">return </span><span class="prelude-val">Err</span>(<span class="macro">format!</span>(<span class="string">&quot;Edge {} of Triangle3D {} in triangulation should be constrained&quot;</span>,e,i));
                            }
                        }
                    }
                } <span class="comment">// end of iterating inner loops
            </span>}
        }

        <span class="comment">// Must have the same area.
        </span><span class="kw">if </span>(triangulation_area - p.area()).abs() &gt; <span class="number">1e-4 </span>{
            <span class="kw">return </span><span class="prelude-val">Err</span>(<span class="macro">format!</span>(
                <span class="string">&quot;Areas of orginal polygon (A = {}) and triangulation (A = {}) do not match&quot;</span>,
                triangulation_area,
                p.area()
            ));
        }
        <span class="comment">// return
        </span><span class="prelude-val">Ok</span>(())
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_test_triangulation_results() {
        <span class="kw">let </span>a = Point3D::new(<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(<span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>outer = Loop3D::new();
        outer.push(a).unwrap();
        outer.push(b).unwrap();
        outer.push(c).unwrap();
        outer.close().unwrap();

        <span class="kw">let </span>poly = Polygon3D::new(outer).unwrap();

        <span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();
        t.push(a, b, c, <span class="number">0</span>).unwrap();

        <span class="comment">// No contraints... should fail
        // assert!(test_triangulation_results(&amp;t, &amp;poly, 1000., 1000.).is_err());

        // Add contraints and test again.
        </span>t.triangles[<span class="number">0</span>].constrain(Edge::Ab);
        t.triangles[<span class="number">0</span>].constrain(Edge::Bc);
        t.triangles[<span class="number">0</span>].constrain(Edge::Ca);
        <span class="macro">assert!</span>(test_triangulation_results(<span class="kw-2">&amp;</span>t, <span class="kw-2">&amp;</span>poly, <span class="number">1000.</span>, <span class="number">1000.</span>).is_ok());

        <span class="comment">// Add another triangle... should not work.
        </span><span class="kw">let </span>d = Point3D::new(-<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);
        t.push(a, c, d, <span class="number">0</span>).unwrap();

        <span class="macro">assert!</span>(test_triangulation_results(<span class="kw-2">&amp;</span>t, <span class="kw-2">&amp;</span>poly, <span class="number">1000.</span>, <span class="number">1000.</span>).is_err());
    }

    <span class="kw">use </span>std::fs::File;
    <span class="kw">use </span>std::io::prelude::<span class="kw-2">*</span>;

    <span class="kw">fn </span>draw_triangulation(filename: <span class="kw-2">&amp;</span>str, cases: Vec&lt;(<span class="kw-2">&amp;</span>str, String)&gt;) {
        <span class="kw">let </span><span class="kw-2">mut </span>file = File::create(<span class="macro">format!</span>(<span class="string">&quot;./test_data/{}&quot;</span>, filename)).unwrap();
        file.write(<span class="string">b&quot;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&quot;</span>).unwrap();

        <span class="kw">for </span>(title, svg) <span class="kw">in </span>cases.iter() {
            file.write(<span class="string">b&quot;&lt;div&gt;&quot;</span>).unwrap();

            file.write(<span class="macro">format!</span>(<span class="string">&quot;&lt;h1&gt;{}&lt;/h1&gt;&quot;</span>, title).as_bytes())
                .unwrap();
            file.write(svg.as_bytes()).unwrap();
            file.write(<span class="string">b&quot;&lt;/div&gt;&quot;</span>).unwrap();
        }

        file.write(<span class="string">b&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>).unwrap();
    }

    <span class="kw">fn </span>get_triangulation_svg(
        t: <span class="kw-2">&amp;</span>Triangulation3D,
        min_x: Float,
        max_x: Float,
        min_y: Float,
        max_y: Float,
    ) -&gt; String {
        <span class="comment">// Arrange a transformation
        </span><span class="kw">const </span>SCALE: Float = <span class="number">50.</span>;
        <span class="kw">const </span>PADDING: Float = <span class="number">5.</span>; <span class="comment">// PErcentage of BBOX
        </span><span class="kw">let </span>width = max_x - min_x;
        <span class="kw">let </span>height = max_y - min_y;
        <span class="kw">let </span>padding_x = PADDING * width / <span class="number">100.</span>;
        <span class="kw">let </span>padding_y = PADDING * height / <span class="number">100.</span>;

        <span class="kw">let </span>into_svg_coordinates = |pt: Point3D| -&gt; Point3D {
            Point3D::new(pt.x - min_x + padding_x, padding_y + max_y - pt.y, <span class="number">0.0</span>)
        };

        <span class="comment">/* DRAW TRIANGULATION */
        </span><span class="kw">let </span><span class="kw-2">mut </span>ret = <span class="macro">format!</span>(
            <span class="string">&quot;&lt;svg width=&#39;{}&#39; height=&#39;{}&#39;&gt;\n\n&quot;</span>,
            SCALE * (<span class="number">2. </span>* padding_x + width),
            SCALE * (<span class="number">2. </span>* padding_y + height)
        );

        <span class="kw">let </span>n_tri = t.n_triangles();
        <span class="comment">// Triangles
        </span><span class="kw">for </span>i <span class="kw">in </span><span class="number">0</span>..n_tri {
            <span class="kw">let </span>tri = <span class="kw-2">&amp;</span>t.triangles[i];
            <span class="kw">if </span>!tri.valid {
                <span class="kw">continue</span>;
            }
            ret += <span class="kw-2">&amp;</span><span class="string">&quot;&lt;polygon points=&#39;&quot;</span>;
            <span class="kw">for </span>vertex_i <span class="kw">in </span><span class="number">0</span>..<span class="number">3 </span>{
                <span class="kw">let </span>v = tri.triangle.vertex(vertex_i).unwrap();
                <span class="kw">let </span>svg_point = into_svg_coordinates(v);
                ret += <span class="kw-2">&amp;</span><span class="macro">format!</span>(<span class="string">&quot;{},{} &quot;</span>, SCALE * svg_point.x, SCALE * svg_point.y);
            }
            ret += <span class="string">&quot;&#39; style=&#39;fill:#b9b9b9;stroke:#b9b9b9;stroke-width:0;fill-rule:evenodd;&#39; /&gt;\n\n&quot;</span>;
        }

        <span class="comment">// Edges and neighbours
        </span><span class="kw">for </span>i <span class="kw">in </span><span class="number">0</span>..n_tri {
            <span class="kw">let </span>tri = <span class="kw-2">&amp;</span>t.triangles[i];
            <span class="kw">if </span>!tri.valid {
                <span class="kw">continue</span>;
            }

            <span class="kw">for </span>vertex_i <span class="kw">in </span><span class="number">0</span>..<span class="number">3 </span>{
                <span class="kw">let </span>this_edge = Edge::from_i(vertex_i);
                <span class="comment">// Edges
                </span><span class="kw">let </span>v = tri.triangle.vertex(vertex_i).unwrap();
                <span class="kw">let </span>next_v = tri.triangle.vertex((vertex_i + <span class="number">1</span>) % <span class="number">3</span>).unwrap();
                <span class="kw">let </span>svg_point = into_svg_coordinates(v) * SCALE;
                <span class="kw">let </span>next_svg_point = into_svg_coordinates(next_v) * SCALE;

                <span class="kw">let </span>style = <span class="kw">if </span>tri.is_constrained(this_edge) {
                    <span class="string">&quot;stroke:black;stroke-width:3&quot;
                </span>} <span class="kw">else </span>{
                    <span class="string">&quot;stroke:#282828;stroke-width:.7&quot; </span><span class="comment">//;stroke-dasharray:6,12
                </span>};
                <span class="kw">let </span>line_string = <span class="macro">format!</span>(
                    <span class="string">&quot;&lt;line x1=&#39;{}&#39; y1=&#39;{}&#39; x2=&#39;{}&#39; y2=&#39;{}&#39; style=&#39;{}&#39; /&gt;\n\n&quot;</span>,
                    svg_point.x, svg_point.y, next_svg_point.x, next_svg_point.y, style
                );
                ret += <span class="kw-2">&amp;</span>line_string;

                <span class="comment">// Neighbour
                </span><span class="kw">let </span>neighbour_i = tri.neighbour(this_edge);
                <span class="kw">if let </span><span class="prelude-val">Some</span>(neighbour_i) = neighbour_i {
                    <span class="kw">let </span>neighbour = <span class="kw-2">&amp;</span>t.triangles[neighbour_i];
                    <span class="kw">if </span>!neighbour.valid {
                        <span class="macro">panic!</span>(
                            <span class="string">&quot;Triangle {} is neighbour of an invalid Triangle, {}&quot;</span>,
                            i, neighbour_i
                        );
                    }

                    <span class="kw">let </span>this_center = into_svg_coordinates(tri.centroid) * SCALE;
                    <span class="kw">let </span>other_center = into_svg_coordinates(neighbour.centroid) * SCALE;
                    <span class="kw">let </span>style = <span class="string">&quot;stroke:red;stroke-width:0;fill:red&quot;</span>;
                    <span class="kw">let </span>line_string = <span class="macro">format!</span>(
                        <span class="string">&quot;&lt;line x1=&#39;{}&#39; y1=&#39;{}&#39; x2=&#39;{}&#39; y2=&#39;{}&#39; style=&#39;{}&#39; /&gt;\n\n&quot;</span>,
                        this_center.x, this_center.y, other_center.x, other_center.y, style
                    );
                    ret += <span class="kw-2">&amp;</span>line_string;

                    <span class="kw">let </span>circle_string = <span class="macro">format!</span>(
                        <span class="string">&quot;&lt;circle cx=&#39;{}&#39; cy=&#39;{}&#39; r=&#39;0&#39; style=&#39;{}&#39; /&gt;&quot;</span>,
                        this_center.x, this_center.y, style
                    );
                    ret += <span class="kw-2">&amp;</span>circle_string;
                }
            }
        }
        ret += <span class="string">&quot;&lt;/svg&gt;&quot;</span>;
        ret
    }

    <span class="kw">fn </span>get_svg(t: <span class="kw-2">&amp;</span>Triangulation3D, p: <span class="kw-2">&amp;</span>Polygon3D) -&gt; String {
        <span class="comment">// Get polygon bounding box
        </span><span class="kw">let </span><span class="kw-2">mut </span>min_x = Float::MAX;
        <span class="kw">let </span><span class="kw-2">mut </span>max_x = Float::MIN;
        <span class="kw">let </span><span class="kw-2">mut </span>min_y = Float::MAX;
        <span class="kw">let </span><span class="kw-2">mut </span>max_y = Float::MIN;
        <span class="kw">for </span>point <span class="kw">in </span>p.outer().vertices().iter() {
            <span class="kw">if </span>point.x &gt; max_x {
                max_x = point.x;
            }
            <span class="kw">if </span>point.x &lt; min_x {
                min_x = point.x;
            }
            <span class="kw">if </span>point.y &gt; max_y {
                max_y = point.y;
            }
            <span class="kw">if </span>point.y &lt; min_y {
                min_y = point.y;
            }
        }
        <span class="kw">let </span>height = max_y - min_y;
        <span class="kw">let </span>width = max_x - min_x;

        <span class="comment">// Arrange a transformation
        </span><span class="kw">const </span>SCALE: Float = <span class="number">50.</span>;
        <span class="kw">const </span>PADDING: Float = <span class="number">5.</span>; <span class="comment">// PErcentage of BBOX
        </span><span class="kw">let </span>padding_x = PADDING * width / <span class="number">100.</span>;
        <span class="kw">let </span>padding_y = PADDING * height / <span class="number">100.</span>;

        <span class="kw">let </span>into_svg_coordinates = |pt: Point3D| -&gt; Point3D {
            Point3D::new(pt.x - min_x + padding_x, padding_y + max_y - pt.y, <span class="number">0.0</span>)
        };

        <span class="kw">let </span><span class="kw-2">mut </span>ret = <span class="macro">format!</span>(
            <span class="string">&quot;&lt;svg width=&#39;{}&#39; height=&#39;{}&#39;&gt;\n\n&quot;</span>,
            SCALE * (<span class="number">2. </span>* padding_x + width),
            SCALE * (<span class="number">2. </span>* padding_y + height)
        );

        <span class="comment">/* DRAW POLYGON */
        </span>ret += <span class="string">&quot;&lt;polygon points=&#39;&quot;</span>;

        <span class="kw">for </span>v <span class="kw">in </span>p.outer().vertices().iter() {
            <span class="kw">let </span>svg_point = into_svg_coordinates(<span class="kw-2">*</span>v);
            ret += <span class="kw-2">&amp;</span><span class="macro">format!</span>(<span class="string">&quot;{},{} &quot;</span>, SCALE * svg_point.x, SCALE * svg_point.y).to_string();
        }
        ret += <span class="kw-2">&amp;</span><span class="string">&quot;&#39; style=&#39;fill:#b9b9b9;stroke:black;stroke-width:2;fill-rule:evenodd;&#39; /&gt;\n\n&quot;</span>;

        <span class="kw">let </span>n_inner = p.n_inner_loops();

        <span class="kw">for </span>i <span class="kw">in </span><span class="number">0</span>..n_inner {
            <span class="kw">let </span>inner = p.inner(i).unwrap();
            ret += <span class="kw-2">&amp;</span><span class="string">&quot;&lt;polygon points=&#39;&quot;</span>;
            <span class="kw">for </span>v <span class="kw">in </span>inner.vertices().iter() {
                <span class="kw">let </span>svg_point = into_svg_coordinates(<span class="kw-2">*</span>v);
                ret += <span class="kw-2">&amp;</span><span class="macro">format!</span>(<span class="string">&quot;{},{} &quot;</span>, SCALE * svg_point.x, SCALE * svg_point.y);
            }
            ret += <span class="kw-2">&amp;</span><span class="string">&quot;&#39; style=&#39;fill:white;stroke:black;stroke-width:2;fill-rule:evenodd;&#39; /&gt;\n\n&quot;</span>;
        }

        ret += <span class="string">&quot;&lt;/svg&gt;&quot;</span>;

        ret += <span class="kw-2">&amp;</span>get_triangulation_svg(t, min_x, max_x, min_y, max_y);

        ret
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_new() {
        <span class="kw">let </span>t = Triangulation3D::new();
        <span class="macro">assert_eq!</span>(t.n_valid_triangles, <span class="number">0</span>);
        <span class="macro">assert_eq!</span>(t.n_valid_triangles(), <span class="number">0</span>);

        <span class="macro">assert_eq!</span>(t.n_triangles(), <span class="number">0</span>);
        <span class="macro">assert_eq!</span>(t.triangles.len(), <span class="number">0</span>);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_default() {
        <span class="kw">let </span>t = Triangulation3D::default();
        <span class="macro">assert_eq!</span>(t.n_valid_triangles, <span class="number">0</span>);
        <span class="macro">assert_eq!</span>(t.n_valid_triangles(), <span class="number">0</span>);

        <span class="macro">assert_eq!</span>(t.n_triangles(), <span class="number">0</span>);
        <span class="macro">assert_eq!</span>(t.triangles.len(), <span class="number">0</span>);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_add_point_to_triangle() {
        <span class="kw">let </span>a = Point3D::new(-<span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(<span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">0.</span>, <span class="number">1.</span>, <span class="number">0.</span>);

        <span class="comment">// Point inside (calls split_triangle())
        </span><span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();
        <span class="kw">let </span>i = t.push(a, b, c, <span class="number">0</span>).unwrap();
        t.add_point_to_triangle(i, Point3D::new(<span class="number">0.0</span>, <span class="number">0.1</span>, <span class="number">0.</span>), PointInTriangle::Inside);
        <span class="macro">assert_eq!</span>(<span class="number">3</span>, t.triangles.len());

        <span class="comment">// Point on AB edge (calls split_edge())
        </span><span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();
        <span class="kw">let </span>i = t.push(a, b, c, <span class="number">0</span>).unwrap();
        t.add_point_to_triangle(i, Point3D::new(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.</span>), PointInTriangle::EdgeAB);
        <span class="macro">assert_eq!</span>(<span class="number">2</span>, t.triangles.len());

        <span class="comment">// Point on Vertex (does nothing)
        </span><span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();
        <span class="kw">let </span>i = t.push(a, b, c, <span class="number">0</span>).unwrap();
        t.add_point_to_triangle(i, a, PointInTriangle::VertexA);
        <span class="macro">assert_eq!</span>(<span class="number">1</span>, t.triangles.len());
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_add_point() {
        <span class="kw">let </span>a = Point3D::new(-<span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(<span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">0.</span>, <span class="number">1.</span>, <span class="number">0.</span>);

        <span class="comment">// Point inside (calls split_triangle())
        </span><span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();
        t.push(a, b, c, <span class="number">0</span>).unwrap();
        t.add_point(Point3D::new(<span class="number">0.0</span>, <span class="number">0.1</span>, <span class="number">0.</span>)).unwrap();
        <span class="macro">assert_eq!</span>(<span class="number">3</span>, t.triangles.len());

        <span class="comment">// Point on AB edge (calls split_edge())
        </span><span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();
        t.push(a, b, c, <span class="number">0</span>).unwrap();
        t.add_point(Point3D::new(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.</span>)).unwrap();
        <span class="macro">assert_eq!</span>(<span class="number">2</span>, t.triangles.len());

        <span class="comment">// Point on Vertex (does nothing)
        </span><span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();
        t.push(a, b, c, <span class="number">0</span>).unwrap();
        t.add_point(a).unwrap();
        <span class="macro">assert_eq!</span>(<span class="number">1</span>, t.triangles.len());
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_is_convex() {
        <span class="kw">let </span>a = Point3D::new(-<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>d = Point3D::new(-<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);

        <span class="macro">assert!</span>(is_convex(a, b, c, d));
        <span class="macro">assert!</span>(!is_convex(a, b, d, c));
        <span class="macro">assert!</span>(!is_convex(a, a, a, a));

        <span class="kw">let </span>b = Point3D::new(-<span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">0.</span>);
        <span class="macro">assert!</span>(!is_convex(a, b, c, d));

        <span class="kw">let </span>b = Point3D::new(-<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="macro">assert!</span>(!is_convex(a, b, c, d));

        <span class="kw">let </span>b = Point3D::new(<span class="number">0.</span>, -<span class="number">0.1</span>, <span class="number">0.</span>);
        <span class="macro">assert!</span>(is_convex(a, b, c, d));
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_push() {
        <span class="kw">let </span>a = Point3D::new(-<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>d = Point3D::new(-<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);

        <span class="kw">let </span>e = Point3D::new(<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();

        <span class="macro">assert_eq!</span>(t.push(a, b, c, <span class="number">0</span>).unwrap(), <span class="number">0</span>);
        <span class="macro">assert_eq!</span>(t.n_valid_triangles, <span class="number">1</span>);
        <span class="macro">assert_eq!</span>(t.n_valid_triangles(), <span class="number">1</span>);
        <span class="macro">assert_eq!</span>(t.n_triangles(), <span class="number">1</span>);
        <span class="macro">assert_eq!</span>(t.triangles.len(), <span class="number">1</span>);

        <span class="macro">assert_eq!</span>(t.push(b, c, d, <span class="number">0</span>).unwrap(), <span class="number">1</span>);
        <span class="macro">assert_eq!</span>(t.n_valid_triangles, <span class="number">2</span>);
        <span class="macro">assert_eq!</span>(t.n_valid_triangles(), <span class="number">2</span>);
        <span class="macro">assert_eq!</span>(t.n_triangles(), <span class="number">2</span>);
        <span class="macro">assert_eq!</span>(t.triangles.len(), <span class="number">2</span>);

        <span class="comment">// invalidate the first one
        </span>t.invalidate(<span class="number">0</span>).unwrap();
        <span class="comment">// Check that there is only one valid,
        // but two in total
        </span><span class="macro">assert_eq!</span>(t.n_valid_triangles(), <span class="number">1</span>);
        <span class="macro">assert_eq!</span>(t.n_triangles(), <span class="number">2</span>);

        <span class="comment">// Add a new one.. it should be in the
        // first position (replaced the old one)
        </span><span class="macro">assert_eq!</span>(t.push(b, c, e, <span class="number">0</span>).unwrap(), <span class="number">0</span>);

        <span class="comment">// there should be two valid now, and two
        // in total
        </span><span class="macro">assert_eq!</span>(t.n_valid_triangles(), <span class="number">2</span>);
        <span class="macro">assert_eq!</span>(t.n_triangles(), <span class="number">2</span>);

        <span class="comment">// Push the first one again
        </span><span class="macro">assert_eq!</span>(t.push(a, b, c, <span class="number">0</span>).unwrap(), <span class="number">2</span>);
        <span class="macro">assert_eq!</span>(t.n_valid_triangles(), <span class="number">3</span>);
        <span class="macro">assert_eq!</span>(t.n_triangles(), <span class="number">3</span>);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_invalidate() {
        <span class="kw">let </span>a = Point3D::new(-<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>d = Point3D::new(-<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();

        t.push(a, b, c, <span class="number">0</span>).unwrap();
        t.push(b, c, d, <span class="number">0</span>).unwrap();
        <span class="macro">assert_eq!</span>(t.n_valid_triangles(), <span class="number">2</span>);

        <span class="macro">assert!</span>(t.invalidate(<span class="number">0</span>).is_ok());
        <span class="macro">assert_eq!</span>(t.n_valid_triangles(), <span class="number">1</span>);
        <span class="macro">assert!</span>(t.invalidate(<span class="number">2</span>).is_err());
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_get_first_invalid() {
        <span class="kw">let </span>a = Point3D::new(-<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>d = Point3D::new(-<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();

        t.push(a, b, c, <span class="number">0</span>).unwrap();
        t.push(b, c, d, <span class="number">0</span>).unwrap();

        <span class="kw">match </span>t.get_first_invalid(<span class="number">0</span>) {
            <span class="prelude-val">Some</span>(_i) =&gt; <span class="macro">assert!</span>(<span class="bool-val">false</span>),
            <span class="prelude-val">None </span>=&gt; <span class="macro">assert!</span>(<span class="bool-val">true</span>),
        };

        t.invalidate(<span class="number">1</span>).unwrap();
        <span class="kw">match </span>t.get_first_invalid(<span class="number">0</span>) {
            <span class="prelude-val">Some</span>(i) =&gt; <span class="macro">assert_eq!</span>(<span class="number">1</span>, i),
            <span class="prelude-val">None </span>=&gt; <span class="macro">assert!</span>(<span class="bool-val">false</span>),
        };

        t.invalidate(<span class="number">0</span>).unwrap();
        <span class="kw">match </span>t.get_first_invalid(<span class="number">0</span>) {
            <span class="prelude-val">Some</span>(i) =&gt; <span class="macro">assert_eq!</span>(<span class="number">0</span>, i),
            <span class="prelude-val">None </span>=&gt; <span class="macro">assert!</span>(<span class="bool-val">false</span>),
        };

        <span class="kw">match </span>t.get_first_invalid(<span class="number">1</span>) {
            <span class="prelude-val">Some</span>(i) =&gt; <span class="macro">assert_eq!</span>(<span class="number">1</span>, i),
            <span class="prelude-val">None </span>=&gt; <span class="macro">assert!</span>(<span class="bool-val">false</span>),
        };
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_borrow_triangle() {
        <span class="kw">let </span>a = Point3D::new(-<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>d = Point3D::new(-<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();

        <span class="kw">let </span><span class="kw-2">mut </span>last_added: usize = <span class="number">0</span>;
        last_added = t.push(a, b, c, last_added).unwrap();
        t.push(b, c, d, last_added).unwrap();

        <span class="comment">// Borrow the first one.
        </span><span class="kw">let </span>_a = <span class="kw-2">&amp;</span>t.triangles[<span class="number">0</span>];
    }

    <span class="attribute">#[test]
    #[should_panic]
    </span><span class="kw">fn </span>test_mark_as_neighbours_panic() {
        <span class="comment">// This should work.
        </span><span class="kw">let </span>a = Point3D::new(-<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>d = Point3D::new(-<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>e = Point3D::new(<span class="number">0.</span>, -<span class="number">5.</span>, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();

        <span class="kw">let </span><span class="kw-2">mut </span>last_added: usize = <span class="number">0</span>;
        last_added = t.push(a, b, c, last_added).unwrap();
        last_added = t.push(c, a, d, last_added).unwrap();
        t.push(a, b, e, last_added).unwrap();

        <span class="comment">// This should not work... the edge is incorrect
        </span><span class="macro">assert!</span>(t.mark_as_neighbours(<span class="number">0</span>, Edge::Ab, <span class="number">1</span>).is_err());

        <span class="comment">// This should not work... they are not neighbours.
        </span><span class="macro">assert!</span>(t.mark_as_neighbours(<span class="number">0</span>, Edge::Bc, <span class="number">2</span>).is_err());
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_mark_as_neighbours() {
        <span class="comment">// This should work.
        </span><span class="kw">let </span>a = Point3D::new(-<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>d = Point3D::new(-<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>e = Point3D::new(<span class="number">0.</span>, -<span class="number">5.</span>, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();

        <span class="kw">let </span><span class="kw-2">mut </span>last_added: usize = <span class="number">0</span>;
        last_added = t.push(a, b, c, last_added).unwrap();
        last_added = t.push(c, a, d, last_added).unwrap();
        t.push(a, b, e, last_added).unwrap();

        <span class="comment">// This should work.
        </span><span class="macro">assert!</span>(t.mark_as_neighbours(<span class="number">0</span>, Edge::Ca, <span class="number">1</span>).is_ok());
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">0</span>].neighbour(Edge::Ca).unwrap(), <span class="number">1</span>);
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">1</span>].neighbour(Edge::Ab).unwrap(), <span class="number">0</span>);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_get_opposite_vertex() {
        <span class="comment">// This should work.
        </span><span class="kw">let </span>a = Point3D::new(-<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();

        t.push(a, b, c, <span class="number">0</span>).unwrap();

        <span class="kw">let </span>s = Segment3D::new(a, b);
        <span class="kw">let </span>p = t.get_opposite_vertex(<span class="kw-2">&amp;</span>t.triangles[<span class="number">0</span>].triangle, s).unwrap();
        <span class="macro">assert!</span>(p.compare(c));

        <span class="kw">let </span>s = Segment3D::new(b, c);
        <span class="kw">let </span>p = t.get_opposite_vertex(<span class="kw-2">&amp;</span>t.triangles[<span class="number">0</span>].triangle, s).unwrap();
        <span class="macro">assert!</span>(p.compare(a));

        <span class="kw">let </span>s = Segment3D::new(a, c);
        <span class="kw">let </span>p = t.get_opposite_vertex(<span class="kw-2">&amp;</span>t.triangles[<span class="number">0</span>].triangle, s).unwrap();
        <span class="macro">assert!</span>(p.compare(b));
    }

    <span class="attribute">#[test]
    #[should_panic]
    </span><span class="kw">fn </span>test_flip_diagonal_panic() {
        <span class="kw">let </span>l = <span class="number">5.</span>;

        <span class="comment">// This should work.
        </span><span class="kw">let </span>a = Point3D::new(-l, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(l, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">0.</span>, l, <span class="number">0.</span>);
        <span class="kw">let </span>opp = Point3D::new(<span class="number">0.</span>, -l, <span class="number">0.</span>);

        <span class="kw">let </span>p1 = Point3D::new(-l, -l, <span class="number">0.</span>);
        <span class="kw">let </span>p2 = Point3D::new(l, -l, <span class="number">0.</span>);
        <span class="kw">let </span>p3 = Point3D::new(l, l, <span class="number">0.</span>);
        <span class="kw">let </span>p4 = Point3D::new(-l, l, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();

        t.push(a, b, c, <span class="number">0</span>).unwrap(); <span class="comment">// 0
        </span>t.push(a, b, opp, <span class="number">0</span>).unwrap(); <span class="comment">// 1

        </span>t.push(p1, opp, a, <span class="number">0</span>).unwrap(); <span class="comment">// 2
        </span>t.push(opp, p2, b, <span class="number">0</span>).unwrap(); <span class="comment">// 3
        </span>t.push(b, p3, c, <span class="number">0</span>).unwrap(); <span class="comment">// 4
        </span>t.push(c, p4, a, <span class="number">0</span>).unwrap(); <span class="comment">// 5

        // Expected to fail... they are not
        // neighbours yet
        </span>t.flip_diagonal(<span class="number">0</span>, Edge::Ab);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_flip_diagonal() {
        <span class="kw">let </span>l = <span class="number">5.</span>;

        <span class="comment">// This should work.
        </span><span class="kw">let </span>a = Point3D::new(-l, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(l, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">0.</span>, l, <span class="number">0.</span>);
        <span class="kw">let </span>opp = Point3D::new(<span class="number">0.</span>, -l, <span class="number">0.</span>);

        <span class="kw">let </span>p1 = Point3D::new(-l, -l, <span class="number">0.</span>);
        <span class="kw">let </span>p2 = Point3D::new(l, -l, <span class="number">0.</span>);
        <span class="kw">let </span>p3 = Point3D::new(l, l, <span class="number">0.</span>);
        <span class="kw">let </span>p4 = Point3D::new(-l, l, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();

        t.push(a, b, c, <span class="number">0</span>).unwrap(); <span class="comment">// 0
        </span>t.push(a, b, opp, <span class="number">0</span>).unwrap(); <span class="comment">// 1

        </span>t.push(p1, opp, a, <span class="number">0</span>).unwrap(); <span class="comment">// 2
        </span>t.push(opp, p2, b, <span class="number">0</span>).unwrap(); <span class="comment">// 3
        </span>t.push(b, p3, c, <span class="number">0</span>).unwrap(); <span class="comment">// 4
        </span>t.push(c, p4, a, <span class="number">0</span>).unwrap(); <span class="comment">// 5

        </span>t.mark_as_neighbours(<span class="number">0</span>, Edge::Ab, <span class="number">1</span>).unwrap();
        t.mark_as_neighbours(<span class="number">0</span>, Edge::Bc, <span class="number">4</span>).unwrap();
        t.mark_as_neighbours(<span class="number">0</span>, Edge::Ca, <span class="number">5</span>).unwrap();

        t.mark_as_neighbours(<span class="number">1</span>, Edge::Bc, <span class="number">3</span>).unwrap();
        t.mark_as_neighbours(<span class="number">1</span>, Edge::Ca, <span class="number">2</span>).unwrap();

        <span class="kw">let </span>original = get_triangulation_svg(<span class="kw-2">&amp;</span>t, -l, l, -l, l);

        <span class="comment">//there should still be 2 triangles.
        </span><span class="macro">assert_eq!</span>(t.n_triangles(), <span class="number">6</span>);
        <span class="comment">// all valid
        </span><span class="macro">assert_eq!</span>(t.n_valid_triangles(), <span class="number">6</span>);

        <span class="comment">// Should work now.
        </span>t.flip_diagonal(<span class="number">0</span>, Edge::Ab);

        <span class="kw">let </span>first_flip = get_triangulation_svg(<span class="kw-2">&amp;</span>t, -l, l, -l, l);

        <span class="comment">//there should still be 2 triangles.
        </span><span class="macro">assert_eq!</span>(t.n_triangles(), <span class="number">6</span>);
        <span class="comment">// all valid
        </span><span class="macro">assert_eq!</span>(t.n_valid_triangles(), <span class="number">6</span>);

        <span class="comment">// Test triangles.
        </span><span class="kw">let </span>a_opp_c = Triangle3D::new(a, opp, c).unwrap();
        <span class="kw">let </span>c_opp_b = Triangle3D::new(c, opp, b).unwrap();
        <span class="macro">assert!</span>(t.triangles[<span class="number">0</span>].triangle.compare(<span class="kw-2">&amp;</span>a_opp_c));
        <span class="macro">assert!</span>(t.triangles[<span class="number">1</span>].triangle.compare(<span class="kw-2">&amp;</span>c_opp_b));

        <span class="comment">// Test neighbours
        </span><span class="macro">assert_eq!</span>(t.triangles[<span class="number">0</span>].neighbour(Edge::Ab).unwrap(), <span class="number">2</span>);
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">0</span>].neighbour(Edge::Bc).unwrap(), <span class="number">1</span>);
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">0</span>].neighbour(Edge::Ca).unwrap(), <span class="number">5</span>);

        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">1</span>].neighbour(Edge::Ab).unwrap(), <span class="number">0</span>);
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">1</span>].neighbour(Edge::Bc).unwrap(), <span class="number">3</span>);
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">1</span>].neighbour(Edge::Ca).unwrap(), <span class="number">4</span>);

        draw_triangulation(
            <span class="string">&quot;flip_diagonal.html&quot;</span>,
            <span class="macro">vec!</span>[(<span class="string">&quot;original&quot;</span>, original), (<span class="string">&quot;after&quot;</span>, first_flip)],
        );
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_get_flipped_aspect_ratio() {
        <span class="comment">// This should work.
        </span><span class="kw">let </span>a = Point3D::new(-<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(<span class="number">1.</span>, -<span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>d = Point3D::new(-<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();

        <span class="kw">let </span><span class="kw-2">mut </span>last_added: usize = <span class="number">0</span>;
        <span class="kw">let </span>tri0 = Triangle3D::new(a, b, c).unwrap();
        last_added = t.push(a, b, c, last_added).unwrap();
        t.push(c, a, d, last_added).unwrap();
        <span class="kw">let </span>tri1 = Triangle3D::new(c, a, d).unwrap();

        <span class="comment">// mark as neighbours
        </span><span class="macro">assert!</span>(t.mark_as_neighbours(<span class="number">0</span>, Edge::Ca, <span class="number">1</span>).is_ok());
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">0</span>].neighbour(Edge::Ca).unwrap(), <span class="number">1</span>);
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">1</span>].neighbour(Edge::Ab).unwrap(), <span class="number">0</span>);

        <span class="comment">// These should return -1... no neighbours there.
        </span><span class="macro">assert!</span>(t.get_flipped_aspect_ratio(<span class="number">0</span>, Edge::Ab).is_none());
        <span class="macro">assert!</span>(t.get_flipped_aspect_ratio(<span class="number">0</span>, Edge::Bc).is_none());

        <span class="comment">// constrain side 0 of triangle 0
        </span>t.triangles[<span class="number">0</span>].constrain(Edge::Ab);
        <span class="macro">assert!</span>(t.get_flipped_aspect_ratio(<span class="number">0</span>, Edge::Ab).is_none());

        <span class="comment">// This should work.
        </span><span class="kw">let </span>tri0_ar = tri0.aspect_ratio();
        <span class="kw">let </span>tri1_ar = tri1.aspect_ratio();
        <span class="macro">assert_eq!</span>(tri0_ar, tri1_ar);
        <span class="macro">assert_eq!</span>(tri0_ar, t.get_flipped_aspect_ratio(<span class="number">0</span>, Edge::Ca).unwrap());
        <span class="macro">assert_eq!</span>(tri1_ar, t.get_flipped_aspect_ratio(<span class="number">1</span>, Edge::Ab).unwrap());
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_split_triangle() {
        <span class="kw">let </span>l = <span class="number">4.</span>;
        <span class="comment">// This should work.
        </span><span class="kw">let </span>a = Point3D::new(-l / <span class="number">2.</span>, -l / <span class="number">2.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(l / <span class="number">2.</span>, -l / <span class="number">2.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(l / <span class="number">2.</span>, l / <span class="number">2.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>d = Point3D::new(-l / <span class="number">2.</span>, l / <span class="number">2.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>e = Point3D::new(-l / <span class="number">2.</span>, -l, <span class="number">0.</span>);
        <span class="kw">let </span>f = Point3D::new(l, -l / <span class="number">2.</span>, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();
        t.push(a, b, c, <span class="number">0</span>).unwrap(); <span class="comment">// 0
        </span>t.push(a, c, d, <span class="number">0</span>).unwrap(); <span class="comment">// 1
        </span>t.push(e, b, a, <span class="number">0</span>).unwrap(); <span class="comment">// 2
        </span>t.push(b, f, c, <span class="number">0</span>).unwrap(); <span class="comment">// 3

        </span>t.mark_as_neighbours(<span class="number">1</span>, Edge::Ab, <span class="number">0</span>).unwrap();
        t.mark_as_neighbours(<span class="number">0</span>, Edge::Ab, <span class="number">2</span>).unwrap();
        t.mark_as_neighbours(<span class="number">0</span>, Edge::Bc, <span class="number">3</span>).unwrap();

        <span class="comment">// constrain AB
        </span>t.triangles[<span class="number">1</span>].constrain(Edge::Ca);

        <span class="kw">let </span>original = get_triangulation_svg(<span class="kw-2">&amp;</span>t, -l, l, -l, l);

        <span class="comment">// SPLIT!
        </span><span class="kw">let </span>p = Point3D::new(l / <span class="number">6.</span>, -l / <span class="number">6.</span>, <span class="number">0.</span>);

        <span class="comment">// Should work.
        </span><span class="macro">assert!</span>(t.split_triangle(<span class="number">0</span>, p).is_ok());

        <span class="kw">let </span>after = get_triangulation_svg(<span class="kw-2">&amp;</span>t, -l, l, -l, l);

        <span class="comment">// There should be a total of 4 valid triangles now.
        // Also, 4 triangles in total (the invalid one should
        // have been replaced by a new one.)
        </span><span class="macro">assert_eq!</span>(t.n_valid_triangles(), <span class="number">6</span>);
        <span class="macro">assert_eq!</span>(t.n_triangles(), <span class="number">6</span>);

        <span class="comment">// Check neighbours and constraints.
        </span><span class="kw">let </span>abc = Triangle3D::new(a, b, c).unwrap();

        <span class="kw">let </span>acd = Triangle3D::new(a, c, d).unwrap();
        <span class="kw">let </span>cpa = Triangle3D::new(c, p, a).unwrap();
        <span class="kw">let </span>bpa = Triangle3D::new(b, p, a).unwrap();
        <span class="kw">let </span>cpb = Triangle3D::new(c, p, b).unwrap();
        <span class="kw">let </span>abe = Triangle3D::new(a, b, e).unwrap();
        <span class="kw">let </span>bfc = Triangle3D::new(b, f, c).unwrap();

        <span class="macro">assert!</span>(cpa.compare(<span class="kw-2">&amp;</span>t.triangles[<span class="number">0</span>].triangle));
        <span class="macro">assert!</span>(acd.compare(<span class="kw-2">&amp;</span>t.triangles[<span class="number">1</span>].triangle));
        <span class="macro">assert!</span>(bpa.compare(<span class="kw-2">&amp;</span>t.triangles[<span class="number">4</span>].triangle));
        <span class="macro">assert!</span>(cpb.compare(<span class="kw-2">&amp;</span>t.triangles[<span class="number">5</span>].triangle));

        <span class="kw">for </span>i <span class="kw">in </span><span class="number">0</span>..t.n_triangles() {
            <span class="kw">let </span>tri = <span class="kw-2">&amp;</span>t.triangles[i];

            <span class="kw">if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>abc) {
                <span class="macro">panic!</span>(<span class="string">&quot;Triangle ABC should not be in Triangulation&quot;</span>)
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>cpa) {
                <span class="macro">assert_eq!</span>(tri.index, <span class="number">0</span>);

                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ab), <span class="prelude-val">Some</span>(<span class="number">1</span>));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Bc), <span class="prelude-val">Some</span>(<span class="number">4</span>));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ca), <span class="prelude-val">Some</span>(<span class="number">5</span>));

                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ab));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Bc));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ca));
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>acd) {
                <span class="macro">assert_eq!</span>(tri.index, <span class="number">1</span>);

                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ab), <span class="prelude-val">Some</span>(<span class="number">0</span>));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Bc), <span class="prelude-val">None</span>);
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ca), <span class="prelude-val">None</span>);

                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ab));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Bc));
                <span class="macro">assert!</span>(tri.is_constrained(Edge::Ca));
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>abe) {
                <span class="macro">assert_eq!</span>(tri.index, <span class="number">2</span>);

                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ab), <span class="prelude-val">None</span>);
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Bc), <span class="prelude-val">Some</span>(<span class="number">4</span>));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ca), <span class="prelude-val">None</span>);

                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ab));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Bc));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ca));
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>bfc) {
                <span class="macro">assert_eq!</span>(tri.index, <span class="number">3</span>);

                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ab), <span class="prelude-val">None</span>);
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Bc), <span class="prelude-val">None</span>);
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ca), <span class="prelude-val">Some</span>(<span class="number">5</span>));

                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ab));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Bc));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ca));
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>bpa) {
                <span class="macro">assert_eq!</span>(tri.index, <span class="number">4</span>);

                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ab), <span class="prelude-val">Some</span>(<span class="number">2</span>));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Bc), <span class="prelude-val">Some</span>(<span class="number">5</span>));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ca), <span class="prelude-val">Some</span>(<span class="number">0</span>));

                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ab));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Bc));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ca));
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>cpb) {
                <span class="macro">assert_eq!</span>(tri.index, <span class="number">5</span>);

                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ab), <span class="prelude-val">Some</span>(<span class="number">3</span>));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Bc), <span class="prelude-val">Some</span>(<span class="number">0</span>));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ca), <span class="prelude-val">Some</span>(<span class="number">4</span>));

                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ab));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Bc));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ca));
            }
        }

        t.restore_delaunay(<span class="number">1.6</span>);
        <span class="kw">let </span>after_delaunay = get_triangulation_svg(<span class="kw-2">&amp;</span>t, -l, l, -l, l);

        draw_triangulation(
            <span class="string">&quot;split_triangle.html&quot;</span>,
            <span class="macro">vec!</span>[
                (<span class="string">&quot;original&quot;</span>, original),
                (<span class="string">&quot;after&quot;</span>, after),
                (<span class="string">&quot;after restoring&quot;</span>, after_delaunay),
            ],
        );
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_split_edge() {
        <span class="kw">let </span>l = <span class="number">4.</span>;
        <span class="comment">// ONLY ONE HEMISPHERE
        // =====================
        // This should work.
        </span><span class="kw">let </span>a = Point3D::new(-l, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(l, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">0.</span>, l, <span class="number">0.</span>);
        <span class="kw">let </span>d = Point3D::new(-l, l, <span class="number">0.</span>);

        <span class="kw">let </span>p = Point3D::new(<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();
        t.push(a, b, c, <span class="number">0</span>).unwrap(); <span class="comment">//0
        </span>t.push(a, c, d, <span class="number">0</span>).unwrap(); <span class="comment">//1

        </span><span class="macro">assert!</span>(t.mark_as_neighbours(<span class="number">0</span>, Edge::Ca, <span class="number">1</span>).is_ok());

        <span class="comment">// Constrain BC and AB
        </span>t.triangles[<span class="number">0</span>].constrain(Edge::Bc);
        t.triangles[<span class="number">0</span>].constrain(Edge::Ab);

        <span class="macro">assert_eq!</span>(<span class="number">2</span>, t.n_triangles());
        <span class="macro">assert_eq!</span>(<span class="number">2</span>, t.n_valid_triangles());

        <span class="kw">let </span>one_hemisphere_before = get_triangulation_svg(<span class="kw-2">&amp;</span>t, -l, l, -l, l);

        <span class="comment">// SPLIT
        </span>t.split_edge(<span class="number">0</span>, Edge::Ab, p).unwrap();

        <span class="kw">let </span>one_hemisphere_after = get_triangulation_svg(<span class="kw-2">&amp;</span>t, -l, l, -l, l);
        <span class="macro">assert_eq!</span>(<span class="number">3</span>, t.n_triangles());
        <span class="macro">assert_eq!</span>(<span class="number">3</span>, t.n_valid_triangles());

        <span class="comment">// Check triangles.                          // INDEX:
        </span><span class="kw">let </span>abc = Triangle3D::new(a, b, c).unwrap(); <span class="comment">// Should not be there
        </span><span class="kw">let </span>apc = Triangle3D::new(a, p, c).unwrap(); <span class="comment">// 0
        </span><span class="kw">let </span>acd = Triangle3D::new(a, c, d).unwrap(); <span class="comment">// 1
        </span><span class="kw">let </span>pbc = Triangle3D::new(p, b, c).unwrap(); <span class="comment">// 2

        // Check indexes (assigned above)... makes it
        // easier to check the neighbourhood.
        </span><span class="macro">assert!</span>(apc.compare(<span class="kw-2">&amp;</span>t.triangles[<span class="number">0</span>].triangle));
        <span class="macro">assert!</span>(acd.compare(<span class="kw-2">&amp;</span>t.triangles[<span class="number">1</span>].triangle));
        <span class="macro">assert!</span>(pbc.compare(<span class="kw-2">&amp;</span>t.triangles[<span class="number">2</span>].triangle));

        <span class="kw">for </span>i <span class="kw">in </span><span class="number">0</span>..t.n_triangles() {
            <span class="kw">let </span>tri = <span class="kw-2">&amp;</span>t.triangles[i];

            <span class="kw">if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>abc) {
                <span class="comment">// This should no be aywhere.
                </span><span class="macro">panic!</span>(<span class="string">&quot;Triangle ABC should not be in the Triangulation&quot;</span>);
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>apc) {
                <span class="macro">assert_eq!</span>(i, <span class="number">0</span>);

                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ab), <span class="prelude-val">None</span>);
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Bc), <span class="prelude-val">Some</span>(<span class="number">2</span>));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ca), <span class="prelude-val">Some</span>(<span class="number">1</span>));

                <span class="macro">assert!</span>(tri.is_constrained(Edge::Ab));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Bc));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ca));
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>acd) {
                <span class="macro">assert_eq!</span>(i, <span class="number">1</span>);

                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ab), <span class="prelude-val">Some</span>(<span class="number">0</span>));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Bc), <span class="prelude-val">None</span>);
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ca), <span class="prelude-val">None</span>);

                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ab));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Bc));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ca));
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>pbc) {
                <span class="macro">assert_eq!</span>(i, <span class="number">2</span>);

                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ab), <span class="prelude-val">None</span>);
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Bc), <span class="prelude-val">None</span>);
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ca), <span class="prelude-val">Some</span>(<span class="number">0</span>));

                <span class="macro">assert!</span>(tri.is_constrained(Edge::Ab));
                <span class="macro">assert!</span>(tri.is_constrained(Edge::Bc));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ca));
            }
        }

        <span class="comment">// NOW WITH TWO HEMISPHERES
        // ========================
        // This should work.
        </span><span class="kw">let </span>a = Point3D::new(-l, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(l, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">0.</span>, l, <span class="number">0.</span>);
        <span class="kw">let </span>d = Point3D::new(-l, l, <span class="number">0.</span>);
        <span class="kw">let </span>e = Point3D::new(-l, -l, <span class="number">0.</span>);
        <span class="kw">let </span>opp = Point3D::new(<span class="number">0.</span>, -l, <span class="number">0.</span>);

        <span class="kw">let </span>p = Point3D::new(<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();
        t.push(a, b, c, <span class="number">0</span>).unwrap(); <span class="comment">//0
        </span>t.push(a, c, d, <span class="number">0</span>).unwrap(); <span class="comment">//1
        </span>t.push(b, a, opp, <span class="number">0</span>).unwrap(); <span class="comment">//2
        </span>t.push(a, e, opp, <span class="number">0</span>).unwrap(); <span class="comment">//3

        </span><span class="macro">assert!</span>(t.mark_as_neighbours(<span class="number">0</span>, Edge::Ca, <span class="number">1</span>).is_ok());
        <span class="macro">assert!</span>(t.mark_as_neighbours(<span class="number">0</span>, Edge::Ab, <span class="number">2</span>).is_ok());
        <span class="macro">assert!</span>(t.mark_as_neighbours(<span class="number">2</span>, Edge::Bc, <span class="number">3</span>).is_ok());

        <span class="comment">// Constrain BC and OPP-B
        </span>t.triangles[<span class="number">0</span>].constrain(Edge::Bc);
        t.triangles[<span class="number">2</span>].constrain(Edge::Ca);

        <span class="macro">assert_eq!</span>(<span class="number">4</span>, t.n_triangles());
        <span class="macro">assert_eq!</span>(<span class="number">4</span>, t.n_valid_triangles());

        <span class="kw">let </span>two_hemispheres_before = get_triangulation_svg(<span class="kw-2">&amp;</span>t, -l, l, -l, l);

        <span class="comment">// SPLIT
        </span>t.split_edge(<span class="number">0</span>, Edge::Ab, p).unwrap();

        <span class="macro">assert_eq!</span>(<span class="number">6</span>, t.n_triangles());
        <span class="macro">assert_eq!</span>(<span class="number">6</span>, t.n_valid_triangles());

        <span class="kw">let </span>two_hemispheres_after = get_triangulation_svg(<span class="kw-2">&amp;</span>t, -l, l, -l, l);

        <span class="comment">// Check triangles.                          // INDEX:
        </span><span class="kw">let </span>abc = Triangle3D::new(a, b, c).unwrap(); <span class="comment">// Should not be there... replaced by APC
        </span><span class="kw">let </span>bao = Triangle3D::new(a, b, opp).unwrap(); <span class="comment">// Should not be there... replaced by BPO

        </span><span class="kw">let </span>apc = Triangle3D::new(a, p, c).unwrap(); <span class="comment">// 0
        </span><span class="kw">let </span>apc_index = <span class="number">0</span>;

        <span class="kw">let </span>acd = Triangle3D::new(a, c, d).unwrap(); <span class="comment">// 1
        </span><span class="kw">let </span>acd_index = <span class="number">1</span>;

        <span class="kw">let </span>bpo = Triangle3D::new(p, b, opp).unwrap(); <span class="comment">// 2
        </span><span class="kw">let </span>bpo_index = <span class="number">2</span>;

        <span class="kw">let </span>aeo = Triangle3D::new(a, opp, e).unwrap(); <span class="comment">// 3
        </span><span class="kw">let </span>aeo_index = <span class="number">3</span>;

        <span class="kw">let </span>pbc = Triangle3D::new(p, b, c).unwrap(); <span class="comment">// 4
        </span><span class="kw">let </span>pbc_index = <span class="number">4</span>;

        <span class="kw">let </span>pao = Triangle3D::new(p, a, opp).unwrap(); <span class="comment">// 2
        </span><span class="kw">let </span>pao_index = <span class="number">5</span>;

        <span class="comment">// Check indexes (assigned above)... makes it
        // easier to check the neighbourhood.
        </span><span class="macro">assert!</span>(apc.compare(<span class="kw-2">&amp;</span>t.triangles[apc_index].triangle));
        <span class="macro">assert!</span>(acd.compare(<span class="kw-2">&amp;</span>t.triangles[acd_index].triangle));
        <span class="macro">assert!</span>(pao.compare(<span class="kw-2">&amp;</span>t.triangles[pao_index].triangle));
        <span class="macro">assert!</span>(aeo.compare(<span class="kw-2">&amp;</span>t.triangles[aeo_index].triangle));
        <span class="macro">assert!</span>(pbc.compare(<span class="kw-2">&amp;</span>t.triangles[pbc_index].triangle));
        <span class="macro">assert!</span>(bpo.compare(<span class="kw-2">&amp;</span>t.triangles[bpo_index].triangle));

        <span class="kw">for </span>i <span class="kw">in </span><span class="number">0</span>..t.n_triangles() {
            <span class="kw">let </span>tri = <span class="kw-2">&amp;</span>t.triangles[i];

            <span class="kw">if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>abc) {
                <span class="comment">// This should no be aywhere.
                </span><span class="macro">panic!</span>(<span class="string">&quot;Triangle ABC should not exist&quot;</span>)
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>bao) {
                <span class="comment">// This should no be aywhere.
                </span><span class="macro">panic!</span>(<span class="string">&quot;Triangle BAO should not exist&quot;</span>)
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>apc) {
                <span class="macro">assert_eq!</span>(i, tri.index);

                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ab), <span class="prelude-val">Some</span>(pao_index));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Bc), <span class="prelude-val">Some</span>(pbc_index));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ca), <span class="prelude-val">Some</span>(acd_index));

                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ab));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Bc));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ca));
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>acd) {
                <span class="macro">assert_eq!</span>(i, tri.index);

                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ab), <span class="prelude-val">Some</span>(apc_index));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Bc), <span class="prelude-val">None</span>);
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ca), <span class="prelude-val">None</span>);

                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ab));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Bc));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ca));
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>bpo) {
                <span class="comment">// Constrain BC and OPP-B
                </span><span class="macro">assert_eq!</span>(i, tri.index);

                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ab), <span class="prelude-val">Some</span>(pbc_index));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Bc), <span class="prelude-val">Some</span>(pao_index));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ca), <span class="prelude-val">None</span>);

                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ab));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Bc));
                <span class="macro">assert!</span>(tri.is_constrained(Edge::Ca));
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>aeo) {
                <span class="macro">assert_eq!</span>(i, tri.index);

                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ab), <span class="prelude-val">None</span>);
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Bc), <span class="prelude-val">None</span>);
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ca), <span class="prelude-val">Some</span>(pao_index));

                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ab));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Bc));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ca));
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>pbc) {
                <span class="comment">// Constrain BC and OPP-B
                </span><span class="macro">assert_eq!</span>(i, tri.index);

                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ab), <span class="prelude-val">Some</span>(bpo_index));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Bc), <span class="prelude-val">None</span>);
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ca), <span class="prelude-val">Some</span>(apc_index));

                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ab));
                <span class="macro">assert!</span>(tri.is_constrained(Edge::Bc));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ca));
            } <span class="kw">else if </span>tri.triangle.compare(<span class="kw-2">&amp;</span>pao) {
                <span class="macro">assert_eq!</span>(i, tri.index);

                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ab), <span class="prelude-val">Some</span>(apc_index));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Bc), <span class="prelude-val">Some</span>(aeo_index));
                <span class="macro">assert_eq!</span>(tri.neighbour(Edge::Ca), <span class="prelude-val">Some</span>(bpo_index));

                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ab));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Bc));
                <span class="macro">assert!</span>(!tri.is_constrained(Edge::Ca));
            }
        }

        draw_triangulation(
            <span class="string">&quot;split_edge.html&quot;</span>,
            <span class="macro">vec!</span>[
                (<span class="string">&quot;One hemisphere - original&quot;</span>, one_hemisphere_before),
                (<span class="string">&quot;One hemisphere - after&quot;</span>, one_hemisphere_after),
                (<span class="string">&quot;Two hemispheres - original&quot;</span>, two_hemispheres_before),
                (<span class="string">&quot;Two hemispheres - after&quot;</span>, two_hemispheres_after),
            ],
        );
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_mesh_polygon() {
        <span class="comment">/* SIMPLE CASE ... three vertices */
        </span><span class="kw">let </span>a = Point3D::new(<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(<span class="number">4.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">4.</span>, <span class="number">4.</span>, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>outer = Loop3D::new();
        outer.push(a).unwrap();
        outer.push(b).unwrap();
        outer.push(c).unwrap();
        outer.close().unwrap();

        <span class="kw">let </span>poly = Polygon3D::new(outer).unwrap();
        <span class="kw">let </span>max_area = <span class="number">0.3</span>;
        <span class="kw">let </span>max_aspect_ratio = <span class="number">1.6</span>;
        <span class="kw">let </span>t = Triangulation3D::mesh_polygon(<span class="kw-2">&amp;</span>poly, max_area, max_aspect_ratio).unwrap();
        <span class="kw">let </span>case0 = get_svg(<span class="kw-2">&amp;</span>t, <span class="kw-2">&amp;</span>poly);
        <span class="comment">// test_triangulation_results(&amp;t, &amp;poly, max_area, max_aspect_ratio).unwrap();

        /* SOMEHOW MORE COMPLICATED CASE ... 6 vertices */
        // let min_x = 0.;
        // let max_x = 5.;
        // let min_y = 0.;
        // let max_y = 6.;
        </span><span class="kw">let </span>p0 = Point3D::new(<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p1 = Point3D::new(<span class="number">3.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p2 = Point3D::new(<span class="number">3.</span>, <span class="number">3.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p3 = Point3D::new(<span class="number">5.</span>, <span class="number">5.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p4 = Point3D::new(<span class="number">3.</span>, <span class="number">6.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p5 = Point3D::new(<span class="number">0.</span>, <span class="number">5.</span>, <span class="number">0.</span>);
        <span class="kw">let </span><span class="kw-2">mut </span>outer = Loop3D::new();
        outer.push(p0).unwrap();
        outer.push(p1).unwrap();
        outer.push(p2).unwrap();
        outer.push(p3).unwrap();
        outer.push(p4).unwrap();
        outer.push(p5).unwrap();
        outer.close().unwrap();
        <span class="macro">assert_eq!</span>(<span class="number">6</span>, outer.len());

        <span class="kw">let </span>poly = Polygon3D::new(outer).unwrap();
        <span class="kw">let </span>max_area = <span class="number">0.1</span>;
        <span class="kw">let </span>max_aspect_ratio = <span class="number">1.6</span>;

        <span class="kw">let </span>t = Triangulation3D::mesh_polygon(<span class="kw-2">&amp;</span>poly, max_area, max_aspect_ratio).unwrap();
        <span class="kw">let </span>case1 = get_svg(<span class="kw-2">&amp;</span>t, <span class="kw-2">&amp;</span>poly);
        <span class="comment">// test_triangulation_results(&amp;t, &amp;poly, max_area, max_aspect_ratio).unwrap();

        /* SOMEHOW MORE COMPLICATED CASE ... 6 vertices + hole */
        // let min_x = 0.;
        // let max_x = 5.;
        // let min_y = 0.;
        // let max_y = 6.;
        </span><span class="kw">let </span>p0 = Point3D::new(<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p1 = Point3D::new(<span class="number">3.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p2 = Point3D::new(<span class="number">3.</span>, <span class="number">3.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p3 = Point3D::new(<span class="number">5.</span>, <span class="number">5.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p4 = Point3D::new(<span class="number">3.</span>, <span class="number">6.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p5 = Point3D::new(<span class="number">0.</span>, <span class="number">5.</span>, <span class="number">0.</span>);
        <span class="kw">let </span><span class="kw-2">mut </span>outer = Loop3D::new();
        outer.push(p0).unwrap();
        outer.push(p1).unwrap();
        outer.push(p2).unwrap();
        outer.push(p3).unwrap();
        outer.push(p4).unwrap();
        outer.push(p5).unwrap();
        outer.close().unwrap();
        <span class="kw">let </span><span class="kw-2">mut </span>poly = Polygon3D::new(outer).unwrap();

        <span class="kw">let </span>i0 = Point3D::new(<span class="number">0.2</span>, <span class="number">0.2</span>, <span class="number">0.</span>);
        <span class="kw">let </span>i1 = Point3D::new(<span class="number">0.8</span>, <span class="number">0.2</span>, <span class="number">0.</span>);
        <span class="kw">let </span>i2 = Point3D::new(<span class="number">0.8</span>, <span class="number">1.2</span>, <span class="number">0.</span>);
        <span class="kw">let </span>i3 = Point3D::new(<span class="number">0.2</span>, <span class="number">1.2</span>, <span class="number">0.</span>);
        <span class="kw">let </span><span class="kw-2">mut </span>inner = Loop3D::new();
        inner.push(i0).unwrap();
        inner.push(i1).unwrap();
        inner.push(i2).unwrap();
        inner.push(i3).unwrap();
        inner.close().unwrap();
        poly.cut_hole(inner).unwrap();

        <span class="kw">let </span>i0 = Point3D::new(<span class="number">1.2</span>, <span class="number">0.6</span>, <span class="number">0.</span>);
        <span class="kw">let </span>i1 = Point3D::new(<span class="number">2.</span>, <span class="number">0.6</span>, <span class="number">0.</span>);
        <span class="kw">let </span>i2 = Point3D::new(<span class="number">2.</span>, <span class="number">3.2</span>, <span class="number">0.</span>);
        <span class="kw">let </span>i3 = Point3D::new(<span class="number">1.2</span>, <span class="number">3.2</span>, <span class="number">0.</span>);
        <span class="kw">let </span><span class="kw-2">mut </span>inner = Loop3D::new();
        inner.push(i0).unwrap();
        inner.push(i1).unwrap();
        inner.push(i2).unwrap();
        inner.push(i3).unwrap();
        inner.close().unwrap();
        poly.cut_hole(inner).unwrap();

        <span class="kw">let </span>max_area = <span class="number">0.4</span>;
        <span class="kw">let </span>max_aspect_ratio = <span class="number">1.6</span>;

        <span class="kw">let </span>t = Triangulation3D::mesh_polygon(<span class="kw-2">&amp;</span>poly, max_area, max_aspect_ratio).unwrap();
        <span class="kw">let </span>case2 = get_svg(<span class="kw-2">&amp;</span>t, <span class="kw-2">&amp;</span>poly);
        <span class="comment">// test_triangulation_results(&amp;t, &amp;poly, max_area, max_aspect_ratio).unwrap();

        </span>draw_triangulation(
            <span class="string">&quot;test_mesh_polygon.html&quot;</span>,
            <span class="macro">vec!</span>[(<span class="string">&quot;Case 0&quot;</span>, case0), (<span class="string">&quot;Case 1&quot;</span>, case1), (<span class="string">&quot;Case 2&quot;</span>, case2)],
        );
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_from_polygon() {
        <span class="comment">/* SIMPLE CASE ... three vertices */
        </span><span class="kw">let </span>a = Point3D::new(<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(<span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>outer = Loop3D::new();
        outer.push(a).unwrap();
        outer.push(b).unwrap();
        outer.push(c).unwrap();
        outer.close().unwrap();

        <span class="kw">let </span>poly = Polygon3D::new(outer).unwrap();
        <span class="kw">let </span>t = Triangulation3D::from_polygon(<span class="kw-2">&amp;</span>poly).unwrap();
        <span class="kw">let </span>case0 = get_svg(<span class="kw-2">&amp;</span>t, <span class="kw-2">&amp;</span>poly);
        test_triangulation_results(<span class="kw-2">&amp;</span>t, <span class="kw-2">&amp;</span>poly, <span class="number">1000.</span>, <span class="number">1000.</span>).unwrap();

        <span class="comment">/* SOMEHOW MORE COMPLICATED CASE ... 6 vertices */
        </span><span class="kw">let </span>p0 = Point3D::new(<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p1 = Point3D::new(<span class="number">3.</span>, <span class="number">3.</span>, <span class="number">0.</span>); <span class="comment">// Collinear... disapears
        </span><span class="kw">let </span>p2 = Point3D::new(<span class="number">5.</span>, <span class="number">5.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p3 = Point3D::new(<span class="number">3.</span>, <span class="number">6.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p4 = Point3D::new(<span class="number">0.</span>, <span class="number">5.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p5 = Point3D::new(<span class="number">0.</span>, <span class="number">3.</span>, <span class="number">0.</span>); <span class="comment">// Collinear, disappear

        </span><span class="kw">let </span><span class="kw-2">mut </span>outer = Loop3D::new();
        outer.push(p0).unwrap();
        outer.push(p1).unwrap();
        outer.push(p2).unwrap();
        outer.push(p3).unwrap();
        outer.push(p4).unwrap();
        outer.push(p5).unwrap();
        outer.close().unwrap();

        <span class="kw">let </span>poly = Polygon3D::new(outer).unwrap();
        <span class="kw">let </span>t = Triangulation3D::from_polygon(<span class="kw-2">&amp;</span>poly).unwrap();

        <span class="kw">let </span>case1 = get_svg(<span class="kw-2">&amp;</span>t, <span class="kw-2">&amp;</span>poly);
        test_triangulation_results(<span class="kw-2">&amp;</span>t, <span class="kw-2">&amp;</span>poly, <span class="number">1000.</span>, <span class="number">1000.</span>).unwrap();

        <span class="comment">/* MORE COMPLICATED CASE  */
        /*
         In this case, the triangulation needs to drop one of
         the &quot;ears&quot;; specifically, the one that goes through points
         [(0,5),(0,0),(0,3)]
        */

        </span><span class="kw">let </span>p0 = Point3D::new(<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p1 = Point3D::new(<span class="number">3.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p2 = Point3D::new(<span class="number">3.</span>, <span class="number">3.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p3 = Point3D::new(<span class="number">5.</span>, <span class="number">5.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p4 = Point3D::new(<span class="number">3.</span>, <span class="number">6.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p5 = Point3D::new(<span class="number">0.</span>, <span class="number">5.</span>, <span class="number">0.</span>);
        <span class="kw">let </span><span class="kw-2">mut </span>outer = Loop3D::new();
        outer.push(p0).unwrap();
        outer.push(p1).unwrap();
        outer.push(p2).unwrap();
        outer.push(p3).unwrap();
        outer.push(p4).unwrap();
        outer.push(p5).unwrap();
        outer.close().unwrap();

        <span class="kw">let </span>poly = Polygon3D::new(outer).unwrap();

        <span class="kw">let </span>t = Triangulation3D::from_polygon(<span class="kw-2">&amp;</span>poly).unwrap();
        <span class="kw">let </span>case2 = get_svg(<span class="kw-2">&amp;</span>t, <span class="kw-2">&amp;</span>poly);
        test_triangulation_results(<span class="kw-2">&amp;</span>t, <span class="kw-2">&amp;</span>poly, <span class="number">9999999.</span>, <span class="number">9999999.</span>).unwrap();

        <span class="comment">/* SOMEHOW MORE COMPLICATED CASE ... 6 vertices + hole */
        </span><span class="kw">let </span>p0 = Point3D::new(<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p1 = Point3D::new(<span class="number">3.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p2 = Point3D::new(<span class="number">3.</span>, <span class="number">3.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p3 = Point3D::new(<span class="number">5.</span>, <span class="number">5.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p4 = Point3D::new(<span class="number">3.</span>, <span class="number">6.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p5 = Point3D::new(<span class="number">0.</span>, <span class="number">5.</span>, <span class="number">0.</span>);
        <span class="kw">let </span><span class="kw-2">mut </span>outer = Loop3D::new();
        outer.push(p0).unwrap();
        outer.push(p1).unwrap();
        outer.push(p2).unwrap();
        outer.push(p3).unwrap();
        outer.push(p4).unwrap();
        outer.push(p5).unwrap();
        outer.close().unwrap();
        <span class="kw">let </span><span class="kw-2">mut </span>poly = Polygon3D::new(outer).unwrap();

        <span class="kw">let </span>i0 = Point3D::new(<span class="number">0.2</span>, <span class="number">0.2</span>, <span class="number">0.</span>);
        <span class="kw">let </span>i1 = Point3D::new(<span class="number">0.8</span>, <span class="number">0.2</span>, <span class="number">0.</span>);
        <span class="kw">let </span>i2 = Point3D::new(<span class="number">0.8</span>, <span class="number">1.2</span>, <span class="number">0.</span>);
        <span class="kw">let </span>i3 = Point3D::new(<span class="number">0.2</span>, <span class="number">1.2</span>, <span class="number">0.</span>);
        <span class="kw">let </span><span class="kw-2">mut </span>inner = Loop3D::new();
        inner.push(i0).unwrap();
        inner.push(i1).unwrap();
        inner.push(i2).unwrap();
        inner.push(i3).unwrap();
        inner.close().unwrap();
        poly.cut_hole(inner).unwrap();

        <span class="kw">let </span>i0 = Point3D::new(<span class="number">1.2</span>, <span class="number">0.6</span>, <span class="number">0.</span>);
        <span class="kw">let </span>i1 = Point3D::new(<span class="number">2.</span>, <span class="number">0.6</span>, <span class="number">0.</span>);
        <span class="kw">let </span>i2 = Point3D::new(<span class="number">2.</span>, <span class="number">3.2</span>, <span class="number">0.</span>);
        <span class="kw">let </span>i3 = Point3D::new(<span class="number">1.2</span>, <span class="number">3.2</span>, <span class="number">0.</span>);
        <span class="kw">let </span><span class="kw-2">mut </span>inner = Loop3D::new();
        inner.push(i0).unwrap();
        inner.push(i1).unwrap();
        inner.push(i2).unwrap();
        inner.push(i3).unwrap();
        inner.close().unwrap();
        poly.cut_hole(inner).unwrap();

        <span class="kw">let </span>t = Triangulation3D::from_polygon(<span class="kw-2">&amp;</span>poly).unwrap();
        test_triangulation_results(<span class="kw-2">&amp;</span>t, <span class="kw-2">&amp;</span>poly, <span class="number">1000.</span>, <span class="number">1000.</span>).unwrap();

        <span class="kw">let </span><span class="kw-2">mut </span>closed = poly.get_closed_loop();
        closed.close().unwrap();
        <span class="kw">let </span>poly = Polygon3D::new(closed).unwrap();

        <span class="kw">let </span>case3 = get_svg(<span class="kw-2">&amp;</span>t, <span class="kw-2">&amp;</span>poly);

        draw_triangulation(
            <span class="string">&quot;test_from_polygon.html&quot;</span>,
            <span class="macro">vec!</span>[
                (<span class="string">&quot;Case 0&quot;</span>, case0),
                (<span class="string">&quot;Case 1&quot;</span>, case1),
                (<span class="string">&quot;Case 2&quot;</span>, case2),
                (<span class="string">&quot;Case 3&quot;</span>, case3),
            ],
        )
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_mark_neighbourhoods() {
        <span class="kw">let </span>p0 = Point3D::new(<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p1 = Point3D::new(<span class="number">3.</span>, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p2 = Point3D::new(<span class="number">3.</span>, <span class="number">3.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p3 = Point3D::new(<span class="number">5.</span>, <span class="number">5.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p4 = Point3D::new(<span class="number">3.</span>, <span class="number">6.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>p5 = Point3D::new(<span class="number">0.</span>, <span class="number">5.</span>, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t = Triangulation3D::new();
        t.push(p0, p1, p2, <span class="number">0</span>).unwrap();
        t.push(p2, p4, p3, <span class="number">0</span>).unwrap();
        t.push(p2, p5, p4, <span class="number">0</span>).unwrap();
        t.push(p0, p2, p5, <span class="number">0</span>).unwrap();

        t.mark_neighbourhouds().unwrap();

        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">0</span>].neighbour(Edge::Ab), <span class="prelude-val">None</span>);
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">0</span>].neighbour(Edge::Bc), <span class="prelude-val">None</span>);
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">0</span>].neighbour(Edge::Ca), <span class="prelude-val">Some</span>(<span class="number">3</span>));

        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">1</span>].neighbour(Edge::Ab), <span class="prelude-val">Some</span>(<span class="number">2</span>));
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">1</span>].neighbour(Edge::Bc), <span class="prelude-val">None</span>);
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">1</span>].neighbour(Edge::Ca), <span class="prelude-val">None</span>);

        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">2</span>].neighbour(Edge::Ab), <span class="prelude-val">Some</span>(<span class="number">3</span>));
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">2</span>].neighbour(Edge::Bc), <span class="prelude-val">None</span>);
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">2</span>].neighbour(Edge::Ca), <span class="prelude-val">Some</span>(<span class="number">1</span>));

        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">3</span>].neighbour(Edge::Ab), <span class="prelude-val">Some</span>(<span class="number">0</span>));
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">3</span>].neighbour(Edge::Bc), <span class="prelude-val">Some</span>(<span class="number">2</span>));
        <span class="macro">assert_eq!</span>(t.triangles[<span class="number">3</span>].neighbour(Edge::Ca), <span class="prelude-val">None</span>);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_constraints() {
        <span class="kw">let </span>l = <span class="number">3.</span>;
        <span class="kw">let </span>a = Point3D::new(-l, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(l, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">0.</span>, l, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t = TriPiece::new(a, b, c, <span class="number">0</span>).unwrap();

        <span class="macro">assert!</span>(!t.is_constrained(Edge::Ab));
        <span class="macro">assert!</span>(!t.is_constrained(Edge::Bc));
        <span class="macro">assert!</span>(!t.is_constrained(Edge::Ca));

        t.constrain(Edge::Ab);

        <span class="macro">assert!</span>(t.is_constrained(Edge::Ab));
        <span class="macro">assert!</span>(!t.is_constrained(Edge::Bc));
        <span class="macro">assert!</span>(!t.is_constrained(Edge::Ca));
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_set_neighbour() {
        <span class="comment">// This should work.
        </span><span class="kw">let </span>l = <span class="number">3.</span>;
        <span class="kw">let </span>a = Point3D::new(-l, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>b = Point3D::new(l, <span class="number">0.</span>, <span class="number">0.</span>);
        <span class="kw">let </span>c = Point3D::new(<span class="number">0.</span>, l, <span class="number">0.</span>);

        <span class="kw">let </span><span class="kw-2">mut </span>t1 = TriPiece::new(a, b, c, <span class="number">0</span>).unwrap();

        t1.set_neighbour(Edge::Ab, <span class="number">1</span>);
        t1.set_neighbour(Edge::Bc, <span class="number">11</span>);
        t1.set_neighbour(Edge::Ca, <span class="number">111</span>);

        <span class="macro">assert_eq!</span>(t1.n0.unwrap(), <span class="number">1</span>);
        <span class="macro">assert_eq!</span>(t1.n1.unwrap(), <span class="number">11</span>);
        <span class="macro">assert_eq!</span>(t1.n2.unwrap(), <span class="number">111</span>);
    }

    <span class="attribute">#[test]
    </span><span class="kw">fn </span>test_add_edge() {
        <span class="kw">let </span>edge = Edge::Ab;
        <span class="macro">assert_eq!</span>(Edge::Bc, edge + <span class="number">1</span>);
        <span class="macro">assert_eq!</span>(Edge::Ca, edge + <span class="number">2</span>);
        <span class="macro">assert_eq!</span>(Edge::Ab, edge + <span class="number">3</span>);
    }
} <span class="comment">// end of test module
</span></code></pre></div>
</section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="geometry3d" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.65.0 (897e37553 2022-11-02)" ></div></body></html>